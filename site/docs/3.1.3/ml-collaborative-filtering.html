
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Collaborative Filtering - Spark 3.1.3 Documentation</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <link rel="stylesheet" href="css/docsearch.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light" id="topbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="navbar-brand"><a href="index.html">
                        <img src="img/spark-logo-hd.png" style="height:50px;"/></a><span class="version">3.1.3</span>
                    </div>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarCollapse" aria-controls="navbarCollapse"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li class="nav-item"><a href="index.html" class="nav-link">Overview</a></li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarQuickStart" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming Guides</a>
                            <div class="dropdown-menu" aria-labelledby="navbarQuickStart">
                                <a class="dropdown-item" href="quick-start.html">Quick Start</a>
                                <a class="dropdown-item" href="rdd-programming-guide.html">RDDs, Accumulators, Broadcasts Vars</a>
                                <a class="dropdown-item" href="sql-programming-guide.html">SQL, DataFrames, and Datasets</a>
                                <a class="dropdown-item" href="structured-streaming-programming-guide.html">Structured Streaming</a>
                                <a class="dropdown-item" href="streaming-programming-guide.html">Spark Streaming (DStreams)</a>
                                <a class="dropdown-item" href="ml-guide.html">MLlib (Machine Learning)</a>
                                <a class="dropdown-item" href="graphx-programming-guide.html">GraphX (Graph Processing)</a>
                                <a class="dropdown-item" href="sparkr.html">SparkR (R on Spark)</a>
                                <a class="dropdown-item" href="api/python/getting_started/index.html">PySpark (Python on Spark)</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarAPIDocs" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API Docs</a>
                            <div class="dropdown-menu" aria-labelledby="navbarAPIDocs">
                                <a class="dropdown-item" href="api/scala/org/apache/spark/index.html">Scala</a>
                                <a class="dropdown-item" href="api/java/index.html">Java</a>
                                <a class="dropdown-item" href="api/python/index.html">Python</a>
                                <a class="dropdown-item" href="api/R/index.html">R</a>
                                <a class="dropdown-item" href="api/sql/index.html">SQL, Built-in Functions</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarDeploying" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Deploying</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDeploying">
                                <a class="dropdown-item" href="cluster-overview.html">Overview</a>
                                <a class="dropdown-item" href="submitting-applications.html">Submitting Applications</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="spark-standalone.html">Spark Standalone</a>
                                <a class="dropdown-item" href="running-on-mesos.html">Mesos</a>
                                <a class="dropdown-item" href="running-on-yarn.html">YARN</a>
                                <a class="dropdown-item" href="running-on-kubernetes.html">Kubernetes</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarMore" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
                            <div class="dropdown-menu" aria-labelledby="navbarMore">
                                <a class="dropdown-item" href="configuration.html">Configuration</a>
                                <a class="dropdown-item" href="monitoring.html">Monitoring</a>
                                <a class="dropdown-item" href="tuning.html">Tuning Guide</a>
                                <a class="dropdown-item" href="job-scheduling.html">Job Scheduling</a>
                                <a class="dropdown-item" href="security.html">Security</a>
                                <a class="dropdown-item" href="hardware-provisioning.html">Hardware Provisioning</a>
                                <a class="dropdown-item" href="migration-guide.html">Migration Guide</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="building-spark.html">Building Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/contributing.html">Contributing to Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/third-party-projects.html">Third Party Projects</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <input type="text" id="docsearch-input" placeholder="Search the docsâ€¦">
                        </li>
                    </ul>
                    <!--<span class="navbar-text navbar-right"><span class="version-text">v3.1.3</span></span>-->
                </div>
            </div>
        </nav>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib: Main Guide</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-datasource.html">
            
                Data sources
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">
            
                Pipelines
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-features.html">
            
                Extracting, transforming and selecting features
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">
            
                Classification and Regression
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">
            
                <b>Collaborative filtering</b>
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">
            
                Frequent Pattern Mining
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">
            
                Model selection and tuning
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">
            
                Advanced topics
            
        </a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib: RDD-based API Guide</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">
            
                Data types
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">
            
                Classification and regression
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">
            
                Dimensionality reduction
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">
            
                Feature extraction and transformation
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">
            
                Frequent pattern mining
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">
            
                Evaluation metrics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">
            
                PMML model export
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">
            
                Optimization (developer)
            
        </a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" checked type="checkbox">
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar mr-3" id="content">
                    
                        <h1 class="title">Collaborative Filtering</h1>
                    

                    <ul id="markdown-toc">
  <li><a href="#collaborative-filtering" id="markdown-toc-collaborative-filtering">Collaborative filtering</a>    <ul>
      <li><a href="#explicit-vs-implicit-feedback" id="markdown-toc-explicit-vs-implicit-feedback">Explicit vs. implicit feedback</a></li>
      <li><a href="#scaling-of-the-regularization-parameter" id="markdown-toc-scaling-of-the-regularization-parameter">Scaling of the regularization parameter</a></li>
      <li><a href="#cold-start-strategy" id="markdown-toc-cold-start-strategy">Cold-start strategy</a></li>
    </ul>
  </li>
</ul>

<h2 id="collaborative-filtering">Collaborative filtering</h2>

<p><a href="http://en.wikipedia.org/wiki/Recommender_system#Collaborative_filtering">Collaborative filtering</a>
is commonly used for recommender systems.  These techniques aim to fill in the
missing entries of a user-item association matrix.  <code class="language-plaintext highlighter-rouge">spark.ml</code> currently supports
model-based collaborative filtering, in which users and products are described
by a small set of latent factors that can be used to predict missing entries.
<code class="language-plaintext highlighter-rouge">spark.ml</code> uses the <a href="http://dl.acm.org/citation.cfm?id=1608614">alternating least squares
(ALS)</a>
algorithm to learn these latent factors. The implementation in <code class="language-plaintext highlighter-rouge">spark.ml</code> has the
following parameters:</p>

<ul>
  <li><em>numBlocks</em> is the number of blocks the users and items will be partitioned into in order to parallelize computation (defaults to 10).</li>
  <li><em>rank</em> is the number of latent factors in the model (defaults to 10).</li>
  <li><em>maxIter</em> is the maximum number of iterations to run (defaults to 10).</li>
  <li><em>regParam</em> specifies the regularization parameter in ALS (defaults to 1.0).</li>
  <li><em>implicitPrefs</em> specifies whether to use the <em>explicit feedback</em> ALS variant or one adapted for
<em>implicit feedback</em> data (defaults to <code class="language-plaintext highlighter-rouge">false</code> which means using <em>explicit feedback</em>).</li>
  <li><em>alpha</em> is a parameter applicable to the implicit feedback variant of ALS that governs the
<em>baseline</em> confidence in preference observations (defaults to 1.0).</li>
  <li><em>nonnegative</em> specifies whether or not to use nonnegative constraints for least squares (defaults to <code class="language-plaintext highlighter-rouge">false</code>).</li>
</ul>

<p><strong>Note:</strong> The DataFrame-based API for ALS currently only supports integers for user and item ids.
Other numeric types are supported for the user and item id columns, 
but the ids must be within the integer value range.</p>

<h3 id="explicit-vs-implicit-feedback">Explicit vs. implicit feedback</h3>

<p>The standard approach to matrix factorization-based collaborative filtering treats
the entries in the user-item matrix as <em>explicit</em> preferences given by the user to the item,
for example, users giving ratings to movies.</p>

<p>It is common in many real-world use cases to only have access to <em>implicit feedback</em> (e.g. views,
clicks, purchases, likes, shares etc.). The approach used in <code class="language-plaintext highlighter-rouge">spark.ml</code> to deal with such data is taken
from <a href="https://doi.org/10.1109/ICDM.2008.22">Collaborative Filtering for Implicit Feedback Datasets</a>.
Essentially, instead of trying to model the matrix of ratings directly, this approach treats the data
as numbers representing the <em>strength</em> in observations of user actions (such as the number of clicks,
or the cumulative duration someone spent viewing a movie). Those numbers are then related to the level of
confidence in observed user preferences, rather than explicit ratings given to items. The model
then tries to find latent factors that can be used to predict the expected preference of a user for
an item.</p>

<h3 id="scaling-of-the-regularization-parameter">Scaling of the regularization parameter</h3>

<p>We scale the regularization parameter <code class="language-plaintext highlighter-rouge">regParam</code> in solving each least squares problem by
the number of ratings the user generated in updating user factors,
or the number of ratings the product received in updating product factors.
This approach is named &#8220;ALS-WR&#8221; and discussed in the paper
&#8220;<a href="https://doi.org/10.1007/978-3-540-68880-8_32">Large-Scale Parallel Collaborative Filtering for the Netflix Prize</a>&#8221;.
It makes <code class="language-plaintext highlighter-rouge">regParam</code> less dependent on the scale of the dataset, so we can apply the
best parameter learned from a sampled subset to the full dataset and expect similar performance.</p>

<h3 id="cold-start-strategy">Cold-start strategy</h3>

<p>When making predictions using an <code class="language-plaintext highlighter-rouge">ALSModel</code>, it is common to encounter users and/or items in the 
test dataset that were not present during training the model. This typically occurs in two 
scenarios:</p>

<ol>
  <li>In production, for new users or items that have no rating history and on which the model has not 
been trained (this is the &#8220;cold start problem&#8221;).</li>
  <li>During cross-validation, the data is split between training and evaluation sets. When using 
simple random splits as in Spark&#8217;s <code class="language-plaintext highlighter-rouge">CrossValidator</code> or <code class="language-plaintext highlighter-rouge">TrainValidationSplit</code>, it is actually 
very common to encounter users and/or items in the evaluation set that are not in the training set</li>
</ol>

<p>By default, Spark assigns <code class="language-plaintext highlighter-rouge">NaN</code> predictions during <code class="language-plaintext highlighter-rouge">ALSModel.transform</code> when a user and/or item 
factor is not present in the model. This can be useful in a production system, since it indicates 
a new user or item, and so the system can make a decision on some fallback to use as the prediction.</p>

<p>However, this is undesirable during cross-validation, since any <code class="language-plaintext highlighter-rouge">NaN</code> predicted values will result
in <code class="language-plaintext highlighter-rouge">NaN</code> results for the evaluation metric (for example when using <code class="language-plaintext highlighter-rouge">RegressionEvaluator</code>).
This makes model selection impossible.</p>

<p>Spark allows users to set the <code class="language-plaintext highlighter-rouge">coldStartStrategy</code> parameter
to &#8220;drop&#8221; in order to drop any rows in the <code class="language-plaintext highlighter-rouge">DataFrame</code> of predictions that contain <code class="language-plaintext highlighter-rouge">NaN</code> values. 
The evaluation metric will then be computed over the non-<code class="language-plaintext highlighter-rouge">NaN</code> data and will be valid. 
Usage of this parameter is illustrated in the example below.</p>

<p><strong>Note:</strong> currently the supported cold start strategies are &#8220;nan&#8221; (the default behavior mentioned 
above) and &#8220;drop&#8221;. Further strategies may be supported in future.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>In the following example, we load ratings data from the
<a href="http://grouplens.org/datasets/movielens/">MovieLens dataset</a>, each row
consisting of a user, a movie, a rating and a timestamp.
We then train an ALS model which assumes, by default, that the ratings are
explicit (<code class="language-plaintext highlighter-rouge">implicitPrefs</code> is <code class="language-plaintext highlighter-rouge">false</code>).
We evaluate the recommendation model by measuring the root-mean-square error of
rating prediction.</p>

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/recommendation/ALS.html"><code class="language-plaintext highlighter-rouge">ALS</code> Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.recommendation.ALS</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Rating</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">movieId</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Float</span><span class="o">,</span> <span class="n">timestamp</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
<span class="k">def</span> <span class="nf">parseRating</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rating</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">fields</span> <span class="k">=</span> <span class="nv">str</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"::"</span><span class="o">)</span>
  <span class="nf">assert</span><span class="o">(</span><span class="nv">fields</span><span class="o">.</span><span class="py">size</span> <span class="o">==</span> <span class="mi">4</span><span class="o">)</span>
  <span class="nc">Rating</span><span class="o">(</span><span class="nf">fields</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="py">toInt</span><span class="o">,</span> <span class="nf">fields</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="py">toInt</span><span class="o">,</span> <span class="nf">fields</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="py">toFloat</span><span class="o">,</span> <span class="nf">fields</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="py">toLong</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">ratings</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"data/mllib/als/sample_movielens_ratings.txt"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">parseRating</span><span class="o">)</span>
  <span class="o">.</span><span class="py">toDF</span><span class="o">()</span>
<span class="k">val</span> <span class="nv">Array</span><span class="o">(</span><span class="n">training</span><span class="o">,</span> <span class="n">test</span><span class="o">)</span> <span class="k">=</span> <span class="nv">ratings</span><span class="o">.</span><span class="py">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.8</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">))</span>

<span class="c1">// Build the recommendation model using ALS on the training data</span>
<span class="k">val</span> <span class="nv">als</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ALS</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setMaxIter</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRegParam</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setUserCol</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setItemCol</span><span class="o">(</span><span class="s">"movieId"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRatingCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">als</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">training</span><span class="o">)</span>

<span class="c1">// Evaluate the model by computing the RMSE on the test data</span>
<span class="c1">// Note we set cold start strategy to 'drop' to ensure we don't get NaN evaluation metrics</span>
<span class="nv">model</span><span class="o">.</span><span class="py">setColdStartStrategy</span><span class="o">(</span><span class="s">"drop"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">predictions</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">test</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">evaluator</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setMetricName</span><span class="o">(</span><span class="s">"rmse"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPredictionCol</span><span class="o">(</span><span class="s">"prediction"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">rmse</span> <span class="k">=</span> <span class="nv">evaluator</span><span class="o">.</span><span class="py">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Root-mean-square error = $rmse"</span><span class="o">)</span>

<span class="c1">// Generate top 10 movie recommendations for each user</span>
<span class="k">val</span> <span class="nv">userRecs</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">recommendForAllUsers</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">// Generate top 10 user recommendations for each movie</span>
<span class="k">val</span> <span class="nv">movieRecs</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">recommendForAllItems</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>

<span class="c1">// Generate top 10 movie recommendations for a specified set of users</span>
<span class="k">val</span> <span class="nv">users</span> <span class="k">=</span> <span class="nv">ratings</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="nv">als</span><span class="o">.</span><span class="py">getUserCol</span><span class="o">).</span><span class="py">distinct</span><span class="o">().</span><span class="py">limit</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">userSubsetRecs</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">recommendForUserSubset</span><span class="o">(</span><span class="n">users</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
<span class="c1">// Generate top 10 user recommendations for a specified set of movies</span>
<span class="k">val</span> <span class="nv">movies</span> <span class="k">=</span> <span class="nv">ratings</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="nv">als</span><span class="o">.</span><span class="py">getItemCol</span><span class="o">).</span><span class="py">distinct</span><span class="o">().</span><span class="py">limit</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">movieSubSetRecs</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">recommendForItemSubset</span><span class="o">(</span><span class="n">movies</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/ALSExample.scala" in the Spark repo.</small></div>

    <p>If the rating matrix is derived from another source of information (i.e. it is
inferred from other signals), you can set <code class="language-plaintext highlighter-rouge">implicitPrefs</code> to <code class="language-plaintext highlighter-rouge">true</code> to get
better results:</p>

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="nv">als</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ALS</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setMaxIter</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRegParam</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setImplicitPrefs</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setUserCol</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setItemCol</span><span class="o">(</span><span class="s">"movieId"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setRatingCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="java">

    <p>In the following example, we load ratings data from the
<a href="http://grouplens.org/datasets/movielens/">MovieLens dataset</a>, each row
consisting of a user, a movie, a rating and a timestamp.
We then train an ALS model which assumes, by default, that the ratings are
explicit (<code class="language-plaintext highlighter-rouge">implicitPrefs</code> is <code class="language-plaintext highlighter-rouge">false</code>).
We evaluate the recommendation model by measuring the root-mean-square error of
rating prediction.</p>

    <p>Refer to the <a href="api/java/org/apache/spark/ml/recommendation/ALS.html"><code class="language-plaintext highlighter-rouge">ALS</code> Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaRDD</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.RegressionEvaluator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.recommendation.ALS</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.recommendation.ALSModel</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Rating</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">userId</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">movieId</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">float</span> <span class="n">rating</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Rating</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="nf">Rating</span><span class="o">(</span><span class="kt">int</span> <span class="n">userId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">movieId</span><span class="o">,</span> <span class="kt">float</span> <span class="n">rating</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">userId</span> <span class="o">=</span> <span class="n">userId</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">movieId</span> <span class="o">=</span> <span class="n">movieId</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">rating</span> <span class="o">=</span> <span class="n">rating</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">timestamp</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getUserId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">userId</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMovieId</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">movieId</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getRating</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">rating</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getTimestamp</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">timestamp</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Rating</span> <span class="nf">parseRating</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"::"</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">fields</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">4</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Each line must contain 4 fields"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kt">int</span> <span class="n">userId</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
    <span class="kt">int</span> <span class="n">movieId</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
    <span class="kt">float</span> <span class="n">rating</span> <span class="o">=</span> <span class="nc">Float</span><span class="o">.</span><span class="na">parseFloat</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
    <span class="kt">long</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">fields</span><span class="o">[</span><span class="mi">3</span><span class="o">]);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Rating</span><span class="o">(</span><span class="n">userId</span><span class="o">,</span> <span class="n">movieId</span><span class="o">,</span> <span class="n">rating</span><span class="o">,</span> <span class="n">timestamp</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">Rating</span><span class="o">&gt;</span> <span class="n">ratingsRDD</span> <span class="o">=</span> <span class="n">spark</span>
  <span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">textFile</span><span class="o">(</span><span class="s">"data/mllib/als/sample_movielens_ratings.txt"</span><span class="o">).</span><span class="na">javaRDD</span><span class="o">()</span>
  <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Rating:</span><span class="o">:</span><span class="n">parseRating</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">ratings</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">ratingsRDD</span><span class="o">,</span> <span class="nc">Rating</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.8</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">training</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">test</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Build the recommendation model using ALS on the training data</span>
<span class="no">ALS</span> <span class="n">als</span> <span class="o">=</span> <span class="k">new</span> <span class="no">ALS</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUserCol</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setItemCol</span><span class="o">(</span><span class="s">"movieId"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRatingCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">);</span>
<span class="nc">ALSModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">als</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">training</span><span class="o">);</span>

<span class="c1">// Evaluate the model by computing the RMSE on the test data</span>
<span class="c1">// Note we set cold start strategy to 'drop' to ensure we don't get NaN evaluation metrics</span>
<span class="n">model</span><span class="o">.</span><span class="na">setColdStartStrategy</span><span class="o">(</span><span class="s">"drop"</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">test</span><span class="o">);</span>

<span class="nc">RegressionEvaluator</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RegressionEvaluator</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMetricName</span><span class="o">(</span><span class="s">"rmse"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setPredictionCol</span><span class="o">(</span><span class="s">"prediction"</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">predictions</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Root-mean-square error = "</span> <span class="o">+</span> <span class="n">rmse</span><span class="o">);</span>

<span class="c1">// Generate top 10 movie recommendations for each user</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">userRecs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">recommendForAllUsers</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
<span class="c1">// Generate top 10 user recommendations for each movie</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">movieRecs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">recommendForAllItems</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

<span class="c1">// Generate top 10 movie recommendations for a specified set of users</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">als</span><span class="o">.</span><span class="na">getUserCol</span><span class="o">()).</span><span class="na">distinct</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">userSubsetRecs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">recommendForUserSubset</span><span class="o">(</span><span class="n">users</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
<span class="c1">// Generate top 10 user recommendations for a specified set of movies</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">movies</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">als</span><span class="o">.</span><span class="na">getItemCol</span><span class="o">()).</span><span class="na">distinct</span><span class="o">().</span><span class="na">limit</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">movieSubSetRecs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">recommendForItemSubset</span><span class="o">(</span><span class="n">movies</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaALSExample.java" in the Spark repo.</small></div>

    <p>If the rating matrix is derived from another source of information (i.e. it is
inferred from other signals), you can set <code class="language-plaintext highlighter-rouge">implicitPrefs</code> to <code class="language-plaintext highlighter-rouge">true</code> to get
better results:</p>

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="no">ALS</span> <span class="n">als</span> <span class="o">=</span> <span class="k">new</span> <span class="no">ALS</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setMaxIter</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRegParam</span><span class="o">(</span><span class="mf">0.01</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setImplicitPrefs</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUserCol</span><span class="o">(</span><span class="s">"userId"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setItemCol</span><span class="o">(</span><span class="s">"movieId"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setRatingCol</span><span class="o">(</span><span class="s">"rating"</span><span class="o">);</span></code></pre></figure>

  </div>

<div data-lang="python">

    <p>In the following example, we load ratings data from the
<a href="http://grouplens.org/datasets/movielens/">MovieLens dataset</a>, each row
consisting of a user, a movie, a rating and a timestamp.
We then train an ALS model which assumes, by default, that the ratings are
explicit (<code class="language-plaintext highlighter-rouge">implicitPrefs</code> is <code class="language-plaintext highlighter-rouge">False</code>).
We evaluate the recommendation model by measuring the root-mean-square error of
rating prediction.</p>

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.recommendation.ALS.html"><code class="language-plaintext highlighter-rouge">ALS</code> Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">RegressionEvaluator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.recommendation</span> <span class="kn">import</span> <span class="n">ALS</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">text</span><span class="p">(</span><span class="s">"data/mllib/als/sample_movielens_ratings.txt"</span><span class="p">).</span><span class="n">rdd</span>
<span class="n">parts</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"::"</span><span class="p">))</span>
<span class="n">ratingsRDD</span> <span class="o">=</span> <span class="n">parts</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">Row</span><span class="p">(</span><span class="n">userId</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">movieId</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                     <span class="n">rating</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">timestamp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">ratingsRDD</span><span class="p">)</span>
<span class="p">(</span><span class="n">training</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

<span class="c1"># Build the recommendation model using ALS on the training data
# Note we set cold start strategy to 'drop' to ensure we don't get NaN evaluation metrics
</span><span class="n">als</span> <span class="o">=</span> <span class="n">ALS</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">userCol</span><span class="o">=</span><span class="s">"userId"</span><span class="p">,</span> <span class="n">itemCol</span><span class="o">=</span><span class="s">"movieId"</span><span class="p">,</span> <span class="n">ratingCol</span><span class="o">=</span><span class="s">"rating"</span><span class="p">,</span>
          <span class="n">coldStartStrategy</span><span class="o">=</span><span class="s">"drop"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">als</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Evaluate the model by computing the RMSE on the test data
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">RegressionEvaluator</span><span class="p">(</span><span class="n">metricName</span><span class="o">=</span><span class="s">"rmse"</span><span class="p">,</span> <span class="n">labelCol</span><span class="o">=</span><span class="s">"rating"</span><span class="p">,</span>
                                <span class="n">predictionCol</span><span class="o">=</span><span class="s">"prediction"</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Root-mean-square error = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>

<span class="c1"># Generate top 10 movie recommendations for each user
</span><span class="n">userRecs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">recommendForAllUsers</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Generate top 10 user recommendations for each movie
</span><span class="n">movieRecs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">recommendForAllItems</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Generate top 10 movie recommendations for a specified set of users
</span><span class="n">users</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">als</span><span class="p">.</span><span class="n">getUserCol</span><span class="p">()).</span><span class="n">distinct</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">userSubsetRecs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">recommendForUserSubset</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># Generate top 10 user recommendations for a specified set of movies
</span><span class="n">movies</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">als</span><span class="p">.</span><span class="n">getItemCol</span><span class="p">()).</span><span class="n">distinct</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">movieSubSetRecs</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">recommendForItemSubset</span><span class="p">(</span><span class="n">movies</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/als_example.py" in the Spark repo.</small></div>

    <p>If the rating matrix is derived from another source of information (i.e. it is
inferred from other signals), you can set <code class="language-plaintext highlighter-rouge">implicitPrefs</code> to <code class="language-plaintext highlighter-rouge">True</code> to get
better results:</p>

    <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">als</span> <span class="o">=</span> <span class="n">ALS</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">implicitPrefs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">userCol</span><span class="o">=</span><span class="s">"userId"</span><span class="p">,</span> <span class="n">itemCol</span><span class="o">=</span><span class="s">"movieId"</span><span class="p">,</span> <span class="n">ratingCol</span><span class="o">=</span><span class="s">"rating"</span><span class="p">)</span></code></pre></figure>

  </div>

<div data-lang="r">

    <p>Refer to the <a href="api/R/spark.als.html">R API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="c1"># Load training data</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">4.0</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2.0</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3.0</span><span class="p">),</span><span class="w">
             </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4.0</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1.0</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">5.0</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"userId"</span><span class="p">,</span><span class="w"> </span><span class="s2">"movieId"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rating"</span><span class="p">))</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w">
</span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df</span><span class="w">

</span><span class="c1"># Fit a recommendation model using ALS with spark.als</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spark.als</span><span class="p">(</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="n">maxIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">regParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="n">userCol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"userId"</span><span class="p">,</span><span class="w">
                   </span><span class="n">itemCol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"movieId"</span><span class="p">,</span><span class="w"> </span><span class="n">ratingCol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"rating"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Model summary</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w">

</span><span class="c1"># Prediction</span><span class="w">
</span><span class="n">predictions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/r/ml/als.R" in the Spark repo.</small></div>
  </div>

</div>


                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-3.5.1.min.js"></script>
        <script src="js/vendor/bootstrap.bundle.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
        <script type="text/javascript">
            // DocSearch is entirely free and automated. DocSearch is built in two parts:
            // 1. a crawler which we run on our own infrastructure every 24 hours. It follows every link
            //    in your website and extract content from every page it traverses. It then pushes this
            //    content to an Algolia index.
            // 2. a JavaScript snippet to be inserted in your website that will bind this Algolia index
            //    to your search input and display its results in a dropdown UI. If you want to find more
            //    details on how works DocSearch, check the docs of DocSearch.
            docsearch({
    apiKey: 'b18ca3732c502995563043aa17bc6ecb',
    indexName: 'apache_spark',
    inputSelector: '#docsearch-input',
    enhancedSearchInput: true,
    algoliaOptions: {
      'facetFilters': ["version:3.1.4"]
    },
    debug: false // Set debug to true if you want to inspect the dropdown
});

        </script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    </body>
</html>
