
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Frequent Pattern Mining - Spark 3.1.1 Documentation</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <link rel="stylesheet" href="css/docsearch.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    <!-- Matomo -->
    <script type="text/javascript">
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(["disableCookies"]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://analytics.apache.org/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '40']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light" id="topbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="navbar-brand"><a href="index.html">
                        <img src="img/spark-logo-hd.png" style="height:50px;"/></a><span class="version">3.1.1</span>
                    </div>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarCollapse" aria-controls="navbarCollapse"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li class="nav-item"><a href="index.html" class="nav-link">Overview</a></li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarQuickStart" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming Guides</a>
                            <div class="dropdown-menu" aria-labelledby="navbarQuickStart">
                                <a class="dropdown-item" href="quick-start.html">Quick Start</a>
                                <a class="dropdown-item" href="rdd-programming-guide.html">RDDs, Accumulators, Broadcasts Vars</a>
                                <a class="dropdown-item" href="sql-programming-guide.html">SQL, DataFrames, and Datasets</a>
                                <a class="dropdown-item" href="structured-streaming-programming-guide.html">Structured Streaming</a>
                                <a class="dropdown-item" href="streaming-programming-guide.html">Spark Streaming (DStreams)</a>
                                <a class="dropdown-item" href="ml-guide.html">MLlib (Machine Learning)</a>
                                <a class="dropdown-item" href="graphx-programming-guide.html">GraphX (Graph Processing)</a>
                                <a class="dropdown-item" href="sparkr.html">SparkR (R on Spark)</a>
                                <a class="dropdown-item" href="api/python/getting_started/index.html">PySpark (Python on Spark)</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarAPIDocs" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API Docs</a>
                            <div class="dropdown-menu" aria-labelledby="navbarAPIDocs">
                                <a class="dropdown-item" href="api/scala/org/apache/spark/index.html">Scala</a>
                                <a class="dropdown-item" href="api/java/index.html">Java</a>
                                <a class="dropdown-item" href="api/python/index.html">Python</a>
                                <a class="dropdown-item" href="api/R/index.html">R</a>
                                <a class="dropdown-item" href="api/sql/index.html">SQL, Built-in Functions</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarDeploying" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Deploying</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDeploying">
                                <a class="dropdown-item" href="cluster-overview.html">Overview</a>
                                <a class="dropdown-item" href="submitting-applications.html">Submitting Applications</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="spark-standalone.html">Spark Standalone</a>
                                <a class="dropdown-item" href="running-on-mesos.html">Mesos</a>
                                <a class="dropdown-item" href="running-on-yarn.html">YARN</a>
                                <a class="dropdown-item" href="running-on-kubernetes.html">Kubernetes</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarMore" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
                            <div class="dropdown-menu" aria-labelledby="navbarMore">
                                <a class="dropdown-item" href="configuration.html">Configuration</a>
                                <a class="dropdown-item" href="monitoring.html">Monitoring</a>
                                <a class="dropdown-item" href="tuning.html">Tuning Guide</a>
                                <a class="dropdown-item" href="job-scheduling.html">Job Scheduling</a>
                                <a class="dropdown-item" href="security.html">Security</a>
                                <a class="dropdown-item" href="hardware-provisioning.html">Hardware Provisioning</a>
                                <a class="dropdown-item" href="migration-guide.html">Migration Guide</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="building-spark.html">Building Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/contributing.html">Contributing to Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/third-party-projects.html">Third Party Projects</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <input type="text" id="docsearch-input" placeholder="Search the docsâ€¦">
                        </li>
                    </ul>
                    <!--<span class="navbar-text navbar-right"><span class="version-text">v3.1.1</span></span>-->
                </div>
            </div>
        </nav>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib: Main Guide</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-datasource.html">
            
                Data sources
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">
            
                Pipelines
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-features.html">
            
                Extracting, transforming and selecting features
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">
            
                Classification and Regression
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">
            
                <b>Frequent Pattern Mining</b>
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">
            
                Model selection and tuning
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">
            
                Advanced topics
            
        </a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib: RDD-based API Guide</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">
            
                Data types
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">
            
                Classification and regression
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">
            
                Dimensionality reduction
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">
            
                Feature extraction and transformation
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">
            
                Frequent pattern mining
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">
            
                Evaluation metrics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">
            
                PMML model export
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">
            
                Optimization (developer)
            
        </a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" checked type="checkbox">
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar mr-3" id="content">
                    
                        <h1 class="title">Frequent Pattern Mining</h1>
                    

                    <p>Mining frequent items, itemsets, subsequences, or other substructures is usually among the
first steps to analyze a large-scale dataset, which has been an active research topic in
data mining for years.
We refer users to Wikipedia&#8217;s <a href="http://en.wikipedia.org/wiki/Association_rule_learning">association rule learning</a>
for more information.</p>

<p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#fp-growth" id="markdown-toc-fp-growth">FP-Growth</a></li>
  <li><a href="#prefixspan" id="markdown-toc-prefixspan">PrefixSpan</a></li>
</ul>

<h2 id="fp-growth">FP-Growth</h2>

<p>The FP-growth algorithm is described in the paper
<a href="https://doi.org/10.1145/335191.335372">Han et al., Mining frequent patterns without candidate generation</a>,
where &#8220;FP&#8221; stands for frequent pattern.
Given a dataset of transactions, the first step of FP-growth is to calculate item frequencies and identify frequent items.
Different from <a href="http://en.wikipedia.org/wiki/Apriori_algorithm">Apriori-like</a> algorithms designed for the same purpose,
the second step of FP-growth uses a suffix tree (FP-tree) structure to encode transactions without generating candidate sets
explicitly, which are usually expensive to generate.
After the second step, the frequent itemsets can be extracted from the FP-tree.
In <code class="language-plaintext highlighter-rouge">spark.mllib</code>, we implemented a parallel version of FP-growth called PFP,
as described in <a href="https://doi.org/10.1145/1454008.1454027">Li et al., PFP: Parallel FP-growth for query recommendation</a>.
PFP distributes the work of growing FP-trees based on the suffixes of transactions,
and hence is more scalable than a single-machine implementation.
We refer users to the papers for more details.</p>

<p><code class="language-plaintext highlighter-rouge">spark.ml</code>&#8217;s FP-growth implementation takes the following (hyper-)parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">minSupport</code>: the minimum support for an itemset to be identified as frequent.
For example, if an item appears 3 out of 5 transactions, it has a support of 3/5=0.6.</li>
  <li><code class="language-plaintext highlighter-rouge">minConfidence</code>: minimum confidence for generating Association Rule. Confidence is an indication of how often an
association rule has been found to be true. For example, if in the transactions itemset <code class="language-plaintext highlighter-rouge">X</code> appears 4 times, <code class="language-plaintext highlighter-rouge">X</code>
and <code class="language-plaintext highlighter-rouge">Y</code> co-occur only 2 times, the confidence for the rule <code class="language-plaintext highlighter-rouge">X =&gt; Y</code> is then 2/4 = 0.5. The parameter will not
affect the mining for frequent itemsets, but specify the minimum confidence for generating association rules
from frequent itemsets.</li>
  <li><code class="language-plaintext highlighter-rouge">numPartitions</code>: the number of partitions used to distribute the work. By default the param is not set, and
number of partitions of the input dataset is used.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">FPGrowthModel</code> provides:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">freqItemsets</code>: frequent itemsets in the format of DataFrame(&#8220;items&#8221;[Array], &#8220;freq&#8221;[Long])</li>
  <li><code class="language-plaintext highlighter-rouge">associationRules</code>: association rules generated with confidence above <code class="language-plaintext highlighter-rouge">minConfidence</code>, in the format of 
DataFrame(&#8220;antecedent&#8221;[Array], &#8220;consequent&#8221;[Array], &#8220;confidence&#8221;[Double]).</li>
  <li><code class="language-plaintext highlighter-rouge">transform</code>: For each transaction in <code class="language-plaintext highlighter-rouge">itemsCol</code>, the <code class="language-plaintext highlighter-rouge">transform</code> method will compare its items against the antecedents
of each association rule. If the record contains all the antecedents of a specific association rule, the rule
will be considered as applicable and its consequents will be added to the prediction result. The transform
method will summarize the consequents from all the applicable rules as prediction. The prediction column has
the same data type as <code class="language-plaintext highlighter-rouge">itemsCol</code> and does not contain existing items in the <code class="language-plaintext highlighter-rouge">itemsCol</code>.</li>
</ul>

<p><strong>Examples</strong></p>

<div class="codetabs">

<div data-lang="scala">
    <p>Refer to the <a href="api/scala/org/apache/spark/ml/fpm/FPGrowth.html">Scala API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.fpm.FPGrowth</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataset</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"1 2 5"</span><span class="o">,</span>
  <span class="s">"1 2 3 5"</span><span class="o">,</span>
  <span class="s">"1 2"</span><span class="o">)</span>
<span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="n">t</span> <span class="k">=&gt;</span> <span class="nv">t</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">" "</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"items"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">fpgrowth</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FPGrowth</span><span class="o">().</span><span class="py">setItemsCol</span><span class="o">(</span><span class="s">"items"</span><span class="o">).</span><span class="py">setMinSupport</span><span class="o">(</span><span class="mf">0.5</span><span class="o">).</span><span class="py">setMinConfidence</span><span class="o">(</span><span class="mf">0.6</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">fpgrowth</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>

<span class="c1">// Display frequent itemsets.</span>
<span class="nv">model</span><span class="o">.</span><span class="py">freqItemsets</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Display generated association rules.</span>
<span class="nv">model</span><span class="o">.</span><span class="py">associationRules</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// transform examines the input items against all the association rules and summarize the</span>
<span class="c1">// consequents as prediction</span>
<span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/FPGrowthExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">
    <p>Refer to the <a href="api/java/org/apache/spark/ml/fpm/FPGrowth.html">Java API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.fpm.FPGrowth</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.fpm.FPGrowthModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"1 2 5"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"1 2 3 5"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"1 2"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">)))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span> <span class="k">new</span> <span class="nc">StructField</span><span class="o">(</span>
  <span class="s">"items"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">itemsDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">FPGrowthModel</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FPGrowth</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setItemsCol</span><span class="o">(</span><span class="s">"items"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMinSupport</span><span class="o">(</span><span class="mf">0.5</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMinConfidence</span><span class="o">(</span><span class="mf">0.6</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">itemsDF</span><span class="o">);</span>

<span class="c1">// Display frequent itemsets.</span>
<span class="n">model</span><span class="o">.</span><span class="na">freqItemsets</span><span class="o">().</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Display generated association rules.</span>
<span class="n">model</span><span class="o">.</span><span class="na">associationRules</span><span class="o">().</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// transform examines the input items against all the association rules and summarize the</span>
<span class="c1">// consequents as prediction</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">itemsDF</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaFPGrowthExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">
    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.fpm.FPGrowth.html">Python API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.fpm</span> <span class="kn">import</span> <span class="n">FPGrowth</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"items"</span><span class="p">])</span>

<span class="n">fpGrowth</span> <span class="o">=</span> <span class="n">FPGrowth</span><span class="p">(</span><span class="n">itemsCol</span><span class="o">=</span><span class="s">"items"</span><span class="p">,</span> <span class="n">minSupport</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">minConfidence</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">fpGrowth</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Display frequent itemsets.
</span><span class="n">model</span><span class="p">.</span><span class="n">freqItemsets</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Display generated association rules.
</span><span class="n">model</span><span class="p">.</span><span class="n">associationRules</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># transform examines the input items against all the association rules and summarize the
# consequents as prediction
</span><span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/fpgrowth_example.py" in the Spark repo.</small></div>
  </div>

<div data-lang="r">

    <p>Refer to the <a href="api/R/spark.fpGrowth.html">R API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="c1"># Load training data</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">selectExpr</span><span class="p">(</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">rawItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w">
  </span><span class="s2">"1,2,5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1,2,3,5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1,2"</span><span class="w">
</span><span class="p">))),</span><span class="w"> </span><span class="s2">"split(rawItems, ',') AS items"</span><span class="p">)</span><span class="w">

</span><span class="n">fpm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spark.fpGrowth</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">itemsCol</span><span class="o">=</span><span class="s2">"items"</span><span class="p">,</span><span class="w"> </span><span class="n">minSupport</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">minConfidence</span><span class="o">=</span><span class="m">0.6</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extracting frequent itemsets</span><span class="w">

</span><span class="n">spark.freqItemsets</span><span class="p">(</span><span class="n">fpm</span><span class="p">)</span><span class="w">

</span><span class="c1"># Extracting association rules</span><span class="w">

</span><span class="n">spark.associationRules</span><span class="p">(</span><span class="n">fpm</span><span class="p">)</span><span class="w">

</span><span class="c1"># Predict uses association rules to and combines possible consequents</span><span class="w">

</span><span class="n">predict</span><span class="p">(</span><span class="n">fpm</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/r/ml/fpm.R" in the Spark repo.</small></div>
  </div>

</div>

<h2 id="prefixspan">PrefixSpan</h2>

<p>PrefixSpan is a sequential pattern mining algorithm described in
<a href="https://doi.org/10.1109%2FTKDE.2004.77">Pei et al., Mining Sequential Patterns by Pattern-Growth: The
PrefixSpan Approach</a>. We refer
the reader to the referenced paper for formalizing the sequential
pattern mining problem.</p>

<p><code class="language-plaintext highlighter-rouge">spark.ml</code>&#8217;s PrefixSpan implementation takes the following parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">minSupport</code>: the minimum support required to be considered a frequent
sequential pattern.</li>
  <li><code class="language-plaintext highlighter-rouge">maxPatternLength</code>: the maximum length of a frequent sequential
pattern. Any frequent pattern exceeding this length will not be
included in the results.</li>
  <li><code class="language-plaintext highlighter-rouge">maxLocalProjDBSize</code>: the maximum number of items allowed in a
prefix-projected database before local iterative processing of the
projected database begins. This parameter should be tuned with respect
to the size of your executors.</li>
  <li><code class="language-plaintext highlighter-rouge">sequenceCol</code>: the name of the sequence column in dataset (default &#8220;sequence&#8221;), rows with
nulls in this column are ignored.</li>
</ul>

<p><strong>Examples</strong></p>

<div class="codetabs">

<div data-lang="scala">
    <p>Refer to the <a href="api/scala/org/apache/spark/ml/fpm/PrefixSpan.html">Scala API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.fpm.PrefixSpan</span>

<span class="k">val</span> <span class="nv">smallTestData</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">3</span><span class="o">)),</span>
  <span class="nc">Seq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)),</span>
  <span class="nc">Seq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Seq</span><span class="o">(</span><span class="mi">5</span><span class="o">)),</span>
  <span class="nc">Seq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span><span class="mi">6</span><span class="o">)))</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">smallTestData</span><span class="o">.</span><span class="py">toDF</span><span class="o">(</span><span class="s">"sequence"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrefixSpan</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setMinSupport</span><span class="o">(</span><span class="mf">0.5</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMaxPatternLength</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMaxLocalProjDBSize</span><span class="o">(</span><span class="mi">32000000</span><span class="o">)</span>
  <span class="o">.</span><span class="py">findFrequentSequentialPatterns</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
  <span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/PrefixSpanExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">
    <p>Refer to the <a href="api/java/org/apache/spark/ml/fpm/PrefixSpan.html">Java API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.fpm.PrefixSpan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">3</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">5</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">6</span><span class="o">)))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span> <span class="k">new</span> <span class="nc">StructField</span><span class="o">(</span>
  <span class="s">"sequence"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayType</span><span class="o">(</span><span class="k">new</span> <span class="nc">ArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="kc">true</span><span class="o">),</span>
  <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">sequenceDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">PrefixSpan</span> <span class="n">prefixSpan</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrefixSpan</span><span class="o">().</span><span class="na">setMinSupport</span><span class="o">(</span><span class="mf">0.5</span><span class="o">).</span><span class="na">setMaxPatternLength</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

<span class="c1">// Finding frequent sequential patterns</span>
<span class="n">prefixSpan</span><span class="o">.</span><span class="na">findFrequentSequentialPatterns</span><span class="o">(</span><span class="n">sequenceDF</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaPrefixSpanExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">
    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.fpm.PrefixSpan">Python API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.fpm</span> <span class="kn">import</span> <span class="n">PrefixSpan</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="n">parallelize</span><span class="p">([</span><span class="n">Row</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]),</span>
                     <span class="n">Row</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]),</span>
                     <span class="n">Row</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]]),</span>
                     <span class="n">Row</span><span class="p">(</span><span class="n">sequence</span><span class="o">=</span><span class="p">[[</span><span class="mi">6</span><span class="p">]])]).</span><span class="n">toDF</span><span class="p">()</span>

<span class="n">prefixSpan</span> <span class="o">=</span> <span class="n">PrefixSpan</span><span class="p">(</span><span class="n">minSupport</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">maxPatternLength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                        <span class="n">maxLocalProjDBSize</span><span class="o">=</span><span class="mi">32000000</span><span class="p">)</span>

<span class="c1"># Find frequent sequential patterns.
</span><span class="n">prefixSpan</span><span class="p">.</span><span class="n">findFrequentSequentialPatterns</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/prefixspan_example.py" in the Spark repo.</small></div>
  </div>

<div data-lang="r">

    <p>Refer to the <a href="api/R/spark.prefixSpan.html">R API docs</a> for more details.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="c1"># Load training data</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createDataFrame</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">3L</span><span class="p">))),</span><span class="w">
                           </span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1L</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">))),</span><span class="w">
                           </span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="m">2L</span><span class="p">),</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">5L</span><span class="p">))),</span><span class="w">
                           </span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="m">6L</span><span class="p">)))),</span><span class="w">
                      </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sequence"</span><span class="p">))</span><span class="w">

</span><span class="c1"># Finding frequent sequential patterns</span><span class="w">
</span><span class="n">frequency</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spark.findFrequentSequentialPatterns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">minSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">maxPatternLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5L</span><span class="p">,</span><span class="w">
                                                  </span><span class="n">maxLocalProjDBSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32000000L</span><span class="p">)</span><span class="w">
</span><span class="n">showDF</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/r/ml/prefixSpan.R" in the Spark repo.</small></div>
  </div>

</div>


                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-3.5.1.min.js"></script>
        <script src="js/vendor/bootstrap.bundle.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
        <script type="text/javascript">
            // DocSearch is entirely free and automated. DocSearch is built in two parts:
            // 1. a crawler which we run on our own infrastructure every 24 hours. It follows every link
            //    in your website and extract content from every page it traverses. It then pushes this
            //    content to an Algolia index.
            // 2. a JavaScript snippet to be inserted in your website that will bind this Algolia index
            //    to your search input and display its results in a dropdown UI. If you want to find more
            //    details on how works DocSearch, check the docs of DocSearch.
            docsearch({
    apiKey: 'b18ca3732c502995563043aa17bc6ecb',
    indexName: 'apache_spark',
    inputSelector: '#docsearch-input',
    enhancedSearchInput: true,
    algoliaOptions: {
      'facetFilters': ["version:3.1.1"]
    },
    debug: false // Set debug to true if you want to inspect the dropdown
});

        </script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    </body>
</html>
