<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Python Programming Guide - Spark 0.8.0 Documentation</title>
        <meta name="description" content="">

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>
        
        <link rel="stylesheet" href="css/pygments-default.css">

        <!-- Google analytics script -->
        <script type="text/javascript">
          /*
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
          */
        </script>

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <div class="navbar navbar-fixed-top" id="topbar">
            <div class="navbar-inner">
                <div class="container">
                    <div class="brand"><a href="index.html">
                      <img src="img/spark-logo-hd.png" style="height:50px;"/></a><span class="version">0.8.0</span>
                    </div>
                    <ul class="nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li><a href="index.html">Overview</a></li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programming Guides<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="quick-start.html">Quick Start</a></li>
                                <li><a href="scala-programming-guide.html">Spark in Scala</a></li>
                                <li><a href="java-programming-guide.html">Spark in Java</a></li>
                                <li><a href="python-programming-guide.html">Spark in Python</a></li>
                                <li class="divider"></li>
                                <li><a href="streaming-programming-guide.html">Spark Streaming</a></li>
                                <li><a href="mllib-guide.html">MLlib (Machine Learning)</a></li>
                                <li><a href="bagel-programming-guide.html">Bagel (Pregel on Spark)</a></li>
                            </ul>
                        </li>
                        
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Docs<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="api/core/index.html">Spark Core for Java/Scala</a></li>
                                <li><a href="api/pyspark/index.html">Spark Core for Python</a></li>
                                <li class="divider"></li>
                                <li><a href="api/streaming/index.html">Spark Streaming</a></li>
                                <li><a href="api/mllib/index.html">MLlib (Machine Learning)</a></li>
                                <li><a href="api/bagel/index.html">Bagel (Pregel on Spark)</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deploying<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="cluster-overview.html">Overview</a></li>
                                <li><a href="ec2-scripts.html">Amazon EC2</a></li>
                                <li><a href="spark-standalone.html">Standalone Mode</a></li>
                                <li><a href="running-on-mesos.html">Mesos</a></li>
                                <li><a href="running-on-yarn.html">YARN</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="api.html" class="dropdown-toggle" data-toggle="dropdown">More<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="configuration.html">Configuration</a></li>
                                <li><a href="monitoring.html">Monitoring</a></li>
                                <li><a href="tuning.html">Tuning Guide</a></li>
                                <li><a href="hadoop-third-party-distributions.html">Running with CDH/HDP</a></li>
                                <li><a href="hardware-provisioning.html">Hardware Provisioning</a></li>
                                <li><a href="job-scheduling.html">Job Scheduling</a></li>
                                <li class="divider"></li>
                                <li><a href="building-with-maven.html">Building Spark with Maven</a></li>
                                <li><a href="https://cwiki.apache.org/confluence/display/SPARK/Contributing+to+Spark">Contributing to Spark</a></li>
                            </ul>
                        </li>
                    </ul>
                    <!--<p class="navbar-text pull-right"><span class="version-text">v0.8.0</span></p>-->
                </div>
            </div>
        </div>

        <div class="container" id="content">
          <h1 class="title">Python Programming Guide</h1>

          <p>The Spark Python API (PySpark) exposes the Spark programming model to Python.
To learn the basics of Spark, we recommend reading through the
<a href="scala-programming-guide.html">Scala programming guide</a> first; it should be
easy to follow even if you don&#8217;t know Scala.
This guide will show how to use the Spark features described there in Python.</p>

<h1 id="key-differences-in-the-python-api">Key Differences in the Python API</h1>

<p>There are a few key differences between the Python and Scala APIs:</p>

<ul>
  <li>Python is dynamically typed, so RDDs can hold objects of multiple types.</li>
  <li>PySpark does not yet support a few API calls, such as <code>lookup</code>, <code>sort</code>, and non-text input files, though these will be added in future releases.</li>
</ul>

<p>In PySpark, RDDs support the same methods as their Scala counterparts but take Python functions and return Python collection types.
Short functions can be passed to RDD methods using Python&#8217;s <a href="http://www.diveintopython.net/power_of_introspection/lambda_functions.html"><code>lambda</code></a> syntax:</p>

<div class="highlight"><pre><code class="python"><span class="n">logData</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">logFile</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="s">&quot;ERROR&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
</code></pre></div>

<p>You can also pass functions that are defined with the <code>def</code> keyword; this is useful for longer functions that can&#8217;t be expressed using <code>lambda</code>:</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">is_error</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;ERROR&quot;</span> <span class="ow">in</span> <span class="n">line</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_error</span><span class="p">)</span>
</code></pre></div>

<p>Functions can access objects in enclosing scopes, although modifications to those objects within RDD methods will not be propagated back:</p>

<div class="highlight"><pre><code class="python"><span class="n">error_keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Exception&quot;</span><span class="p">,</span> <span class="s">&quot;Error&quot;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">is_error</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">error_keywords</span><span class="p">)</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">logData</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_error</span><span class="p">)</span>
</code></pre></div>

<p>PySpark will automatically ship these functions to workers, along with any objects that they reference.
Instances of classes will be serialized and shipped to workers by PySpark, but classes themselves cannot be automatically distributed to workers.
The <a href="#standalone-use">Standalone Use</a> section describes how to ship code dependencies to workers.</p>

<p>In addition, PySpark fully supports interactive use&#8212;simply run <code>./pyspark</code> to launch an interactive shell.</p>

<h1 id="installing-and-configuring-pyspark">Installing and Configuring PySpark</h1>

<p>PySpark requires Python 2.6 or higher.
PySpark applications are executed using a standard CPython interpreter in order to support Python modules that use C extensions.
We have not tested PySpark with Python 3 or with alternative Python interpreters, such as <a href="http://pypy.org/">PyPy</a> or <a href="http://www.jython.org/">Jython</a>.</p>

<p>By default, PySpark requires <code>python</code> to be available on the system <code>PATH</code> and use it to run programs; an alternate Python executable may be specified by setting the <code>PYSPARK_PYTHON</code> environment variable in <code>conf/spark-env.sh</code> (or <code>.cmd</code> on Windows).</p>

<p>All of PySpark&#8217;s library dependencies, including <a href="http://py4j.sourceforge.net/">Py4J</a>, are bundled with PySpark and automatically imported.</p>

<p>Standalone PySpark applications should be run using the <code>pyspark</code> script, which automatically configures the Java and Python environment using the settings in <code>conf/spark-env.sh</code> or <code>.cmd</code>.
The script automatically adds the <code>pyspark</code> package to the <code>PYTHONPATH</code>.</p>

<h1 id="interactive-use">Interactive Use</h1>

<p>The <code>pyspark</code> script launches a Python interpreter that is configured to run PySpark applications. To use <code>pyspark</code> interactively, first build Spark, then launch it directly from the command line without any options:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>sbt/sbt assembly
<span class="nv">$ </span>./pyspark
</code></pre></div>

<p>The Python shell can be used explore data interactively and is a simple way to learn the API:</p>

<div class="highlight"><pre><code class="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">words</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">words</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">w</span><span class="p">:</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;spar&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="p">[</span><span class="s">u&#39;spar&#39;</span><span class="p">,</span> <span class="s">u&#39;sparable&#39;</span><span class="p">,</span> <span class="s">u&#39;sparada&#39;</span><span class="p">,</span> <span class="s">u&#39;sparadrap&#39;</span><span class="p">,</span> <span class="s">u&#39;sparagrass&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">help</span><span class="p">(</span><span class="n">pyspark</span><span class="p">)</span> <span class="c"># Show all pyspark functions</span>
</code></pre></div>

<p>By default, the <code>pyspark</code> shell creates SparkContext that runs applications locally on a single core.
To connect to a non-local cluster, or use multiple cores, set the <code>MASTER</code> environment variable.
For example, to use the <code>pyspark</code> shell with a <a href="spark-standalone.html">standalone Spark cluster</a>:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ MASTER</span><span class="o">=</span>spark://IP:PORT ./pyspark
</code></pre></div>

<p>Or, to use four cores on the local machine:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ MASTER</span><span class="o">=</span><span class="nb">local</span><span class="o">[</span>4<span class="o">]</span> ./pyspark
</code></pre></div>

<h2 id="ipython">IPython</h2>

<p>It is also possible to launch PySpark in <a href="http://ipython.org">IPython</a>, the enhanced Python interpreter.
To do this, set the <code>IPYTHON</code> variable to <code>1</code> when running <code>pyspark</code>:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ IPYTHON</span><span class="o">=</span>1 ./pyspark
</code></pre></div>

<p>Alternatively, you can customize the <code>ipython</code> command by setting <code>IPYTHON_OPTS</code>. For example, to launch
the <a href="http://ipython.org/notebook.html">IPython Notebook</a> with PyLab graphing support:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ IPYTHON_OPTS</span><span class="o">=</span><span class="s2">&quot;notebook --pylab inline&quot;</span> ./pyspark
</code></pre></div>

<p>IPython also works on a cluster or on multiple cores if you set the <code>MASTER</code> environment variable.</p>

<h1 id="standalone-programs">Standalone Programs</h1>

<p>PySpark can also be used from standalone Python scripts by creating a SparkContext in your script and running the script using <code>pyspark</code>.
The Quick Start guide includes a <a href="quick-start.html#a-standalone-app-in-python">complete example</a> of a standalone Python application.</p>

<p>Code dependencies can be deployed by listing them in the <code>pyFiles</code> option in the SparkContext constructor:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkContext</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="s">&quot;local&quot;</span><span class="p">,</span> <span class="s">&quot;App Name&quot;</span><span class="p">,</span> <span class="n">pyFiles</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;MyFile.py&#39;</span><span class="p">,</span> <span class="s">&#39;lib.zip&#39;</span><span class="p">,</span> <span class="s">&#39;app.egg&#39;</span><span class="p">])</span>
</code></pre></div>

<p>Files listed here will be added to the <code>PYTHONPATH</code> and shipped to remote worker machines.
Code dependencies can be added to an existing SparkContext using its <code>addPyFile()</code> method.</p>

<h1 id="api-docs">API Docs</h1>

<p><a href="api/pyspark/index.html">API documentation</a> for PySpark is available as Epydoc.
Many of the methods also contain <a href="http://docs.python.org/2/library/doctest.html">doctests</a> that provide additional usage examples.</p>

<h1 id="where-to-go-from-here">Where to Go from Here</h1>

<p>PySpark also includes several sample programs in the <a href="https://github.com/apache/incubator-spark/tree/master/python/examples"><code>python/examples</code> folder</a>.
You can run them by passing the files to <code>pyspark</code>; e.g.:</p>

<pre><code>./pyspark python/examples/wordcount.py
</code></pre>

<p>Each program prints usage help when run without arguments.</p>

            <!-- Main hero unit for a primary marketing message or call to action -->
            <!--<div class="hero-unit">
                <h1>Hello, world!</h1>
                <p>This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
                <p><a class="btn btn-primary btn-large">Learn more &raquo;</a></p>
            </div>-->

            <!-- Example row of columns -->
            <!--<div class="row">
                <div class="span4">
                    <h2>Heading</h2>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                    <p><a class="btn" href="#">View details &raquo;</a></p>
                </div>
                <div class="span4">
                    <h2>Heading</h2>
                    <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
                    <p><a class="btn" href="#">View details &raquo;</a></p>
               </div>
                <div class="span4">
                    <h2>Heading</h2>
                    <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p>
                    <p><a class="btn" href="#">View details &raquo;</a></p>
                </div>
            </div>

            <hr>-->

            <footer>
              <hr>
              <p style="text-align: center; veritcal-align: middle; color: #999;">
                Apache Spark is an effort undergoing incubation at the Apache Software Foundation.
                <a href="http://incubator.apache.org">
                  <img style="margin-left: 20px;" src="img/incubator-logo.png" />
                </a>
              </p>
            </footer>

        </div> <!-- /container -->

        <script src="js/vendor/jquery-1.8.0.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/main.js"></script>
        
        <!-- A script to fix internal hash links because we have an overlapping top bar.
             Based on https://github.com/twitter/bootstrap/issues/193#issuecomment-2281510 -->
        <script>
          $(function() {
            function maybeScrollToHash() {
              if (window.location.hash && $(window.location.hash).length) {
                var newTop = $(window.location.hash).offset().top - $('#topbar').height() - 5;
                $(window).scrollTop(newTop);
              }
            }
            $(window).bind('hashchange', function() {
              maybeScrollToHash();
            });
            // Scroll now too in case we had opened the page on a hash, but wait 1 ms because some browsers
            // will try to do *their* initial scroll after running the onReady handler.
            setTimeout(function() { maybeScrollToHash(); }, 1)
          })
        </script>

    </body>
</html>
