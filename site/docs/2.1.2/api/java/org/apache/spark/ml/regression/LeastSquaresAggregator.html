<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.7.0_151) on Mon Oct 02 14:47:24 PDT 2017 -->
<title>LeastSquaresAggregator (Spark 2.1.2 JavaDoc)</title>
<meta name="date" content="2017-10-02">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LeastSquaresAggregator (Spark 2.1.2 JavaDoc)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/spark/ml/regression/IsotonicRegressionModel.html" title="class in org.apache.spark.ml.regression"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresCostFun.html" title="class in org.apache.spark.ml.regression"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/spark/ml/regression/LeastSquaresAggregator.html" target="_top">Frames</a></li>
<li><a href="LeastSquaresAggregator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.spark.ml.regression</div>
<h2 title="Class LeastSquaresAggregator" class="title">Class LeastSquaresAggregator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>Object</li>
<li>
<ul class="inheritance">
<li>org.apache.spark.ml.regression.LeastSquaresAggregator</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.io.Serializable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">LeastSquaresAggregator</span>
extends Object
implements scala.Serializable</pre>
<div class="block">LeastSquaresAggregator computes the gradient and loss for a Least-squared loss function,
 as used in linear regression for samples in sparse or dense vector in an online fashion.
 <p>
 Two LeastSquaresAggregator can be merged together to have a summary of loss and gradient of
 the corresponding joint dataset.
 <p>
 For improving the convergence rate during the optimization process, and also preventing against
 features with very large variances exerting an overly large influence during model training,
 package like R's GLMNET performs the scaling to unit variance and removing the mean to reduce
 the condition number, and then trains the model in scaled space but returns the coefficients in
 the original scale. See page 9 in http://cran.r-project.org/web/packages/glmnet/glmnet.pdf
 <p>
 However, we don't want to apply the <code>StandardScaler</code> on the training dataset, and then cache
 the standardized dataset since it will create a lot of overhead. As a result, we perform the
 scaling implicitly when we compute the objective function. The following is the mathematical
 derivation.
 <p>
 Note that we don't deal with intercept by adding bias here, because the intercept
 can be computed using closed form after the coefficients are converged.
 See this discussion for detail.
 http://stats.stackexchange.com/questions/13617/how-is-the-intercept-computed-in-glmnet
 <p>
 When training with intercept enabled,
 The objective function in the scaled space is given by
 <p>
 <blockquote>
    $$
    L = 1/2n ||\sum_i w_i(x_i - \bar{x_i}) / \hat{x_i} - (y - \bar{y}) / \hat{y}||^2,
    $$
 </blockquote>
 <p>
 where $\bar{x_i}$ is the mean of $x_i$, $\hat{x_i}$ is the standard deviation of $x_i$,
 $\bar{y}$ is the mean of label, and $\hat{y}$ is the standard deviation of label.
 <p>
 If we fitting the intercept disabled (that is forced through 0.0),
 we can use the same equation except we set $\bar{y}$ and $\bar{x_i}$ to 0 instead
 of the respective means.
 <p>
 This can be rewritten as
 <p>
 <blockquote>
    $$
    \begin{align}
     L &amp;= 1/2n ||\sum_i (w_i/\hat{x_i})x_i - \sum_i (w_i/\hat{x_i})\bar{x_i} - y / \hat{y}
          + \bar{y} / \hat{y}||^2 \\
       &amp;= 1/2n ||\sum_i w_i^\prime x_i - y / \hat{y} + offset||^2 = 1/2n diff^2
    \end{align}
    $$
 </blockquote>
 <p>
 where $w_i^\prime$ is the effective coefficients defined by $w_i/\hat{x_i}$, offset is
 <p>
 <blockquote>
    $$
    - \sum_i (w_i/\hat{x_i})\bar{x_i} + \bar{y} / \hat{y}.
    $$
 </blockquote>
 <p>
 and diff is
 <p>
 <blockquote>
    $$
    \sum_i w_i^\prime x_i - y / \hat{y} + offset
    $$
 </blockquote>
 <p>
 Note that the effective coefficients and offset don't depend on training dataset,
 so they can be precomputed.
 <p>
 Now, the first derivative of the objective function in scaled space is
 <p>
 <blockquote>
    $$
    \frac{\partial L}{\partial w_i} = diff/N (x_i - \bar{x_i}) / \hat{x_i}
    $$
 </blockquote>
 <p>
 However, $(x_i - \bar{x_i})$ will densify the computation, so it's not
 an ideal formula when the training dataset is sparse format.
 <p>
 This can be addressed by adding the dense $\bar{x_i} / \hat{x_i}$ terms
 in the end by keeping the sum of diff. The first derivative of total
 objective function from all the samples is
 <p>
 <blockquote>
    $$
    \begin{align}
       \frac{\partial L}{\partial w_i} &amp;=
           1/N \sum_j diff_j (x_{ij} - \bar{x_i}) / \hat{x_i} \\
         &amp;= 1/N ((\sum_j diff_j x_{ij} / \hat{x_i}) - diffSum \bar{x_i} / \hat{x_i}) \\
         &amp;= 1/N ((\sum_j diff_j x_{ij} / \hat{x_i}) + correction_i)
    \end{align}
    $$
 </blockquote>
 <p>
 where $correction_i = - diffSum \bar{x_i} / \hat{x_i}$
 <p>
 A simple math can show that diffSum is actually zero, so we don't even
 need to add the correction terms in the end. From the definition of diff,
 <p>
 <blockquote>
    $$
    \begin{align}
       diffSum &amp;= \sum_j (\sum_i w_i(x_{ij} - \bar{x_i})
                    / \hat{x_i} - (y_j - \bar{y}) / \hat{y}) \\
         &amp;= N * (\sum_i w_i(\bar{x_i} - \bar{x_i}) / \hat{x_i} - (\bar{y} - \bar{y}) / \hat{y}) \\
         &amp;= 0
    \end{align}
    $$
 </blockquote>
 <p>
 As a result, the first derivative of the total objective function only depends on
 the training dataset, which can be easily computed in distributed fashion, and is
 sparse format friendly.
 <p>
 <blockquote>
    $$
    \frac{\partial L}{\partial w_i} = 1/N ((\sum_j diff_j x_{ij} / \hat{x_i})
    $$
 </blockquote>
 <p>
 param:  bcCoefficients The broadcast coefficients corresponding to the features.
 param:  labelStd The standard deviation value of the label.
 param:  labelMean The mean value of the label.
 param:  fitIntercept Whether to fit an intercept term.
 param:  bcFeaturesStd The broadcast standard deviation values of the features.
 param:  bcFeaturesMean The broadcast mean values of the features.</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../serialized-form.html#org.apache.spark.ml.regression.LeastSquaresAggregator">Serialized Form</a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#LeastSquaresAggregator(org.apache.spark.broadcast.Broadcast,%20double,%20double,%20boolean,%20org.apache.spark.broadcast.Broadcast,%20org.apache.spark.broadcast.Broadcast)">LeastSquaresAggregator</a></strong>(<a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;<a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a>&gt;&nbsp;bcCoefficients,
                      double&nbsp;labelStd,
                      double&nbsp;labelMean,
                      boolean&nbsp;fitIntercept,
                      <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesStd,
                      <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesMean)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#add(org.apache.spark.ml.feature.Instance)">add</a></strong>(org.apache.spark.ml.feature.Instance&nbsp;instance)</code>
<div class="block">Add a new training instance to this LeastSquaresAggregator, and update the loss and gradient
 of the objective function.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#count()">count</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#gradient()">gradient</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>double</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#loss()">loss</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html#merge(org.apache.spark.ml.regression.LeastSquaresAggregator)">merge</a></strong>(<a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a>&nbsp;other)</code>
<div class="block">Merge another LeastSquaresAggregator, and update the loss and gradient
 of the objective function.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="LeastSquaresAggregator(org.apache.spark.broadcast.Broadcast, double, double, boolean, org.apache.spark.broadcast.Broadcast, org.apache.spark.broadcast.Broadcast)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LeastSquaresAggregator</h4>
<pre>public&nbsp;LeastSquaresAggregator(<a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;<a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a>&gt;&nbsp;bcCoefficients,
                      double&nbsp;labelStd,
                      double&nbsp;labelMean,
                      boolean&nbsp;fitIntercept,
                      <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesStd,
                      <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesMean)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="add(org.apache.spark.ml.feature.Instance)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>add</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a>&nbsp;add(org.apache.spark.ml.feature.Instance&nbsp;instance)</pre>
<div class="block">Add a new training instance to this LeastSquaresAggregator, and update the loss and gradient
 of the objective function.
 <p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>instance</code> - The instance of data point to be added.</dd>
<dt><span class="strong">Returns:</span></dt><dd>This LeastSquaresAggregator object.</dd></dl>
</li>
</ul>
<a name="merge(org.apache.spark.ml.regression.LeastSquaresAggregator)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>merge</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a>&nbsp;merge(<a href="../../../../../org/apache/spark/ml/regression/LeastSquaresAggregator.html" title="class in org.apache.spark.ml.regression">LeastSquaresAggregator</a>&nbsp;other)</pre>
<div class="block">Merge another LeastSquaresAggregator, and update the loss and gradient
 of the objective function.
 (Note that it's in place merging; as a result, <code>this</code> object will be modified.)
 <p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>other</code> - The other LeastSquaresAggregator to be merged.</dd>
<dt><span class="strong">Returns:</span></dt><dd>This LeastSquaresAggregator object.</dd></dl>
</li>
</ul>
<a name="count()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>count</h4>
<pre>public&nbsp;long&nbsp;count()</pre>
</li>
</ul>
<a name="loss()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loss</h4>
<pre>public&nbsp;double&nbsp;loss()</pre>
</li>
</ul>
<a name="gradient()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>gradient</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a>&nbsp;gradient()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/spark/ml/regression/IsotonicRegressionModel.html" title="class in org.apache.spark.ml.regression"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/spark/ml/regression/LeastSquaresCostFun.html" title="class in org.apache.spark.ml.regression"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/spark/ml/regression/LeastSquaresAggregator.html" target="_top">Frames</a></li>
<li><a href="LeastSquaresAggregator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<script defer="defer" type="text/javascript" src="../../../../../lib/jquery.js"></script><script defer="defer" type="text/javascript" src="../../../../../lib/api-javadocs.js"></script></body>
</html>
