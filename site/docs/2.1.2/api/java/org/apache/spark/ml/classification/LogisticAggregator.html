<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.7.0_151) on Mon Oct 02 14:47:25 PDT 2017 -->
<title>LogisticAggregator (Spark 2.1.2 JavaDoc)</title>
<meta name="date" content="2017-10-02">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LogisticAggregator (Spark 2.1.2 JavaDoc)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/spark/ml/classification/LabelConverter.html" title="class in org.apache.spark.ml.classification"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/spark/ml/classification/LogisticCostFun.html" title="class in org.apache.spark.ml.classification"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/spark/ml/classification/LogisticAggregator.html" target="_top">Frames</a></li>
<li><a href="LogisticAggregator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.spark.ml.classification</div>
<h2 title="Class LogisticAggregator" class="title">Class LogisticAggregator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>Object</li>
<li>
<ul class="inheritance">
<li>org.apache.spark.ml.classification.LogisticAggregator</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.io.Serializable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">LogisticAggregator</span>
extends Object
implements scala.Serializable</pre>
<div class="block">LogisticAggregator computes the gradient and loss for binary or multinomial logistic (softmax)
 loss function, as used in classification for instances in sparse or dense vector in an online
 fashion.
 <p>
 Two LogisticAggregators can be merged together to have a summary of loss and gradient of
 the corresponding joint dataset.
 <p>
 For improving the convergence rate during the optimization process and also to prevent against
 features with very large variances exerting an overly large influence during model training,
 packages like R's GLMNET perform the scaling to unit variance and remove the mean in order to
 reduce the condition number. The model is then trained in this scaled space, but returns the
 coefficients in the original scale. See page 9 in
 http://cran.r-project.org/web/packages/glmnet/glmnet.pdf
 <p>
 However, we don't want to apply the <a href="../../../../../org/apache/spark/ml/feature/StandardScaler.html" title="class in org.apache.spark.ml.feature"><code>StandardScaler</code></a> on the
 training dataset, and then cache the standardized dataset since it will create a lot of overhead.
 As a result, we perform the scaling implicitly when we compute the objective function (though
 we do not subtract the mean).
 <p>
 Note that there is a difference between multinomial (softmax) and binary loss. The binary case
 uses one outcome class as a "pivot" and regresses the other class against the pivot. In the
 multinomial case, the softmax loss function is used to model each class probability
 independently. Using softmax loss produces <code>K</code> sets of coefficients, while using a pivot class
 produces <code>K - 1</code> sets of coefficients (a single coefficient vector in the binary case). In the
 binary case, we can say that the coefficients are shared between the positive and negative
 classes. When regularization is applied, multinomial (softmax) loss will produce a result
 different from binary loss since the positive and negative don't share the coefficients while the
 binary regression shares the coefficients between positive and negative.
 <p>
 The following is a mathematical derivation for the multinomial (softmax) loss.
 <p>
 The probability of the multinomial outcome $y$ taking on any of the K possible outcomes is:
 <p>
 <blockquote>
    $$
    P(y_i=0|\vec{x}_i, \beta) = \frac{e^{\vec{x}_i^T \vec{\beta}_0}}{\sum_{k=0}^{K-1}
       e^{\vec{x}_i^T \vec{\beta}_k}} \\
    P(y_i=1|\vec{x}_i, \beta) = \frac{e^{\vec{x}_i^T \vec{\beta}_1}}{\sum_{k=0}^{K-1}
       e^{\vec{x}_i^T \vec{\beta}_k}}\\
    P(y_i=K-1|\vec{x}_i, \beta) = \frac{e^{\vec{x}_i^T \vec{\beta}_{K-1}}\,}{\sum_{k=0}^{K-1}
       e^{\vec{x}_i^T \vec{\beta}_k}}
    $$
 </blockquote>
 <p>
 The model coefficients $\beta = (\beta_0, \beta_1, \beta_2, ..., \beta_{K-1})$ become a matrix
 which has dimension of $K \times (N+1)$ if the intercepts are added. If the intercepts are not
 added, the dimension will be $K \times N$.
 <p>
 Note that the coefficients in the model above lack identifiability. That is, any constant scalar
 can be added to all of the coefficients and the probabilities remain the same.
 <p>
 <blockquote>
    $$
    \begin{align}
    \frac{e^{\vec{x}_i^T \left(\vec{\beta}_0 + \vec{c}\right)}}{\sum_{k=0}^{K-1}
       e^{\vec{x}_i^T \left(\vec{\beta}_k + \vec{c}\right)}}
    = \frac{e^{\vec{x}_i^T \vec{\beta}_0}e^{\vec{x}_i^T \vec{c}}\,}{e^{\vec{x}_i^T \vec{c}}
       \sum_{k=0}^{K-1} e^{\vec{x}_i^T \vec{\beta}_k}}
    = \frac{e^{\vec{x}_i^T \vec{\beta}_0}}{\sum_{k=0}^{K-1} e^{\vec{x}_i^T \vec{\beta}_k}}
    \end{align}
    $$
 </blockquote>
 <p>
 However, when regularization is added to the loss function, the coefficients are indeed
 identifiable because there is only one set of coefficients which minimizes the regularization
 term. When no regularization is applied, we choose the coefficients with the minimum L2
 penalty for consistency and reproducibility. For further discussion see:
 <p>
 Friedman, et al. "Regularization Paths for Generalized Linear Models via Coordinate Descent"
 <p>
 The loss of objective function for a single instance of data (we do not include the
 regularization term here for simplicity) can be written as
 <p>
 <blockquote>
    $$
    \begin{align}
    \ell\left(\beta, x_i\right) &amp;= -log{P\left(y_i \middle| \vec{x}_i, \beta\right)} \\
    &amp;= log\left(\sum_{k=0}^{K-1}e^{\vec{x}_i^T \vec{\beta}_k}\right) - \vec{x}_i^T \vec{\beta}_y\\
    &amp;= log\left(\sum_{k=0}^{K-1} e^{margins_k}\right) - margins_y
    \end{align}
    $$
 </blockquote>
 <p>
 where ${margins}_k = \vec{x}_i^T \vec{\beta}_k$.
 <p>
 For optimization, we have to calculate the first derivative of the loss function, and a simple
 calculation shows that
 <p>
 <blockquote>
    $$
    \begin{align}
    \frac{\partial \ell(\beta, \vec{x}_i, w_i)}{\partial \beta_{j, k}}
    &amp;= x_{i,j} \cdot w_i \cdot \left(\frac{e^{\vec{x}_i \cdot \vec{\beta}_k}}{\sum_{k'=0}^{K-1}
      e^{\vec{x}_i \cdot \vec{\beta}_{k'}}\,} - I_{y=k}\right) \\
    &amp;= x_{i, j} \cdot w_i \cdot multiplier_k
    \end{align}
    $$
 </blockquote>
 <p>
 where $w_i$ is the sample weight, $I_{y=k}$ is an indicator function
 <p>
  <blockquote>
    $$
    I_{y=k} = \begin{cases}
          1 &amp; y = k \\
          0 &amp; else
       \end{cases}
    $$
 </blockquote>
 <p>
 and
 <p>
 <blockquote>
    $$
    multiplier_k = \left(\frac{e^{\vec{x}_i \cdot \vec{\beta}_k}}{\sum_{k=0}^{K-1}
       e^{\vec{x}_i \cdot \vec{\beta}_k}} - I_{y=k}\right)
    $$
 </blockquote>
 <p>
 If any of margins is larger than 709.78, the numerical computation of multiplier and loss
 function will suffer from arithmetic overflow. This issue occurs when there are outliers in
 data which are far away from the hyperplane, and this will cause the failing of training once
 infinity is introduced. Note that this is only a concern when max(margins) &amp;gt; 0.
 <p>
 Fortunately, when max(margins) = maxMargin &amp;gt; 0, the loss function and the multiplier can
 easily be rewritten into the following equivalent numerically stable formula.
 <p>
 <blockquote>
    $$
    \ell\left(\beta, x\right) = log\left(\sum_{k=0}^{K-1} e^{margins_k - maxMargin}\right) -
       margins_{y} + maxMargin
    $$
 </blockquote>
 <p>
 Note that each term, $(margins_k - maxMargin)$ in the exponential is no greater than zero; as a
 result, overflow will not happen with this formula.
 <p>
 For $multiplier$, a similar trick can be applied as the following,
 <p>
 <blockquote>
    $$
    multiplier_k = \left(\frac{e^{\vec{x}_i \cdot \vec{\beta}_k - maxMargin}}{\sum_{k'=0}^{K-1}
       e^{\vec{x}_i \cdot \vec{\beta}_{k'} - maxMargin}} - I_{y=k}\right)
    $$
 </blockquote>
 <p>
 param:  bcCoefficients The broadcast coefficients corresponding to the features.
 param:  bcFeaturesStd The broadcast standard deviation values of the features.
 param:  numClasses the number of possible outcomes for k classes classification problem in
                   Multinomial Logistic Regression.
 param:  fitIntercept Whether to fit an intercept term.
 param:  multinomial Whether to use multinomial (softmax) or binary loss
 <p></div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../../serialized-form.html#org.apache.spark.ml.classification.LogisticAggregator">Serialized Form</a></dd><dt><span class="strong">Note:</span></dt>
  <dd>In order to avoid unnecessary computation during calculation of the gradient updates
 we lay out the coefficients in column major order during training. This allows us to
 perform feature standardization once, while still retaining sequential memory access
 for speed. We convert back to row major order when we create the model,
 since this form is optimal for the matrix operations used for prediction.</dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html#LogisticAggregator(org.apache.spark.broadcast.Broadcast,%20org.apache.spark.broadcast.Broadcast,%20int,%20boolean,%20boolean)">LogisticAggregator</a></strong>(<a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;<a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a>&gt;&nbsp;bcCoefficients,
                  <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesStd,
                  int&nbsp;numClasses,
                  boolean&nbsp;fitIntercept,
                  boolean&nbsp;multinomial)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html#add(org.apache.spark.ml.feature.Instance)">add</a></strong>(org.apache.spark.ml.feature.Instance&nbsp;instance)</code>
<div class="block">Add a new training instance to this LogisticAggregator, and update the loss and gradient
 of the objective function.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/linalg/Matrix.html" title="interface in org.apache.spark.ml.linalg">Matrix</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html#gradient()">gradient</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>double</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html#loss()">loss</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a></code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html#merge(org.apache.spark.ml.classification.LogisticAggregator)">merge</a></strong>(<a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a>&nbsp;other)</code>
<div class="block">Merge another LogisticAggregator, and update the loss and gradient
 of the objective function.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="LogisticAggregator(org.apache.spark.broadcast.Broadcast, org.apache.spark.broadcast.Broadcast, int, boolean, boolean)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LogisticAggregator</h4>
<pre>public&nbsp;LogisticAggregator(<a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;<a href="../../../../../org/apache/spark/ml/linalg/Vector.html" title="interface in org.apache.spark.ml.linalg">Vector</a>&gt;&nbsp;bcCoefficients,
                  <a href="../../../../../org/apache/spark/broadcast/Broadcast.html" title="class in org.apache.spark.broadcast">Broadcast</a>&lt;double[]&gt;&nbsp;bcFeaturesStd,
                  int&nbsp;numClasses,
                  boolean&nbsp;fitIntercept,
                  boolean&nbsp;multinomial)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="add(org.apache.spark.ml.feature.Instance)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>add</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a>&nbsp;add(org.apache.spark.ml.feature.Instance&nbsp;instance)</pre>
<div class="block">Add a new training instance to this LogisticAggregator, and update the loss and gradient
 of the objective function.
 <p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>instance</code> - The instance of data point to be added.</dd>
<dt><span class="strong">Returns:</span></dt><dd>This LogisticAggregator object.</dd></dl>
</li>
</ul>
<a name="merge(org.apache.spark.ml.classification.LogisticAggregator)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>merge</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a>&nbsp;merge(<a href="../../../../../org/apache/spark/ml/classification/LogisticAggregator.html" title="class in org.apache.spark.ml.classification">LogisticAggregator</a>&nbsp;other)</pre>
<div class="block">Merge another LogisticAggregator, and update the loss and gradient
 of the objective function.
 (Note that it's in place merging; as a result, <code>this</code> object will be modified.)
 <p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>other</code> - The other LogisticAggregator to be merged.</dd>
<dt><span class="strong">Returns:</span></dt><dd>This LogisticAggregator object.</dd></dl>
</li>
</ul>
<a name="loss()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>loss</h4>
<pre>public&nbsp;double&nbsp;loss()</pre>
</li>
</ul>
<a name="gradient()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>gradient</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/spark/ml/linalg/Matrix.html" title="interface in org.apache.spark.ml.linalg">Matrix</a>&nbsp;gradient()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/spark/ml/classification/LabelConverter.html" title="class in org.apache.spark.ml.classification"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/spark/ml/classification/LogisticCostFun.html" title="class in org.apache.spark.ml.classification"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/spark/ml/classification/LogisticAggregator.html" target="_top">Frames</a></li>
<li><a href="LogisticAggregator.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<script defer="defer" type="text/javascript" src="../../../../../lib/jquery.js"></script><script defer="defer" type="text/javascript" src="../../../../../lib/api-javadocs.js"></script></body>
</html>
