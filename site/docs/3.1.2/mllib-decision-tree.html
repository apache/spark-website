
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Decision Trees - RDD-based API - Spark 3.1.2 Documentation</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <link rel="stylesheet" href="css/docsearch.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light" id="topbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="navbar-brand"><a href="index.html">
                        <img src="img/spark-logo-hd.png" style="height:50px;"/></a><span class="version">3.1.2</span>
                    </div>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarCollapse" aria-controls="navbarCollapse"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li class="nav-item"><a href="index.html" class="nav-link">Overview</a></li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarQuickStart" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming Guides</a>
                            <div class="dropdown-menu" aria-labelledby="navbarQuickStart">
                                <a class="dropdown-item" href="quick-start.html">Quick Start</a>
                                <a class="dropdown-item" href="rdd-programming-guide.html">RDDs, Accumulators, Broadcasts Vars</a>
                                <a class="dropdown-item" href="sql-programming-guide.html">SQL, DataFrames, and Datasets</a>
                                <a class="dropdown-item" href="structured-streaming-programming-guide.html">Structured Streaming</a>
                                <a class="dropdown-item" href="streaming-programming-guide.html">Spark Streaming (DStreams)</a>
                                <a class="dropdown-item" href="ml-guide.html">MLlib (Machine Learning)</a>
                                <a class="dropdown-item" href="graphx-programming-guide.html">GraphX (Graph Processing)</a>
                                <a class="dropdown-item" href="sparkr.html">SparkR (R on Spark)</a>
                                <a class="dropdown-item" href="api/python/getting_started/index.html">PySpark (Python on Spark)</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarAPIDocs" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API Docs</a>
                            <div class="dropdown-menu" aria-labelledby="navbarAPIDocs">
                                <a class="dropdown-item" href="api/scala/org/apache/spark/index.html">Scala</a>
                                <a class="dropdown-item" href="api/java/index.html">Java</a>
                                <a class="dropdown-item" href="api/python/index.html">Python</a>
                                <a class="dropdown-item" href="api/R/index.html">R</a>
                                <a class="dropdown-item" href="api/sql/index.html">SQL, Built-in Functions</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarDeploying" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Deploying</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDeploying">
                                <a class="dropdown-item" href="cluster-overview.html">Overview</a>
                                <a class="dropdown-item" href="submitting-applications.html">Submitting Applications</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="spark-standalone.html">Spark Standalone</a>
                                <a class="dropdown-item" href="running-on-mesos.html">Mesos</a>
                                <a class="dropdown-item" href="running-on-yarn.html">YARN</a>
                                <a class="dropdown-item" href="running-on-kubernetes.html">Kubernetes</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarMore" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
                            <div class="dropdown-menu" aria-labelledby="navbarMore">
                                <a class="dropdown-item" href="configuration.html">Configuration</a>
                                <a class="dropdown-item" href="monitoring.html">Monitoring</a>
                                <a class="dropdown-item" href="tuning.html">Tuning Guide</a>
                                <a class="dropdown-item" href="job-scheduling.html">Job Scheduling</a>
                                <a class="dropdown-item" href="security.html">Security</a>
                                <a class="dropdown-item" href="hardware-provisioning.html">Hardware Provisioning</a>
                                <a class="dropdown-item" href="migration-guide.html">Migration Guide</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="building-spark.html">Building Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/contributing.html">Contributing to Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/third-party-projects.html">Third Party Projects</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <input type="text" id="docsearch-input" placeholder="Search the docsâ€¦">
                        </li>
                    </ul>
                    <!--<span class="navbar-text navbar-right"><span class="version-text">v3.1.2</span></span>-->
                </div>
            </div>
        </nav>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib: Main Guide</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-datasource.html">
            
                Data sources
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">
            
                Pipelines
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-features.html">
            
                Extracting, transforming and selecting features
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">
            
                Classification and Regression
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">
            
                Frequent Pattern Mining
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">
            
                Model selection and tuning
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">
            
                Advanced topics
            
        </a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib: RDD-based API Guide</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">
            
                Data types
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">
            
                Classification and regression
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">
            
                Dimensionality reduction
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">
            
                Feature extraction and transformation
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">
            
                Frequent pattern mining
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">
            
                Evaluation metrics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">
            
                PMML model export
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">
            
                Optimization (developer)
            
        </a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" checked type="checkbox">
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar mr-3" id="content">
                    
                        <h1 class="title">Decision Trees - RDD-based API</h1>
                    

                    <ul id="markdown-toc">
  <li><a href="#basic-algorithm" id="markdown-toc-basic-algorithm">Basic algorithm</a>    <ul>
      <li><a href="#node-impurity-and-information-gain" id="markdown-toc-node-impurity-and-information-gain">Node impurity and information gain</a></li>
      <li><a href="#split-candidates" id="markdown-toc-split-candidates">Split candidates</a></li>
      <li><a href="#stopping-rule" id="markdown-toc-stopping-rule">Stopping rule</a></li>
    </ul>
  </li>
  <li><a href="#usage-tips" id="markdown-toc-usage-tips">Usage tips</a>    <ul>
      <li><a href="#problem-specification-parameters" id="markdown-toc-problem-specification-parameters">Problem specification parameters</a></li>
      <li><a href="#stopping-criteria" id="markdown-toc-stopping-criteria">Stopping criteria</a></li>
      <li><a href="#tunable-parameters" id="markdown-toc-tunable-parameters">Tunable parameters</a></li>
      <li><a href="#caching-and-checkpointing" id="markdown-toc-caching-and-checkpointing">Caching and checkpointing</a></li>
    </ul>
  </li>
  <li><a href="#scaling" id="markdown-toc-scaling">Scaling</a></li>
  <li><a href="#examples" id="markdown-toc-examples">Examples</a>    <ul>
      <li><a href="#classification" id="markdown-toc-classification">Classification</a></li>
      <li><a href="#regression" id="markdown-toc-regression">Regression</a></li>
    </ul>
  </li>
</ul>

<p><a href="http://en.wikipedia.org/wiki/Decision_tree_learning">Decision trees</a>
and their ensembles are popular methods for the machine learning tasks of
classification and regression. Decision trees are widely used since they are easy to interpret,
handle categorical features, extend to the multiclass classification setting, do not require
feature scaling, and are able to capture non-linearities and feature interactions. Tree ensemble
algorithms such as random forests and boosting are among the top performers for classification and
regression tasks.</p>

<p><code class="language-plaintext highlighter-rouge">spark.mllib</code> supports decision trees for binary and multiclass classification and for regression,
using both continuous and categorical features. The implementation partitions data by rows,
allowing distributed training with millions of instances.</p>

<p>Ensembles of trees (Random Forests and Gradient-Boosted Trees) are described in the <a href="mllib-ensembles.html">Ensembles guide</a>.</p>

<h2 id="basic-algorithm">Basic algorithm</h2>

<p>The decision tree is a greedy algorithm that performs a recursive binary partitioning of the feature
space.  The tree predicts the same label for each bottommost (leaf) partition.
Each partition is chosen greedily by selecting the <em>best split</em> from a set of possible splits,
in order to maximize the information gain at a tree node. In other words, the split chosen at each
tree node is chosen from the set <code class="language-plaintext highlighter-rouge">$\underset{s}{\operatorname{argmax}} IG(D,s)$</code> where <code class="language-plaintext highlighter-rouge">$IG(D,s)$</code>
is the information gain when a split <code class="language-plaintext highlighter-rouge">$s$</code> is applied to a dataset <code class="language-plaintext highlighter-rouge">$D$</code>.</p>

<h3 id="node-impurity-and-information-gain">Node impurity and information gain</h3>

<p>The <em>node impurity</em> is a measure of the homogeneity of the labels at the node. The current
implementation provides two impurity measures for classification (Gini impurity and entropy) and one
impurity measure for regression (variance).</p>

<table class="table">
  <thead>
    <tr><th>Impurity</th><th>Task</th><th>Formula</th><th>Description</th></tr>
  </thead>
  <tbody>
    <tr>
      <td>Gini impurity</td>
	  <td>Classification</td>
	  <td>$\sum_{i=1}^{C} f_i(1-f_i)$</td><td>$f_i$ is the frequency of label $i$ at a node and $C$ is the number of unique labels.</td>
    </tr>
    <tr>
      <td>Entropy</td>
	  <td>Classification</td>
	  <td>$\sum_{i=1}^{C} -f_ilog(f_i)$</td><td>$f_i$ is the frequency of label $i$ at a node and $C$ is the number of unique labels.</td>
    </tr>
    <tr>
      <td>Variance</td>
	  <td>Regression</td>
     <td>$\frac{1}{N} \sum_{i=1}^{N} (y_i - \mu)^2$</td><td>$y_i$ is label for an instance,
	  $N$ is the number of instances and $\mu$ is the mean given by $\frac{1}{N} \sum_{i=1}^N y_i$.</td>
    </tr>
  </tbody>
</table>

<p>The <em>information gain</em> is the difference between the parent node impurity and the weighted sum of
the two child node impurities. Assuming that a split $s$ partitions the dataset <code class="language-plaintext highlighter-rouge">$D$</code> of size <code class="language-plaintext highlighter-rouge">$N$</code>
into two datasets <code class="language-plaintext highlighter-rouge">$D_{left}$</code> and <code class="language-plaintext highlighter-rouge">$D_{right}$</code> of sizes <code class="language-plaintext highlighter-rouge">$N_{left}$</code> and <code class="language-plaintext highlighter-rouge">$N_{right}$</code>,
respectively, the information gain is:</p>

<p><code class="language-plaintext highlighter-rouge">$IG(D,s) = Impurity(D) - \frac{N_{left}}{N} Impurity(D_{left}) - \frac{N_{right}}{N} Impurity(D_{right})$</code></p>

<h3 id="split-candidates">Split candidates</h3>

<p><strong>Continuous features</strong></p>

<p>For small datasets in single-machine implementations, the split candidates for each continuous
feature are typically the unique values for the feature. Some implementations sort the feature
values and then use the ordered unique values as split candidates for faster tree calculations.</p>

<p>Sorting feature values is expensive for large distributed datasets.
This implementation computes an approximate set of split candidates by performing a quantile
calculation over a sampled fraction of the data.
The ordered splits create &#8220;bins&#8221; and the maximum number of such
bins can be specified using the <code class="language-plaintext highlighter-rouge">maxBins</code> parameter.</p>

<p>Note that the number of bins cannot be greater than the number of instances <code class="language-plaintext highlighter-rouge">$N$</code> (a rare scenario
since the default <code class="language-plaintext highlighter-rouge">maxBins</code> value is 32). The tree algorithm automatically reduces the number of
bins if the condition is not satisfied.</p>

<p><strong>Categorical features</strong></p>

<p>For a categorical feature with <code class="language-plaintext highlighter-rouge">$M$</code> possible values (categories), one could come up with
<code class="language-plaintext highlighter-rouge">$2^{M-1}-1$</code> split candidates. For binary (0/1) classification and regression,
we can reduce the number of split candidates to <code class="language-plaintext highlighter-rouge">$M-1$</code> by ordering the
categorical feature values by the average label. (See Section 9.2.4 in
<a href="https://web.stanford.edu/~hastie/ElemStatLearn/">Elements of Statistical Machine Learning</a> for
details.) For example, for a binary classification problem with one categorical feature with three
categories A, B and C whose corresponding proportions of label 1 are 0.2, 0.6 and 0.4, the categorical
features are ordered as A, C, B. The two split candidates are A | C, B
and A , C | B where | denotes the split.</p>

<p>In multiclass classification, all <code class="language-plaintext highlighter-rouge">$2^{M-1}-1$</code> possible splits are used whenever possible.
When <code class="language-plaintext highlighter-rouge">$2^{M-1}-1$</code> is greater than the <code class="language-plaintext highlighter-rouge">maxBins</code> parameter, we use a (heuristic) method
similar to the method used for binary classification and regression.
The <code class="language-plaintext highlighter-rouge">$M$</code> categorical feature values are ordered by impurity,
and the resulting <code class="language-plaintext highlighter-rouge">$M-1$</code> split candidates are considered.</p>

<h3 id="stopping-rule">Stopping rule</h3>

<p>The recursive tree construction is stopped at a node when one of the following conditions is met:</p>

<ol>
  <li>The node depth is equal to the <code class="language-plaintext highlighter-rouge">maxDepth</code> training parameter.</li>
  <li>No split candidate leads to an information gain greater than <code class="language-plaintext highlighter-rouge">minInfoGain</code>.</li>
  <li>No split candidate produces child nodes which each have at least <code class="language-plaintext highlighter-rouge">minInstancesPerNode</code> training instances.</li>
</ol>

<h2 id="usage-tips">Usage tips</h2>

<p>We include a few guidelines for using decision trees by discussing the various parameters.
The parameters are listed below roughly in order of descending importance.  New users should mainly consider the &#8220;Problem specification parameters&#8221; section and the <code class="language-plaintext highlighter-rouge">maxDepth</code> parameter.</p>

<h3 id="problem-specification-parameters">Problem specification parameters</h3>

<p>These parameters describe the problem you want to solve and your dataset.
They should be specified and do not require tuning.</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">algo</code></strong>: Type of decision tree, either <code class="language-plaintext highlighter-rouge">Classification</code> or <code class="language-plaintext highlighter-rouge">Regression</code>.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">numClasses</code></strong>: Number of classes (for <code class="language-plaintext highlighter-rouge">Classification</code> only).</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">categoricalFeaturesInfo</code></strong>: Specifies which features are categorical and how many categorical values each of those features can take.  This is given as a map from feature indices to feature arity (number of categories).  Any features not in this map are treated as continuous.</p>
    <ul>
      <li>For example, <code class="language-plaintext highlighter-rouge">Map(0 -&gt; 2, 4 -&gt; 10)</code> specifies that feature <code class="language-plaintext highlighter-rouge">0</code> is binary (taking values <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code>) and that feature <code class="language-plaintext highlighter-rouge">4</code> has 10 categories (values <code class="language-plaintext highlighter-rouge">{0, 1, ..., 9}</code>).  Note that feature indices are 0-based: features <code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">4</code> are the 1st and 5th elements of an instance&#8217;s feature vector.</li>
      <li>Note that you do not have to specify <code class="language-plaintext highlighter-rouge">categoricalFeaturesInfo</code>.  The algorithm will still run and may get reasonable results.  However, performance should be better if categorical features are properly designated.</li>
    </ul>
  </li>
</ul>

<h3 id="stopping-criteria">Stopping criteria</h3>

<p>These parameters determine when the tree stops building (adding new nodes).
When tuning these parameters, be careful to validate on held-out test data to avoid overfitting.</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">maxDepth</code></strong>: Maximum depth of a tree.  Deeper trees are more expressive (potentially allowing higher accuracy), but they are also more costly to train and are more likely to overfit.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">minInstancesPerNode</code></strong>: For a node to be split further, each of its children must receive at least this number of training instances.  This is commonly used with <a href="api/scala/org/apache/spark/mllib/tree/RandomForest$.html">RandomForest</a> since those are often trained deeper than individual trees.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">minInfoGain</code></strong>: For a node to be split further, the split must improve at least this much (in terms of information gain).</p>
  </li>
</ul>

<h3 id="tunable-parameters">Tunable parameters</h3>

<p>These parameters may be tuned.  Be careful to validate on held-out test data when tuning in order to avoid overfitting.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">maxBins</code></strong>: Number of bins used when discretizing continuous features.
    <ul>
      <li>Increasing <code class="language-plaintext highlighter-rouge">maxBins</code> allows the algorithm to consider more split candidates and make fine-grained split decisions.  However, it also increases computation and communication.</li>
      <li>Note that the <code class="language-plaintext highlighter-rouge">maxBins</code> parameter must be at least the maximum number of categories <code class="language-plaintext highlighter-rouge">$M$</code> for any categorical feature.</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">maxMemoryInMB</code></strong>: Amount of memory to be used for collecting sufficient statistics.
    <ul>
      <li>The default value is conservatively chosen to be 256 MiB to allow the decision algorithm to work in most scenarios.  Increasing <code class="language-plaintext highlighter-rouge">maxMemoryInMB</code> can lead to faster training (if the memory is available) by allowing fewer passes over the data.  However, there may be decreasing returns as <code class="language-plaintext highlighter-rouge">maxMemoryInMB</code> grows since the amount of communication on each iteration can be proportional to <code class="language-plaintext highlighter-rouge">maxMemoryInMB</code>.</li>
      <li><em>Implementation details</em>: For faster processing, the decision tree algorithm collects statistics about groups of nodes to split (rather than 1 node at a time).  The number of nodes which can be handled in one group is determined by the memory requirements (which vary per features).  The <code class="language-plaintext highlighter-rouge">maxMemoryInMB</code> parameter specifies the memory limit in terms of megabytes which each worker can use for these statistics.</li>
    </ul>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">subsamplingRate</code></strong>: Fraction of the training data used for learning the decision tree.  This parameter is most relevant for training ensembles of trees (using <a href="api/scala/org/apache/spark/mllib/tree/RandomForest$.html"><code class="language-plaintext highlighter-rouge">RandomForest</code></a> and <a href="api/scala/org/apache/spark/mllib/tree/GradientBoostedTrees.html"><code class="language-plaintext highlighter-rouge">GradientBoostedTrees</code></a>), where it can be useful to subsample the original data.  For training a single decision tree, this parameter is less useful since the number of training instances is generally not the main constraint.</p>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">impurity</code></strong>: Impurity measure (discussed above) used to choose between candidate splits.  This measure must match the <code class="language-plaintext highlighter-rouge">algo</code> parameter.</li>
</ul>

<h3 id="caching-and-checkpointing">Caching and checkpointing</h3>

<p>MLlib 1.2 adds several features for scaling up to larger (deeper) trees and tree ensembles.  When <code class="language-plaintext highlighter-rouge">maxDepth</code> is set to be large, it can be useful to turn on node ID caching and checkpointing.  These parameters are also useful for <a href="api/scala/org/apache/spark/mllib/tree/RandomForest$.html">RandomForest</a> when <code class="language-plaintext highlighter-rouge">numTrees</code> is set to be large.</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">useNodeIdCache</code></strong>: If this is set to true, the algorithm will avoid passing the current model (tree or trees) to executors on each iteration.
    <ul>
      <li>This can be useful with deep trees (speeding up computation on workers) and for large Random Forests (reducing communication on each iteration).</li>
      <li><em>Implementation details</em>: By default, the algorithm communicates the current model to executors so that executors can match training instances with tree nodes.  When this setting is turned on, then the algorithm will instead cache this information.</li>
    </ul>
  </li>
</ul>

<p>Node ID caching generates a sequence of RDDs (1 per iteration).  This long lineage can cause performance problems, but checkpointing intermediate RDDs can alleviate those problems.
Note that checkpointing is only applicable when <code class="language-plaintext highlighter-rouge">useNodeIdCache</code> is set to true.</p>

<ul>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">checkpointDir</code></strong>: Directory for checkpointing node ID cache RDDs.</p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">checkpointInterval</code></strong>: Frequency for checkpointing node ID cache RDDs.  Setting this too low will cause extra overhead from writing to HDFS; setting this too high can cause problems if executors fail and the RDD needs to be recomputed.</p>
  </li>
</ul>

<h2 id="scaling">Scaling</h2>

<p>Computation scales approximately linearly in the number of training instances,
in the number of features, and in the <code class="language-plaintext highlighter-rouge">maxBins</code> parameter.
Communication scales approximately linearly in the number of features and in <code class="language-plaintext highlighter-rouge">maxBins</code>.</p>

<p>The implemented algorithm reads both sparse and dense data. However, it is not optimized for sparse input.</p>

<h2 id="examples">Examples</h2>

<h3 id="classification">Classification</h3>

<p>The example below demonstrates how to load a
<a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/">LIBSVM data file</a>,
parse it as an RDD of <code class="language-plaintext highlighter-rouge">LabeledPoint</code> and then
perform classification using a decision tree with Gini impurity as an impurity measure and a
maximum tree depth of 5. The test error is calculated to measure the algorithm accuracy.</p>

<div class="codetabs">

<div data-lang="scala">
    <p>Refer to the <a href="api/scala/org/apache/spark/mllib/tree/DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Scala docs</a> and <a href="api/scala/org/apache/spark/mllib/tree/model/DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Scala docs</a> for details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.mllib.tree.DecisionTree</span>
<span class="k">import</span> <span class="nn">org.apache.spark.mllib.tree.model.DecisionTreeModel</span>
<span class="k">import</span> <span class="nn">org.apache.spark.mllib.util.MLUtils</span>

<span class="c1">// Load and parse the data file.</span>
<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">MLUtils</span><span class="o">.</span><span class="py">loadLibSVMFile</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">)</span>
<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="k">val</span> <span class="nv">splits</span> <span class="k">=</span> <span class="nv">data</span><span class="o">.</span><span class="py">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>
<span class="nf">val</span> <span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="nf">splits</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nf">splits</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="c1">//  Empty categoricalFeaturesInfo indicates all features are continuous.</span>
<span class="k">val</span> <span class="nv">numClasses</span> <span class="k">=</span> <span class="mi">2</span>
<span class="k">val</span> <span class="nv">categoricalFeaturesInfo</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]()</span>
<span class="k">val</span> <span class="nv">impurity</span> <span class="k">=</span> <span class="s">"gini"</span>
<span class="k">val</span> <span class="nv">maxDepth</span> <span class="k">=</span> <span class="mi">5</span>
<span class="k">val</span> <span class="nv">maxBins</span> <span class="k">=</span> <span class="mi">32</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">DecisionTree</span><span class="o">.</span><span class="py">trainClassifier</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">numClasses</span><span class="o">,</span> <span class="n">categoricalFeaturesInfo</span><span class="o">,</span>
  <span class="n">impurity</span><span class="o">,</span> <span class="n">maxDepth</span><span class="o">,</span> <span class="n">maxBins</span><span class="o">)</span>

<span class="c1">// Evaluate model on test instances and compute test error</span>
<span class="k">val</span> <span class="nv">labelAndPreds</span> <span class="k">=</span> <span class="nv">testData</span><span class="o">.</span><span class="py">map</span> <span class="o">{</span> <span class="n">point</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="nv">prediction</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">predict</span><span class="o">(</span><span class="nv">point</span><span class="o">.</span><span class="py">features</span><span class="o">)</span>
  <span class="o">(</span><span class="nv">point</span><span class="o">.</span><span class="py">label</span><span class="o">,</span> <span class="n">prediction</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">val</span> <span class="nv">testErr</span> <span class="k">=</span> <span class="nv">labelAndPreds</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="nv">r</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="nv">r</span><span class="o">.</span><span class="py">_2</span><span class="o">).</span><span class="py">count</span><span class="o">().</span><span class="py">toDouble</span> <span class="o">/</span> <span class="nv">testData</span><span class="o">.</span><span class="py">count</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Test Error = $testErr"</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Learned classification tree model:\n ${model.toDebugString}"</span><span class="o">)</span>

<span class="c1">// Save and load model</span>
<span class="nv">model</span><span class="o">.</span><span class="py">save</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">sameModel</span> <span class="k">=</span> <span class="nv">DecisionTreeModel</span><span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/mllib/DecisionTreeClassificationExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">
    <p>Refer to the <a href="api/java/org/apache/spark/mllib/tree/DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Java docs</a> and <a href="api/java/org/apache/spark/mllib/tree/model/DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Java docs</a> for details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">scala.Tuple2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.SparkConf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaPairRDD</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaRDD</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaSparkContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.regression.LabeledPoint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.tree.DecisionTree</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.tree.model.DecisionTreeModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.util.MLUtils</span><span class="o">;</span>

<span class="nc">SparkConf</span> <span class="n">sparkConf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SparkConf</span><span class="o">().</span><span class="na">setAppName</span><span class="o">(</span><span class="s">"JavaDecisionTreeClassificationExample"</span><span class="o">);</span>
<span class="nc">JavaSparkContext</span> <span class="n">jsc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JavaSparkContext</span><span class="o">(</span><span class="n">sparkConf</span><span class="o">);</span>

<span class="c1">// Load and parse the data file.</span>
<span class="nc">String</span> <span class="n">datapath</span> <span class="o">=</span> <span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">;</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">MLUtils</span><span class="o">.</span><span class="na">loadLibSVMFile</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="n">datapath</span><span class="o">).</span><span class="na">toJavaRDD</span><span class="o">();</span>
<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Set parameters.</span>
<span class="c1">//  Empty categoricalFeaturesInfo indicates all features are continuous.</span>
<span class="kt">int</span> <span class="n">numClasses</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">categoricalFeaturesInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="nc">String</span> <span class="n">impurity</span> <span class="o">=</span> <span class="s">"gini"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">maxDepth</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">maxBins</span> <span class="o">=</span> <span class="mi">32</span><span class="o">;</span>

<span class="c1">// Train a DecisionTree model for classification.</span>
<span class="nc">DecisionTreeModel</span> <span class="n">model</span> <span class="o">=</span> <span class="nc">DecisionTree</span><span class="o">.</span><span class="na">trainClassifier</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">numClasses</span><span class="o">,</span>
  <span class="n">categoricalFeaturesInfo</span><span class="o">,</span> <span class="n">impurity</span><span class="o">,</span> <span class="n">maxDepth</span><span class="o">,</span> <span class="n">maxBins</span><span class="o">);</span>

<span class="c1">// Evaluate model on test instances and compute test error</span>
<span class="nc">JavaPairRDD</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">predictionAndLabel</span> <span class="o">=</span>
  <span class="n">testData</span><span class="o">.</span><span class="na">mapToPair</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Tuple2</span><span class="o">&lt;&gt;(</span><span class="n">model</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">features</span><span class="o">()),</span> <span class="n">p</span><span class="o">.</span><span class="na">label</span><span class="o">()));</span>
<span class="kt">double</span> <span class="n">testErr</span> <span class="o">=</span>
  <span class="n">predictionAndLabel</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">pl</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">pl</span><span class="o">.</span><span class="na">_1</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">pl</span><span class="o">.</span><span class="na">_2</span><span class="o">())).</span><span class="na">count</span><span class="o">()</span> <span class="o">/</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span> <span class="n">testData</span><span class="o">.</span><span class="na">count</span><span class="o">();</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Test Error: "</span> <span class="o">+</span> <span class="n">testErr</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Learned classification tree model:\n"</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>

<span class="c1">// Save and load model</span>
<span class="n">model</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="o">);</span>
<span class="nc">DecisionTreeModel</span> <span class="n">sameModel</span> <span class="o">=</span> <span class="nc">DecisionTreeModel</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/mllib/JavaDecisionTreeClassificationExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">
    <p>Refer to the <a href="api/python/reference/api/pyspark.mllib.tree.DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Python docs</a> and <a href="api/python/reference/api/pyspark.mllib.tree.DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Python docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="kn">import</span> <span class="n">DecisionTree</span><span class="p">,</span> <span class="n">DecisionTreeModel</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.util</span> <span class="kn">import</span> <span class="n">MLUtils</span>

<span class="c1"># Load and parse the data file into an RDD of LabeledPoint.
</span><span class="n">data</span> <span class="o">=</span> <span class="n">MLUtils</span><span class="p">.</span><span class="n">loadLibSVMFile</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">'data/mllib/sample_libsvm_data.txt'</span><span class="p">)</span>
<span class="c1"># Split the data into training and test sets (30% held out for testing)
</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a DecisionTree model.
#  Empty categoricalFeaturesInfo indicates all features are continuous.
</span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="p">.</span><span class="n">trainClassifier</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">numClasses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{},</span>
                                     <span class="n">impurity</span><span class="o">=</span><span class="s">'gini'</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="c1"># Evaluate model on test instances and compute test error
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testData</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">features</span><span class="p">))</span>
<span class="n">labelsAndPredictions</span> <span class="o">=</span> <span class="n">testData</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="p">.</span><span class="n">label</span><span class="p">).</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="n">testErr</span> <span class="o">=</span> <span class="n">labelsAndPredictions</span><span class="p">.</span><span class="nb">filter</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">lp</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">count</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">testData</span><span class="p">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Test Error = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">testErr</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Learned classification tree model:'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">())</span>

<span class="c1"># Save and load model
</span><span class="n">model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="p">)</span>
<span class="n">sameModel</span> <span class="o">=</span> <span class="n">DecisionTreeModel</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">"target/tmp/myDecisionTreeClassificationModel"</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/mllib/decision_tree_classification_example.py" in the Spark repo.</small></div>
  </div>

</div>

<h3 id="regression">Regression</h3>

<p>The example below demonstrates how to load a
<a href="http://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/">LIBSVM data file</a>,
parse it as an RDD of <code class="language-plaintext highlighter-rouge">LabeledPoint</code> and then
perform regression using a decision tree with variance as an impurity measure and a maximum tree
depth of 5. The Mean Squared Error (MSE) is computed at the end to evaluate
<a href="http://en.wikipedia.org/wiki/Goodness_of_fit">goodness of fit</a>.</p>

<div class="codetabs">

<div data-lang="scala">
    <p>Refer to the <a href="api/scala/org/apache/spark/mllib/tree/DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Scala docs</a> and <a href="api/scala/org/apache/spark/mllib/tree/model/DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Scala docs</a> for details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.mllib.tree.DecisionTree</span>
<span class="k">import</span> <span class="nn">org.apache.spark.mllib.tree.model.DecisionTreeModel</span>
<span class="k">import</span> <span class="nn">org.apache.spark.mllib.util.MLUtils</span>

<span class="c1">// Load and parse the data file.</span>
<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">MLUtils</span><span class="o">.</span><span class="py">loadLibSVMFile</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">)</span>
<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="k">val</span> <span class="nv">splits</span> <span class="k">=</span> <span class="nv">data</span><span class="o">.</span><span class="py">randomSplit</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">))</span>
<span class="nf">val</span> <span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">testData</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="nf">splits</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nf">splits</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="c1">//  Empty categoricalFeaturesInfo indicates all features are continuous.</span>
<span class="k">val</span> <span class="nv">categoricalFeaturesInfo</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]()</span>
<span class="k">val</span> <span class="nv">impurity</span> <span class="k">=</span> <span class="s">"variance"</span>
<span class="k">val</span> <span class="nv">maxDepth</span> <span class="k">=</span> <span class="mi">5</span>
<span class="k">val</span> <span class="nv">maxBins</span> <span class="k">=</span> <span class="mi">32</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">DecisionTree</span><span class="o">.</span><span class="py">trainRegressor</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span> <span class="n">categoricalFeaturesInfo</span><span class="o">,</span> <span class="n">impurity</span><span class="o">,</span>
  <span class="n">maxDepth</span><span class="o">,</span> <span class="n">maxBins</span><span class="o">)</span>

<span class="c1">// Evaluate model on test instances and compute test error</span>
<span class="k">val</span> <span class="nv">labelsAndPredictions</span> <span class="k">=</span> <span class="nv">testData</span><span class="o">.</span><span class="py">map</span> <span class="o">{</span> <span class="n">point</span> <span class="k">=&gt;</span>
  <span class="k">val</span> <span class="nv">prediction</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">predict</span><span class="o">(</span><span class="nv">point</span><span class="o">.</span><span class="py">features</span><span class="o">)</span>
  <span class="o">(</span><span class="nv">point</span><span class="o">.</span><span class="py">label</span><span class="o">,</span> <span class="n">prediction</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">val</span> <span class="nv">testMSE</span> <span class="k">=</span> <span class="nv">labelsAndPredictions</span><span class="o">.</span><span class="py">map</span><span class="o">{</span> <span class="nf">case</span> <span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nv">math</span><span class="o">.</span><span class="py">pow</span><span class="o">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">p</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="o">}.</span><span class="py">mean</span><span class="o">()</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Test Mean Squared Error = $testMSE"</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Learned regression tree model:\n ${model.toDebugString}"</span><span class="o">)</span>

<span class="c1">// Save and load model</span>
<span class="nv">model</span><span class="o">.</span><span class="py">save</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">sameModel</span> <span class="k">=</span> <span class="nv">DecisionTreeModel</span><span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/mllib/DecisionTreeRegressionExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">
    <p>Refer to the <a href="api/java/org/apache/spark/mllib/tree/DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Java docs</a> and <a href="api/java/org/apache/spark/mllib/tree/model/DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Java docs</a> for details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">scala.Tuple2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.SparkConf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaPairRDD</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaRDD</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.api.java.JavaSparkContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.regression.LabeledPoint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.tree.DecisionTree</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.tree.model.DecisionTreeModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.mllib.util.MLUtils</span><span class="o">;</span>

<span class="nc">SparkConf</span> <span class="n">sparkConf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SparkConf</span><span class="o">().</span><span class="na">setAppName</span><span class="o">(</span><span class="s">"JavaDecisionTreeRegressionExample"</span><span class="o">);</span>
<span class="nc">JavaSparkContext</span> <span class="n">jsc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JavaSparkContext</span><span class="o">(</span><span class="n">sparkConf</span><span class="o">);</span>

<span class="c1">// Load and parse the data file.</span>
<span class="nc">String</span> <span class="n">datapath</span> <span class="o">=</span> <span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">;</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">MLUtils</span><span class="o">.</span><span class="na">loadLibSVMFile</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="n">datapath</span><span class="o">).</span><span class="na">toJavaRDD</span><span class="o">();</span>
<span class="c1">// Split the data into training and test sets (30% held out for testing)</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">randomSplit</span><span class="o">(</span><span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">0.7</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">});</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="nc">JavaRDD</span><span class="o">&lt;</span><span class="nc">LabeledPoint</span><span class="o">&gt;</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">splits</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>

<span class="c1">// Set parameters.</span>
<span class="c1">// Empty categoricalFeaturesInfo indicates all features are continuous.</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">categoricalFeaturesInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="nc">String</span> <span class="n">impurity</span> <span class="o">=</span> <span class="s">"variance"</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">maxDepth</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">maxBins</span> <span class="o">=</span> <span class="mi">32</span><span class="o">;</span>

<span class="c1">// Train a DecisionTree model.</span>
<span class="nc">DecisionTreeModel</span> <span class="n">model</span> <span class="o">=</span> <span class="nc">DecisionTree</span><span class="o">.</span><span class="na">trainRegressor</span><span class="o">(</span><span class="n">trainingData</span><span class="o">,</span>
  <span class="n">categoricalFeaturesInfo</span><span class="o">,</span> <span class="n">impurity</span><span class="o">,</span> <span class="n">maxDepth</span><span class="o">,</span> <span class="n">maxBins</span><span class="o">);</span>

<span class="c1">// Evaluate model on test instances and compute test error</span>
<span class="nc">JavaPairRDD</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">predictionAndLabel</span> <span class="o">=</span>
  <span class="n">testData</span><span class="o">.</span><span class="na">mapToPair</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">Tuple2</span><span class="o">&lt;&gt;(</span><span class="n">model</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">features</span><span class="o">()),</span> <span class="n">p</span><span class="o">.</span><span class="na">label</span><span class="o">()));</span>
<span class="kt">double</span> <span class="n">testMSE</span> <span class="o">=</span> <span class="n">predictionAndLabel</span><span class="o">.</span><span class="na">mapToDouble</span><span class="o">(</span><span class="n">pl</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="kt">double</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="na">_1</span><span class="o">()</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="na">_2</span><span class="o">();</span>
  <span class="k">return</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">diff</span><span class="o">;</span>
<span class="o">}).</span><span class="na">mean</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Test Mean Squared Error: "</span> <span class="o">+</span> <span class="n">testMSE</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Learned regression tree model:\n"</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="na">toDebugString</span><span class="o">());</span>

<span class="c1">// Save and load model</span>
<span class="n">model</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="o">);</span>
<span class="nc">DecisionTreeModel</span> <span class="n">sameModel</span> <span class="o">=</span> <span class="nc">DecisionTreeModel</span>
  <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">jsc</span><span class="o">.</span><span class="na">sc</span><span class="o">(),</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/mllib/JavaDecisionTreeRegressionExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">
    <p>Refer to the <a href="api/python/reference/api/pyspark.mllib.tree.DecisionTree.html"><code class="language-plaintext highlighter-rouge">DecisionTree</code> Python docs</a> and <a href="api/python/reference/api/pyspark.mllib.tree.DecisionTreeModel.html"><code class="language-plaintext highlighter-rouge">DecisionTreeModel</code> Python docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.mllib.tree</span> <span class="kn">import</span> <span class="n">DecisionTree</span><span class="p">,</span> <span class="n">DecisionTreeModel</span>
<span class="kn">from</span> <span class="nn">pyspark.mllib.util</span> <span class="kn">import</span> <span class="n">MLUtils</span>

<span class="c1"># Load and parse the data file into an RDD of LabeledPoint.
</span><span class="n">data</span> <span class="o">=</span> <span class="n">MLUtils</span><span class="p">.</span><span class="n">loadLibSVMFile</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">'data/mllib/sample_libsvm_data.txt'</span><span class="p">)</span>
<span class="c1"># Split the data into training and test sets (30% held out for testing)
</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="c1"># Train a DecisionTree model.
#  Empty categoricalFeaturesInfo indicates all features are continuous.
</span><span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTree</span><span class="p">.</span><span class="n">trainRegressor</span><span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">categoricalFeaturesInfo</span><span class="o">=</span><span class="p">{},</span>
                                    <span class="n">impurity</span><span class="o">=</span><span class="s">'variance'</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">maxBins</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>

<span class="c1"># Evaluate model on test instances and compute test error
</span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testData</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">features</span><span class="p">))</span>
<span class="n">labelsAndPredictions</span> <span class="o">=</span> <span class="n">testData</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="n">lp</span><span class="p">.</span><span class="n">label</span><span class="p">).</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="n">testMSE</span> <span class="o">=</span> <span class="n">labelsAndPredictions</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">lp</span><span class="p">:</span> <span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lp</span><span class="p">[</span><span class="mi">1</span><span class="p">])).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span>\
    <span class="nb">float</span><span class="p">(</span><span class="n">testData</span><span class="p">.</span><span class="n">count</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Test Mean Squared Error = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">testMSE</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Learned regression tree model:'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">toDebugString</span><span class="p">())</span>

<span class="c1"># Save and load model
</span><span class="n">model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="p">)</span>
<span class="n">sameModel</span> <span class="o">=</span> <span class="n">DecisionTreeModel</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="s">"target/tmp/myDecisionTreeRegressionModel"</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/mllib/decision_tree_regression_example.py" in the Spark repo.</small></div>
  </div>

</div>


                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-3.5.1.min.js"></script>
        <script src="js/vendor/bootstrap.bundle.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
        <script type="text/javascript">
            // DocSearch is entirely free and automated. DocSearch is built in two parts:
            // 1. a crawler which we run on our own infrastructure every 24 hours. It follows every link
            //    in your website and extract content from every page it traverses. It then pushes this
            //    content to an Algolia index.
            // 2. a JavaScript snippet to be inserted in your website that will bind this Algolia index
            //    to your search input and display its results in a dropdown UI. If you want to find more
            //    details on how works DocSearch, check the docs of DocSearch.
            docsearch({
    apiKey: 'b18ca3732c502995563043aa17bc6ecb',
    indexName: 'apache_spark',
    inputSelector: '#docsearch-input',
    enhancedSearchInput: true,
    algoliaOptions: {
      'facetFilters': ["version:3.1.2"]
    },
    debug: false // Set debug to true if you want to inspect the dropdown
});

        </script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    </body>
</html>
