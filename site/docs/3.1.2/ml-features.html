
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Extracting, transforming and selecting features - Spark 3.1.2 Documentation</title>
        

        

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/main.css">

        <script src="js/vendor/modernizr-2.6.1-respond-1.1.0.min.js"></script>

        <link rel="stylesheet" href="css/pygments-default.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <link rel="stylesheet" href="css/docsearch.css">

        
        <!-- Google analytics script -->
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-32518208-2']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
        

    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="https://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- This code is taken from http://twitter.github.com/bootstrap/examples/hero.html -->

        <nav class="navbar fixed-top navbar-expand-md navbar-light bg-light" id="topbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="navbar-brand"><a href="index.html">
                        <img src="img/spark-logo-hd.png" style="height:50px;"/></a><span class="version">3.1.2</span>
                    </div>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarCollapse" aria-controls="navbarCollapse"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav">
                        <!--TODO(andyk): Add class="active" attribute to li some how.-->
                        <li class="nav-item"><a href="index.html" class="nav-link">Overview</a></li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarQuickStart" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming Guides</a>
                            <div class="dropdown-menu" aria-labelledby="navbarQuickStart">
                                <a class="dropdown-item" href="quick-start.html">Quick Start</a>
                                <a class="dropdown-item" href="rdd-programming-guide.html">RDDs, Accumulators, Broadcasts Vars</a>
                                <a class="dropdown-item" href="sql-programming-guide.html">SQL, DataFrames, and Datasets</a>
                                <a class="dropdown-item" href="structured-streaming-programming-guide.html">Structured Streaming</a>
                                <a class="dropdown-item" href="streaming-programming-guide.html">Spark Streaming (DStreams)</a>
                                <a class="dropdown-item" href="ml-guide.html">MLlib (Machine Learning)</a>
                                <a class="dropdown-item" href="graphx-programming-guide.html">GraphX (Graph Processing)</a>
                                <a class="dropdown-item" href="sparkr.html">SparkR (R on Spark)</a>
                                <a class="dropdown-item" href="api/python/getting_started/index.html">PySpark (Python on Spark)</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarAPIDocs" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API Docs</a>
                            <div class="dropdown-menu" aria-labelledby="navbarAPIDocs">
                                <a class="dropdown-item" href="api/scala/org/apache/spark/index.html">Scala</a>
                                <a class="dropdown-item" href="api/java/index.html">Java</a>
                                <a class="dropdown-item" href="api/python/index.html">Python</a>
                                <a class="dropdown-item" href="api/R/index.html">R</a>
                                <a class="dropdown-item" href="api/sql/index.html">SQL, Built-in Functions</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarDeploying" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Deploying</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDeploying">
                                <a class="dropdown-item" href="cluster-overview.html">Overview</a>
                                <a class="dropdown-item" href="submitting-applications.html">Submitting Applications</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="spark-standalone.html">Spark Standalone</a>
                                <a class="dropdown-item" href="running-on-mesos.html">Mesos</a>
                                <a class="dropdown-item" href="running-on-yarn.html">YARN</a>
                                <a class="dropdown-item" href="running-on-kubernetes.html">Kubernetes</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" id="navbarMore" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
                            <div class="dropdown-menu" aria-labelledby="navbarMore">
                                <a class="dropdown-item" href="configuration.html">Configuration</a>
                                <a class="dropdown-item" href="monitoring.html">Monitoring</a>
                                <a class="dropdown-item" href="tuning.html">Tuning Guide</a>
                                <a class="dropdown-item" href="job-scheduling.html">Job Scheduling</a>
                                <a class="dropdown-item" href="security.html">Security</a>
                                <a class="dropdown-item" href="hardware-provisioning.html">Hardware Provisioning</a>
                                <a class="dropdown-item" href="migration-guide.html">Migration Guide</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="building-spark.html">Building Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/contributing.html">Contributing to Spark</a>
                                <a class="dropdown-item" href="https://spark.apache.org/third-party-projects.html">Third Party Projects</a>
                            </div>
                        </li>

                        <li class="nav-item">
                            <input type="text" id="docsearch-input" placeholder="Search the docsâ€¦">
                        </li>
                    </ul>
                    <!--<span class="navbar-text navbar-right"><span class="version-text">v3.1.2</span></span>-->
                </div>
            </div>
        </nav>

        <div class="container-wrapper">

            
                
                    <div class="left-menu-wrapper">
    <div class="left-menu">
        <h3><a href="ml-guide.html">MLlib: Main Guide</a></h3>
        
<ul>

    <li>
        <a href="ml-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-datasource.html">
            
                Data sources
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-pipeline.html">
            
                Pipelines
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-features.html">
            
                <b>Extracting, transforming and selecting features</b>
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-classification-regression.html">
            
                Classification and Regression
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-frequent-pattern-mining.html">
            
                Frequent Pattern Mining
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-tuning.html">
            
                Model selection and tuning
            
        </a>
    </li>
    
    

    <li>
        <a href="ml-advanced.html">
            
                Advanced topics
            
        </a>
    </li>
    
    

</ul>

        <h3><a href="mllib-guide.html">MLlib: RDD-based API Guide</a></h3>
        
<ul>

    <li>
        <a href="mllib-data-types.html">
            
                Data types
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-statistics.html">
            
                Basic statistics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-classification-regression.html">
            
                Classification and regression
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-collaborative-filtering.html">
            
                Collaborative filtering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-clustering.html">
            
                Clustering
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-dimensionality-reduction.html">
            
                Dimensionality reduction
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-feature-extraction.html">
            
                Feature extraction and transformation
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-frequent-pattern-mining.html">
            
                Frequent pattern mining
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-evaluation-metrics.html">
            
                Evaluation metrics
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-pmml-model-export.html">
            
                PMML model export
            
        </a>
    </li>
    
    

    <li>
        <a href="mllib-optimization.html">
            
                Optimization (developer)
            
        </a>
    </li>
    
    

</ul>

    </div>
</div>
                
                <input id="nav-trigger" class="nav-trigger" checked type="checkbox">
                <label for="nav-trigger"></label>
                <div class="content-with-sidebar mr-3" id="content">
                    
                        <h1 class="title">Extracting, transforming and selecting features</h1>
                    

                    <p>This section covers algorithms for working with features, roughly divided into these groups:</p>

<ul>
  <li>Extraction: Extracting features from &#8220;raw&#8221; data</li>
  <li>Transformation: Scaling, converting, or modifying features</li>
  <li>Selection: Selecting a subset from a larger set of features</li>
  <li>Locality Sensitive Hashing (LSH): This class of algorithms combines aspects of feature transformation with other algorithms.</li>
</ul>

<p><strong>Table of Contents</strong></p>

<ul id="markdown-toc">
  <li><a href="#feature-extractors" id="markdown-toc-feature-extractors">Feature Extractors</a>    <ul>
      <li><a href="#tf-idf" id="markdown-toc-tf-idf">TF-IDF</a></li>
      <li><a href="#word2vec" id="markdown-toc-word2vec">Word2Vec</a></li>
      <li><a href="#countvectorizer" id="markdown-toc-countvectorizer">CountVectorizer</a></li>
      <li><a href="#featurehasher" id="markdown-toc-featurehasher">FeatureHasher</a></li>
    </ul>
  </li>
  <li><a href="#feature-transformers" id="markdown-toc-feature-transformers">Feature Transformers</a>    <ul>
      <li><a href="#tokenizer" id="markdown-toc-tokenizer">Tokenizer</a></li>
      <li><a href="#stopwordsremover" id="markdown-toc-stopwordsremover">StopWordsRemover</a></li>
      <li><a href="#n-gram" id="markdown-toc-n-gram">$n$-gram</a></li>
      <li><a href="#binarizer" id="markdown-toc-binarizer">Binarizer</a></li>
      <li><a href="#pca" id="markdown-toc-pca">PCA</a></li>
      <li><a href="#polynomialexpansion" id="markdown-toc-polynomialexpansion">PolynomialExpansion</a></li>
      <li><a href="#discrete-cosine-transform-dct" id="markdown-toc-discrete-cosine-transform-dct">Discrete Cosine Transform (DCT)</a></li>
      <li><a href="#stringindexer" id="markdown-toc-stringindexer">StringIndexer</a></li>
      <li><a href="#indextostring" id="markdown-toc-indextostring">IndexToString</a></li>
      <li><a href="#onehotencoder" id="markdown-toc-onehotencoder">OneHotEncoder</a></li>
      <li><a href="#vectorindexer" id="markdown-toc-vectorindexer">VectorIndexer</a></li>
      <li><a href="#interaction" id="markdown-toc-interaction">Interaction</a></li>
      <li><a href="#normalizer" id="markdown-toc-normalizer">Normalizer</a></li>
      <li><a href="#standardscaler" id="markdown-toc-standardscaler">StandardScaler</a></li>
      <li><a href="#robustscaler" id="markdown-toc-robustscaler">RobustScaler</a></li>
      <li><a href="#minmaxscaler" id="markdown-toc-minmaxscaler">MinMaxScaler</a></li>
      <li><a href="#maxabsscaler" id="markdown-toc-maxabsscaler">MaxAbsScaler</a></li>
      <li><a href="#bucketizer" id="markdown-toc-bucketizer">Bucketizer</a></li>
      <li><a href="#elementwiseproduct" id="markdown-toc-elementwiseproduct">ElementwiseProduct</a></li>
      <li><a href="#sqltransformer" id="markdown-toc-sqltransformer">SQLTransformer</a></li>
      <li><a href="#vectorassembler" id="markdown-toc-vectorassembler">VectorAssembler</a></li>
      <li><a href="#vectorsizehint" id="markdown-toc-vectorsizehint">VectorSizeHint</a></li>
      <li><a href="#quantilediscretizer" id="markdown-toc-quantilediscretizer">QuantileDiscretizer</a></li>
      <li><a href="#imputer" id="markdown-toc-imputer">Imputer</a></li>
    </ul>
  </li>
  <li><a href="#feature-selectors" id="markdown-toc-feature-selectors">Feature Selectors</a>    <ul>
      <li><a href="#vectorslicer" id="markdown-toc-vectorslicer">VectorSlicer</a></li>
      <li><a href="#rformula" id="markdown-toc-rformula">RFormula</a></li>
      <li><a href="#chisqselector" id="markdown-toc-chisqselector">ChiSqSelector</a></li>
      <li><a href="#univariatefeatureselector" id="markdown-toc-univariatefeatureselector">UnivariateFeatureSelector</a></li>
      <li><a href="#variancethresholdselector" id="markdown-toc-variancethresholdselector">VarianceThresholdSelector</a></li>
    </ul>
  </li>
  <li><a href="#locality-sensitive-hashing" id="markdown-toc-locality-sensitive-hashing">Locality Sensitive Hashing</a>    <ul>
      <li><a href="#lsh-operations" id="markdown-toc-lsh-operations">LSH Operations</a>        <ul>
          <li><a href="#feature-transformation" id="markdown-toc-feature-transformation">Feature Transformation</a></li>
          <li><a href="#approximate-similarity-join" id="markdown-toc-approximate-similarity-join">Approximate Similarity Join</a></li>
          <li><a href="#approximate-nearest-neighbor-search" id="markdown-toc-approximate-nearest-neighbor-search">Approximate Nearest Neighbor Search</a></li>
        </ul>
      </li>
      <li><a href="#lsh-algorithms" id="markdown-toc-lsh-algorithms">LSH Algorithms</a>        <ul>
          <li><a href="#bucketed-random-projection-for-euclidean-distance" id="markdown-toc-bucketed-random-projection-for-euclidean-distance">Bucketed Random Projection for Euclidean Distance</a></li>
          <li><a href="#minhash-for-jaccard-distance" id="markdown-toc-minhash-for-jaccard-distance">MinHash for Jaccard Distance</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h1 id="feature-extractors">Feature Extractors</h1>

<h2 id="tf-idf">TF-IDF</h2>

<p><a href="http://en.wikipedia.org/wiki/Tf%E2%80%93idf">Term frequency-inverse document frequency (TF-IDF)</a> 
is a feature vectorization method widely used in text mining to reflect the importance of a term 
to a document in the corpus. Denote a term by <code class="language-plaintext highlighter-rouge">$t$</code>, a document by <code class="language-plaintext highlighter-rouge">$d$</code>, and the corpus by <code class="language-plaintext highlighter-rouge">$D$</code>.
Term frequency <code class="language-plaintext highlighter-rouge">$TF(t, d)$</code> is the number of times that term <code class="language-plaintext highlighter-rouge">$t$</code> appears in document <code class="language-plaintext highlighter-rouge">$d$</code>, while 
document frequency <code class="language-plaintext highlighter-rouge">$DF(t, D)$</code> is the number of documents that contains term <code class="language-plaintext highlighter-rouge">$t$</code>. If we only use 
term frequency to measure the importance, it is very easy to over-emphasize terms that appear very 
often but carry little information about the document, e.g. &#8220;a&#8221;, &#8220;the&#8221;, and &#8220;of&#8221;. If a term appears 
very often across the corpus, it means it doesn&#8217;t carry special information about a particular document.
Inverse document frequency is a numerical measure of how much information a term provides:
<code class="language-plaintext highlighter-rouge">\[
IDF(t, D) = \log \frac{|D| + 1}{DF(t, D) + 1},
\]</code>
where <code class="language-plaintext highlighter-rouge">$|D|$</code> is the total number of documents in the corpus. Since logarithm is used, if a term 
appears in all documents, its IDF value becomes 0. Note that a smoothing term is applied to avoid 
dividing by zero for terms outside the corpus. The TF-IDF measure is simply the product of TF and IDF:
<code class="language-plaintext highlighter-rouge">\[
TFIDF(t, d, D) = TF(t, d) \cdot IDF(t, D).
\]</code>
There are several variants on the definition of term frequency and document frequency.
In MLlib, we separate TF and IDF to make them flexible.</p>

<p><strong>TF</strong>: Both <code class="language-plaintext highlighter-rouge">HashingTF</code> and <code class="language-plaintext highlighter-rouge">CountVectorizer</code> can be used to generate the term frequency vectors.</p>

<p><code class="language-plaintext highlighter-rouge">HashingTF</code> is a <code class="language-plaintext highlighter-rouge">Transformer</code> which takes sets of terms and converts those sets into 
fixed-length feature vectors.  In text processing, a &#8220;set of terms&#8221; might be a bag of words.
<code class="language-plaintext highlighter-rouge">HashingTF</code> utilizes the <a href="http://en.wikipedia.org/wiki/Feature_hashing">hashing trick</a>.
A raw feature is mapped into an index (term) by applying a hash function. The hash function
used here is <a href="https://en.wikipedia.org/wiki/MurmurHash">MurmurHash 3</a>. Then term frequencies
are calculated based on the mapped indices. This approach avoids the need to compute a global 
term-to-index map, which can be expensive for a large corpus, but it suffers from potential hash 
collisions, where different raw features may become the same term after hashing. To reduce the 
chance of collision, we can increase the target feature dimension, i.e. the number of buckets 
of the hash table. Since a simple modulo on the hashed value is used to determine the vector index,
it is advisable to use a power of two as the feature dimension, otherwise the features will not
be mapped evenly to the vector indices. The default feature dimension is <code class="language-plaintext highlighter-rouge">$2^{18} = 262,144$</code>.
An optional binary toggle parameter controls term frequency counts. When set to true all nonzero
frequency counts are set to 1. This is especially useful for discrete probabilistic models that
model binary, rather than integer, counts.</p>

<p><code class="language-plaintext highlighter-rouge">CountVectorizer</code> converts text documents to vectors of term counts. Refer to <a href="ml-features.html#countvectorizer">CountVectorizer
</a> for more details.</p>

<p><strong>IDF</strong>: <code class="language-plaintext highlighter-rouge">IDF</code> is an <code class="language-plaintext highlighter-rouge">Estimator</code> which is fit on a dataset and produces an <code class="language-plaintext highlighter-rouge">IDFModel</code>.  The 
<code class="language-plaintext highlighter-rouge">IDFModel</code> takes feature vectors (generally created from <code class="language-plaintext highlighter-rouge">HashingTF</code> or <code class="language-plaintext highlighter-rouge">CountVectorizer</code>) and 
scales each feature. Intuitively, it down-weights features which appear frequently in a corpus.</p>

<p><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">spark.ml</code> doesn&#8217;t provide tools for text segmentation.
We refer users to the <a href="http://nlp.stanford.edu/">Stanford NLP Group</a> and 
<a href="https://github.com/scalanlp/chalk">scalanlp/chalk</a>.</p>

<p><strong>Examples</strong></p>

<p>In the following code segment, we start with a set of sentences.  We split each sentence into words 
using <code class="language-plaintext highlighter-rouge">Tokenizer</code>.  For each sentence (bag of words), we use <code class="language-plaintext highlighter-rouge">HashingTF</code> to hash the sentence into 
a feature vector.  We use <code class="language-plaintext highlighter-rouge">IDF</code> to rescale the feature vectors; this generally improves performance 
when using text as features.  Our feature vectors could then be passed to a learning algorithm.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/HashingTF.html">HashingTF Scala docs</a> and
the <a href="api/scala/org/apache/spark/ml/feature/IDF.html">IDF Scala docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">HashingTF</span><span class="o">,</span> <span class="nc">IDF</span><span class="o">,</span> <span class="nc">Tokenizer</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">sentenceData</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="s">"Hi I heard about Spark"</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="s">"I wish Java could use case classes"</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="s">"Logistic regression models are neat"</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="s">"sentence"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">().</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">wordsData</span> <span class="k">=</span> <span class="nv">tokenizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">sentenceData</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">hashingTF</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">HashingTF</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"rawFeatures"</span><span class="o">).</span><span class="py">setNumFeatures</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">featurizedData</span> <span class="k">=</span> <span class="nv">hashingTF</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">wordsData</span><span class="o">)</span>
<span class="c1">// alternatively, CountVectorizer can also be used to get term frequency vectors</span>

<span class="k">val</span> <span class="nv">idf</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IDF</span><span class="o">().</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"rawFeatures"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">idfModel</span> <span class="k">=</span> <span class="nv">idf</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">featurizedData</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">rescaledData</span> <span class="k">=</span> <span class="nv">idfModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">featurizedData</span><span class="o">)</span>
<span class="nv">rescaledData</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/TfIdfExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/HashingTF.html">HashingTF Java docs</a> and the
<a href="api/java/org/apache/spark/ml/feature/IDF.html">IDF Java docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.HashingTF</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.IDF</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.IDFModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Tokenizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="s">"Hi I heard about Spark"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="s">"I wish Java could use case classes"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="s">"Logistic regression models are neat"</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Tokenizer</span> <span class="n">tokenizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">().</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">).</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">wordsData</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">sentenceData</span><span class="o">);</span>

<span class="kt">int</span> <span class="n">numFeatures</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
<span class="nc">HashingTF</span> <span class="n">hashingTF</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashingTF</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"rawFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setNumFeatures</span><span class="o">(</span><span class="n">numFeatures</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">featurizedData</span> <span class="o">=</span> <span class="n">hashingTF</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">wordsData</span><span class="o">);</span>
<span class="c1">// alternatively, CountVectorizer can also be used to get term frequency vectors</span>

<span class="no">IDF</span> <span class="n">idf</span> <span class="o">=</span> <span class="k">new</span> <span class="no">IDF</span><span class="o">().</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"rawFeatures"</span><span class="o">).</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">);</span>
<span class="nc">IDFModel</span> <span class="n">idfModel</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">featurizedData</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">rescaledData</span> <span class="o">=</span> <span class="n">idfModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">featurizedData</span><span class="o">);</span>
<span class="n">rescaledData</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaTfIdfExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.HashingTF.html">HashingTF Python docs</a> and
the <a href="api/python/reference/api/pyspark.ml.feature.IDF.html">IDF Python docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">"Hi I heard about Spark"</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="s">"I wish Java could use case classes"</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s">"Logistic regression models are neat"</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"sentence"</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"sentence"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">)</span>
<span class="n">wordsData</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">)</span>

<span class="n">hashingTF</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"rawFeatures"</span><span class="p">,</span> <span class="n">numFeatures</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">featurizedData</span> <span class="o">=</span> <span class="n">hashingTF</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">wordsData</span><span class="p">)</span>
<span class="c1"># alternatively, CountVectorizer can also be used to get term frequency vectors
</span>
<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"rawFeatures"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">)</span>
<span class="n">idfModel</span> <span class="o">=</span> <span class="n">idf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">featurizedData</span><span class="p">)</span>
<span class="n">rescaledData</span> <span class="o">=</span> <span class="n">idfModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">featurizedData</span><span class="p">)</span>

<span class="n">rescaledData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/tf_idf_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="word2vec">Word2Vec</h2>

<p><code class="language-plaintext highlighter-rouge">Word2Vec</code> is an <code class="language-plaintext highlighter-rouge">Estimator</code> which takes sequences of words representing documents and trains a
<code class="language-plaintext highlighter-rouge">Word2VecModel</code>. The model maps each word to a unique fixed-size vector. The <code class="language-plaintext highlighter-rouge">Word2VecModel</code>
transforms each document into a vector using the average of all words in the document; this vector
can then be used as features for prediction, document similarity calculations, etc.
Please refer to the <a href="mllib-feature-extraction.html#word2vec">MLlib user guide on Word2Vec</a> for more
details.</p>

<p><strong>Examples</strong></p>

<p>In the following code segment, we start with a set of documents, each of which is represented as a sequence of words. For each document, we transform it into a feature vector. This feature vector could then be passed to a learning algorithm.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Word2Vec.html">Word2Vec Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Word2Vec</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.Row</span>

<span class="c1">// Input data: Each row is a bag of words from a sentence or document.</span>
<span class="k">val</span> <span class="nv">documentDF</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="s">"Hi I heard about Spark"</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">" "</span><span class="o">),</span>
  <span class="s">"I wish Java could use case classes"</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">" "</span><span class="o">),</span>
  <span class="s">"Logistic regression models are neat"</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">" "</span><span class="o">)</span>
<span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nv">Tuple1</span><span class="o">.</span><span class="py">apply</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>

<span class="c1">// Learn a mapping from words to Vectors.</span>
<span class="k">val</span> <span class="nv">word2Vec</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Word2Vec</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"result"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setVectorSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMinCount</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">word2Vec</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">documentDF</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">documentDF</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">collect</span><span class="o">().</span><span class="py">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="nc">Row</span><span class="o">(</span><span class="n">text</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="k">_</span><span class="o">],</span> <span class="n">features</span><span class="k">:</span> <span class="kt">Vector</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Text: [${text.mkString("</span><span class="o">,</span> <span class="s">")}] =&gt; \nVector: $features\n"</span><span class="o">)</span> <span class="o">}</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/Word2VecExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Word2Vec.html">Word2Vec Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Word2Vec</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Word2VecModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="c1">// Input data: Each row is a bag of words from a sentence or document.</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Hi I heard about Spark"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"I wish Java could use case classes"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">))),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Logistic regression models are neat"</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">)))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"text"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">documentDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="c1">// Learn a mapping from words to Vectors.</span>
<span class="nc">Word2Vec</span> <span class="n">word2Vec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Word2Vec</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"result"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setVectorSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMinCount</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

<span class="nc">Word2VecModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">word2Vec</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">documentDF</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">documentDF</span><span class="o">);</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">collectAsList</span><span class="o">())</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">text</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getList</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
  <span class="nc">Vector</span> <span class="n">vector</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Vector</span><span class="o">)</span> <span class="n">row</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Text: "</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s">" =&gt; \nVector: "</span> <span class="o">+</span> <span class="n">vector</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
<span class="o">}</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaWord2VecExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Word2Vec.html">Word2Vec Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Word2Vec</span>

<span class="c1"># Input data: Each row is a bag of words from a sentence or document.
</span><span class="n">documentDF</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="s">"Hi I heard about Spark"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">),</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">"I wish Java could use case classes"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">),</span> <span class="p">),</span>
    <span class="p">(</span><span class="s">"Logistic regression models are neat"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">),</span> <span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"text"</span><span class="p">])</span>

<span class="c1"># Learn a mapping from words to Vectors.
</span><span class="n">word2Vec</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">(</span><span class="n">vectorSize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"text"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"result"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">word2Vec</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">documentDF</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">documentDF</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">collect</span><span class="p">():</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">row</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Text: [%s] =&gt; </span><span class="se">\n</span><span class="s">Vector: %s</span><span class="se">\n</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="s">", "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">vector</span><span class="p">)))</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/word2vec_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="countvectorizer">CountVectorizer</h2>

<p><code class="language-plaintext highlighter-rouge">CountVectorizer</code> and <code class="language-plaintext highlighter-rouge">CountVectorizerModel</code> aim to help convert a collection of text documents
 to vectors of token counts. When an a-priori dictionary is not available, <code class="language-plaintext highlighter-rouge">CountVectorizer</code> can
 be used as an <code class="language-plaintext highlighter-rouge">Estimator</code> to extract the vocabulary, and generates a <code class="language-plaintext highlighter-rouge">CountVectorizerModel</code>. The
 model produces sparse representations for the documents over the vocabulary, which can then be
 passed to other algorithms like LDA.</p>

<p>During the fitting process, <code class="language-plaintext highlighter-rouge">CountVectorizer</code> will select the top <code class="language-plaintext highlighter-rouge">vocabSize</code> words ordered by
 term frequency across the corpus. An optional parameter <code class="language-plaintext highlighter-rouge">minDF</code> also affects the fitting process
 by specifying the minimum number (or fraction if &lt; 1.0) of documents a term must appear in to be
 included in the vocabulary. Another optional binary toggle parameter controls the output vector.
 If set to true all nonzero counts are set to 1. This is especially useful for discrete probabilistic
 models that model binary, rather than integer, counts.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have the following DataFrame with columns <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">texts</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | texts
----|----------
 0  | Array("a", "b", "c")
 1  | Array("a", "b", "b", "c", "a")
</code></pre></div></div>

<p>each row in <code class="language-plaintext highlighter-rouge">texts</code> is a document of type Array[String].
Invoking fit of <code class="language-plaintext highlighter-rouge">CountVectorizer</code> produces a <code class="language-plaintext highlighter-rouge">CountVectorizerModel</code> with vocabulary (a, b, c).
Then the output column &#8220;vector&#8221; after transformation contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | texts                           | vector
----|---------------------------------|---------------
 0  | Array("a", "b", "c")            | (3,[0,1,2],[1.0,1.0,1.0])
 1  | Array("a", "b", "b", "c", "a")  | (3,[0,1,2],[2.0,2.0,1.0])
</code></pre></div></div>

<p>Each vector represents the token counts of the document over the vocabulary.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/CountVectorizer.html">CountVectorizer Scala docs</a>
and the <a href="api/scala/org/apache/spark/ml/feature/CountVectorizerModel.html">CountVectorizerModel Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">CountVectorizer</span><span class="o">,</span> <span class="nc">CountVectorizerModel</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>

<span class="c1">// fit a CountVectorizerModel from the corpus</span>
<span class="k">val</span> <span class="nv">cvModel</span><span class="k">:</span> <span class="kt">CountVectorizerModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountVectorizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setVocabSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMinDF</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="c1">// alternatively, define CountVectorizerModel with a-priori vocabulary</span>
<span class="k">val</span> <span class="nv">cvm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">CountVectorizerModel</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="nv">cvModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/CountVectorizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/CountVectorizer.html">CountVectorizer Java docs</a>
and the <a href="api/java/org/apache/spark/ml/feature/CountVectorizerModel.html">CountVectorizerModel Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.CountVectorizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.CountVectorizerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="c1">// Input data: Each row is a bag of words from a sentence or document.</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span> <span class="o">[]</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"text"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">ArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="c1">// fit a CountVectorizerModel from the corpus</span>
<span class="nc">CountVectorizerModel</span> <span class="n">cvModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountVectorizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"feature"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setVocabSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMinDF</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="c1">// alternatively, define CountVectorizerModel with a-priori vocabulary</span>
<span class="nc">CountVectorizerModel</span> <span class="n">cvm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountVectorizerModel</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"text"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"feature"</span><span class="o">);</span>

<span class="n">cvModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaCountVectorizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.CountVectorizer.html">CountVectorizer Python docs</a>
and the <a href="api/python/reference/api/pyspark.ml.feature.CountVectorizerModel.html">CountVectorizerModel Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># Input data: Each row is a bag of words with a ID.
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"a b c"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"a b b c a"</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">))</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"words"</span><span class="p">])</span>

<span class="c1"># fit a CountVectorizerModel from the corpus.
</span><span class="n">cv</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">vocabSize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minDF</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">cv</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/count_vectorizer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="featurehasher">FeatureHasher</h2>

<p>Feature hashing projects a set of categorical or numerical features into a feature vector of
specified dimension (typically substantially smaller than that of the original feature
space). This is done using the <a href="https://en.wikipedia.org/wiki/Feature_hashing">hashing trick</a>
to map features to indices in the feature vector.</p>

<p>The <code class="language-plaintext highlighter-rouge">FeatureHasher</code> transformer operates on multiple columns. Each column may contain either
numeric or categorical features. Behavior and handling of column data types is as follows:</p>

<ul>
  <li>Numeric columns: For numeric features, the hash value of the column name is used to map the
feature value to its index in the feature vector. By default, numeric features are not treated
as categorical (even when they are integers). To treat them as categorical, specify the relevant
columns using the <code class="language-plaintext highlighter-rouge">categoricalCols</code> parameter.</li>
  <li>String columns: For categorical features, the hash value of the string &#8220;column_name=value&#8221;
is used to map to the vector index, with an indicator value of <code class="language-plaintext highlighter-rouge">1.0</code>. Thus, categorical features
are &#8220;one-hot&#8221; encoded (similarly to using <a href="ml-features.html#onehotencoder">OneHotEncoder</a> with
<code class="language-plaintext highlighter-rouge">dropLast=false</code>).</li>
  <li>Boolean columns: Boolean values are treated in the same way as string columns. That is,
boolean features are represented as &#8220;column_name=true&#8221; or &#8220;column_name=false&#8221;, with an indicator
value of <code class="language-plaintext highlighter-rouge">1.0</code>.</li>
</ul>

<p>Null (missing) values are ignored (implicitly zero in the resulting feature vector).</p>

<p>The hash function used here is also the <a href="https://en.wikipedia.org/wiki/MurmurHash">MurmurHash 3</a>
used in <a href="ml-features.html#tf-idf">HashingTF</a>. Since a simple modulo on the hashed value is used to
determine the vector index, it is advisable to use a power of two as the numFeatures parameter;
otherwise the features will not be mapped evenly to the vector indices.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with 4 input columns <code class="language-plaintext highlighter-rouge">real</code>, <code class="language-plaintext highlighter-rouge">bool</code>, <code class="language-plaintext highlighter-rouge">stringNum</code>, and <code class="language-plaintext highlighter-rouge">string</code>.
These different data types as input will illustrate the behavior of the transform to produce a
column of feature vectors.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>real| bool|stringNum|string
----|-----|---------|------
 2.2| true|        1|   foo
 3.3|false|        2|   bar
 4.4|false|        3|   baz
 5.5|false|        4|   foo
</code></pre></div></div>

<p>Then the output of <code class="language-plaintext highlighter-rouge">FeatureHasher.transform</code> on this DataFrame is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>real|bool |stringNum|string|features
----|-----|---------|------|-------------------------------------------------------
2.2 |true |1        |foo   |(262144,[51871, 63643,174475,253195],[1.0,1.0,2.2,1.0])
3.3 |false|2        |bar   |(262144,[6031,  80619,140467,174475],[1.0,1.0,1.0,3.3])
4.4 |false|3        |baz   |(262144,[24279,140467,174475,196810],[1.0,1.0,4.4,1.0])
5.5 |false|4        |foo   |(262144,[63643,140467,168512,174475],[1.0,1.0,1.0,5.5])
</code></pre></div></div>

<p>The resulting feature vectors could then be passed to a learning algorithm.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/FeatureHasher.html">FeatureHasher Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.FeatureHasher</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mf">2.2</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="s">"1"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">3.3</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"2"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">4.4</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"baz"</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">5.5</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"real"</span><span class="o">,</span> <span class="s">"bool"</span><span class="o">,</span> <span class="s">"stringNum"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">hasher</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FeatureHasher</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="s">"real"</span><span class="o">,</span> <span class="s">"bool"</span><span class="o">,</span> <span class="s">"stringNum"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">featurized</span> <span class="k">=</span> <span class="nv">hasher</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
<span class="nv">featurized</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/FeatureHasherExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/FeatureHasher.html">FeatureHasher Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.FeatureHasher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">2.2</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="s">"1"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">3.3</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"2"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">4.4</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"baz"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">5.5</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"real"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"bool"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">BooleanType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"stringNum"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"string"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">FeatureHasher</span> <span class="n">hasher</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FeatureHasher</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"real"</span><span class="o">,</span> <span class="s">"bool"</span><span class="o">,</span> <span class="s">"stringNum"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">featurized</span> <span class="o">=</span> <span class="n">hasher</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>

<span class="n">featurized</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaFeatureHasherExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.FeatureHasher.html">FeatureHasher Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">FeatureHasher</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">2.2</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"foo"</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">3.3</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"baz"</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"4"</span><span class="p">,</span> <span class="s">"foo"</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"real"</span><span class="p">,</span> <span class="s">"bool"</span><span class="p">,</span> <span class="s">"stringNum"</span><span class="p">,</span> <span class="s">"string"</span><span class="p">])</span>

<span class="n">hasher</span> <span class="o">=</span> <span class="n">FeatureHasher</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"real"</span><span class="p">,</span> <span class="s">"bool"</span><span class="p">,</span> <span class="s">"stringNum"</span><span class="p">,</span> <span class="s">"string"</span><span class="p">],</span>
                       <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">)</span>

<span class="n">featurized</span> <span class="o">=</span> <span class="n">hasher</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">featurized</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/feature_hasher_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h1 id="feature-transformers">Feature Transformers</h1>

<h2 id="tokenizer">Tokenizer</h2>

<p><a href="http://en.wikipedia.org/wiki/Lexical_analysis#Tokenization">Tokenization</a> is the process of taking text (such as a sentence) and breaking it into individual terms (usually words).  A simple <a href="api/scala/org/apache/spark/ml/feature/Tokenizer.html">Tokenizer</a> class provides this functionality.  The example below shows how to split sentences into sequences of words.</p>

<p><a href="api/scala/org/apache/spark/ml/feature/RegexTokenizer.html">RegexTokenizer</a> allows more
 advanced tokenization based on regular expression (regex) matching.
 By default, the parameter &#8220;pattern&#8221; (regex, default: <code class="language-plaintext highlighter-rouge">"\\s+"</code>) is used as delimiters to split the input text.
 Alternatively, users can set parameter &#8220;gaps&#8221; to false indicating the regex &#8220;pattern&#8221; denotes
 &#8220;tokens&#8221; rather than splitting gaps, and find all matching occurrences as the tokenization result.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Tokenizer.html">Tokenizer Scala docs</a>
and the <a href="api/scala/org/apache/spark/ml/feature/RegexTokenizer.html">RegexTokenizer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">RegexTokenizer</span><span class="o">,</span> <span class="nc">Tokenizer</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions._</span>

<span class="k">val</span> <span class="nv">sentenceDataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"Hi I heard about Spark"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"I wish Java could use case classes"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"Logistic,regression,models,are,neat"</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"sentence"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">tokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">().</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">regexTokenizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RegexTokenizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setPattern</span><span class="o">(</span><span class="s">"\\W"</span><span class="o">)</span> <span class="c1">// alternatively .setPattern("\\w+").setGaps(false)</span>

<span class="k">val</span> <span class="nv">countTokens</span> <span class="k">=</span> <span class="n">udf</span> <span class="o">{</span> <span class="o">(</span><span class="n">words</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="nv">words</span><span class="o">.</span><span class="py">length</span> <span class="o">}</span>

<span class="k">val</span> <span class="nv">tokenized</span> <span class="k">=</span> <span class="nv">tokenizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">sentenceDataFrame</span><span class="o">)</span>
<span class="nv">tokenized</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">,</span> <span class="nf">countTokens</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"words"</span><span class="o">))).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">regexTokenized</span> <span class="k">=</span> <span class="nv">regexTokenizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">sentenceDataFrame</span><span class="o">)</span>
<span class="nv">regexTokenized</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">,</span> <span class="nf">countTokens</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"words"</span><span class="o">))).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/TokenizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Tokenizer.html">Tokenizer Java docs</a>
and the <a href="api/java/org/apache/spark/ml/feature/RegexTokenizer.html">RegexTokenizer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">scala.collection.mutable.Seq</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.RegexTokenizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Tokenizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="c1">// col("...") is preferable to df.col("...")</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">functions</span><span class="o">.</span><span class="na">callUDF</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">functions</span><span class="o">.</span><span class="na">col</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"Hi I heard about Spark"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"I wish Java could use case classes"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"Logistic,regression,models,are,neat"</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">sentenceDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Tokenizer</span> <span class="n">tokenizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Tokenizer</span><span class="o">().</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">).</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">);</span>

<span class="nc">RegexTokenizer</span> <span class="n">regexTokenizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RegexTokenizer</span><span class="o">()</span>
    <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setPattern</span><span class="o">(</span><span class="s">"\\W"</span><span class="o">);</span>  <span class="c1">// alternatively .setPattern("\\w+").setGaps(false);</span>

<span class="n">spark</span><span class="o">.</span><span class="na">udf</span><span class="o">().</span><span class="na">register</span><span class="o">(</span>
  <span class="s">"countTokens"</span><span class="o">,</span> <span class="o">(</span><span class="nc">Seq</span><span class="o">&lt;?&gt;</span> <span class="n">words</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">words</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">sentenceDataFrame</span><span class="o">);</span>
<span class="n">tokenized</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withColumn</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">,</span> <span class="n">callUDF</span><span class="o">(</span><span class="s">"countTokens"</span><span class="o">,</span> <span class="n">col</span><span class="o">(</span><span class="s">"words"</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">regexTokenized</span> <span class="o">=</span> <span class="n">regexTokenizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">sentenceDataFrame</span><span class="o">);</span>
<span class="n">regexTokenized</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"sentence"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withColumn</span><span class="o">(</span><span class="s">"tokens"</span><span class="o">,</span> <span class="n">callUDF</span><span class="o">(</span><span class="s">"countTokens"</span><span class="o">,</span> <span class="n">col</span><span class="o">(</span><span class="s">"words"</span><span class="o">)))</span>
    <span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaTokenizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Tokenizer.html">Tokenizer Python docs</a> and
the <a href="api/python/reference/api/pyspark.ml.feature.RegexTokenizer.html">RegexTokenizer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Tokenizer</span><span class="p">,</span> <span class="n">RegexTokenizer</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>

<span class="n">sentenceDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"Hi I heard about Spark"</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"I wish Java could use case classes"</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"Logistic,regression,models,are,neat"</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"sentence"</span><span class="p">])</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"sentence"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">)</span>

<span class="n">regexTokenizer</span> <span class="o">=</span> <span class="n">RegexTokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"sentence"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="s">"</span><span class="se">\\</span><span class="s">W"</span><span class="p">)</span>
<span class="c1"># alternatively, pattern="\\w+", gaps(False)
</span>
<span class="n">countTokens</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">words</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">),</span> <span class="n">IntegerType</span><span class="p">())</span>

<span class="n">tokenized</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceDataFrame</span><span class="p">)</span>
<span class="n">tokenized</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">,</span> <span class="s">"words"</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"tokens"</span><span class="p">,</span> <span class="n">countTokens</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"words"</span><span class="p">))).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">regexTokenized</span> <span class="o">=</span> <span class="n">regexTokenizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceDataFrame</span><span class="p">)</span>
<span class="n">regexTokenized</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"sentence"</span><span class="p">,</span> <span class="s">"words"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"tokens"</span><span class="p">,</span> <span class="n">countTokens</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"words"</span><span class="p">))).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/tokenizer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="stopwordsremover">StopWordsRemover</h2>
<p><a href="https://en.wikipedia.org/wiki/Stop_words">Stop words</a> are words which
should be excluded from the input, typically because the words appear
frequently and don&#8217;t carry as much meaning.</p>

<p><code class="language-plaintext highlighter-rouge">StopWordsRemover</code> takes as input a sequence of strings (e.g. the output
of a <a href="ml-features.html#tokenizer">Tokenizer</a>) and drops all the stop
words from the input sequences. The list of stopwords is specified by
the <code class="language-plaintext highlighter-rouge">stopWords</code> parameter. Default stop words for some languages are accessible 
by calling <code class="language-plaintext highlighter-rouge">StopWordsRemover.loadDefaultStopWords(language)</code>, for which available 
options are &#8220;danish&#8221;, &#8220;dutch&#8221;, &#8220;english&#8221;, &#8220;finnish&#8221;, &#8220;french&#8221;, &#8220;german&#8221;, &#8220;hungarian&#8221;, 
&#8220;italian&#8221;, &#8220;norwegian&#8221;, &#8220;portuguese&#8221;, &#8220;russian&#8221;, &#8220;spanish&#8221;, &#8220;swedish&#8221; and &#8220;turkish&#8221;. 
A boolean parameter <code class="language-plaintext highlighter-rouge">caseSensitive</code> indicates if the matches should be case sensitive 
(false by default).</p>

<p><strong>Examples</strong></p>

<p>Assume that we have the following DataFrame with columns <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">raw</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | raw
----|----------
 0  | [I, saw, the, red, balloon]
 1  | [Mary, had, a, little, lamb]
</code></pre></div></div>

<p>Applying <code class="language-plaintext highlighter-rouge">StopWordsRemover</code> with <code class="language-plaintext highlighter-rouge">raw</code> as the input column and <code class="language-plaintext highlighter-rouge">filtered</code> as the output
column, we should get the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | raw                         | filtered
----|-----------------------------|--------------------
 0  | [I, saw, the, red, balloon]  |  [saw, red, balloon]
 1  | [Mary, had, a, little, lamb]|[Mary, little, lamb]
</code></pre></div></div>

<p>In <code class="language-plaintext highlighter-rouge">filtered</code>, the stop words &#8220;I&#8221;, &#8220;the&#8221;, &#8220;had&#8221;, and &#8220;a&#8221; have been
filtered out.</p>

<div class="codetabs">

<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/StopWordsRemover.html">StopWordsRemover Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.StopWordsRemover</span>

<span class="k">val</span> <span class="nv">remover</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StopWordsRemover</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"raw"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"filtered"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dataSet</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"I"</span><span class="o">,</span> <span class="s">"saw"</span><span class="o">,</span> <span class="s">"the"</span><span class="o">,</span> <span class="s">"red"</span><span class="o">,</span> <span class="s">"balloon"</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"Mary"</span><span class="o">,</span> <span class="s">"had"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">,</span> <span class="s">"little"</span><span class="o">,</span> <span class="s">"lamb"</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"raw"</span><span class="o">)</span>

<span class="nv">remover</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataSet</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/StopWordsRemoverExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/StopWordsRemover.html">StopWordsRemover Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StopWordsRemover</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">StopWordsRemover</span> <span class="n">remover</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StopWordsRemover</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"raw"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"filtered"</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"I"</span><span class="o">,</span> <span class="s">"saw"</span><span class="o">,</span> <span class="s">"the"</span><span class="o">,</span> <span class="s">"red"</span><span class="o">,</span> <span class="s">"balloon"</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Mary"</span><span class="o">,</span> <span class="s">"had"</span><span class="o">,</span> <span class="s">"a"</span><span class="o">,</span> <span class="s">"little"</span><span class="o">,</span> <span class="s">"lamb"</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span>
    <span class="s">"raw"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">createArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>
<span class="n">remover</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaStopWordsRemoverExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.StopWordsRemover.html">StopWordsRemover Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StopWordsRemover</span>

<span class="n">sentenceData</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s">"I"</span><span class="p">,</span> <span class="s">"saw"</span><span class="p">,</span> <span class="s">"the"</span><span class="p">,</span> <span class="s">"red"</span><span class="p">,</span> <span class="s">"balloon"</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s">"Mary"</span><span class="p">,</span> <span class="s">"had"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"little"</span><span class="p">,</span> <span class="s">"lamb"</span><span class="p">])</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"raw"</span><span class="p">])</span>

<span class="n">remover</span> <span class="o">=</span> <span class="n">StopWordsRemover</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"raw"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"filtered"</span><span class="p">)</span>
<span class="n">remover</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sentenceData</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/stopwords_remover_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="n-gram">$n$-gram</h2>

<p>An <a href="https://en.wikipedia.org/wiki/N-gram">n-gram</a> is a sequence of $n$ tokens (typically words) for some integer $n$. The <code class="language-plaintext highlighter-rouge">NGram</code> class can be used to transform input features into $n$-grams.</p>

<p><code class="language-plaintext highlighter-rouge">NGram</code> takes as input a sequence of strings (e.g. the output of a <a href="ml-features.html#tokenizer">Tokenizer</a>).  The parameter <code class="language-plaintext highlighter-rouge">n</code> is used to determine the number of terms in each $n$-gram. The output will consist of a sequence of $n$-grams where each $n$-gram is represented by a space-delimited string of $n$ consecutive words.  If the input sequence contains fewer than <code class="language-plaintext highlighter-rouge">n</code> strings, no output is produced.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">

<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/NGram.html">NGram Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.NGram</span>

<span class="k">val</span> <span class="nv">wordDataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"Hi"</span><span class="o">,</span> <span class="s">"I"</span><span class="o">,</span> <span class="s">"heard"</span><span class="o">,</span> <span class="s">"about"</span><span class="o">,</span> <span class="s">"Spark"</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"I"</span><span class="o">,</span> <span class="s">"wish"</span><span class="o">,</span> <span class="s">"Java"</span><span class="o">,</span> <span class="s">"could"</span><span class="o">,</span> <span class="s">"use"</span><span class="o">,</span> <span class="s">"case"</span><span class="o">,</span> <span class="s">"classes"</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"Logistic"</span><span class="o">,</span> <span class="s">"regression"</span><span class="o">,</span> <span class="s">"models"</span><span class="o">,</span> <span class="s">"are"</span><span class="o">,</span> <span class="s">"neat"</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"words"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">ngram</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">NGram</span><span class="o">().</span><span class="py">setN</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"ngrams"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">ngramDataFrame</span> <span class="k">=</span> <span class="nv">ngram</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">wordDataFrame</span><span class="o">)</span>
<span class="nv">ngramDataFrame</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"ngrams"</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/NGramExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/NGram.html">NGram Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.NGram</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Hi"</span><span class="o">,</span> <span class="s">"I"</span><span class="o">,</span> <span class="s">"heard"</span><span class="o">,</span> <span class="s">"about"</span><span class="o">,</span> <span class="s">"Spark"</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"I"</span><span class="o">,</span> <span class="s">"wish"</span><span class="o">,</span> <span class="s">"Java"</span><span class="o">,</span> <span class="s">"could"</span><span class="o">,</span> <span class="s">"use"</span><span class="o">,</span> <span class="s">"case"</span><span class="o">,</span> <span class="s">"classes"</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"Logistic"</span><span class="o">,</span> <span class="s">"regression"</span><span class="o">,</span> <span class="s">"models"</span><span class="o">,</span> <span class="s">"are"</span><span class="o">,</span> <span class="s">"neat"</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span>
    <span class="s">"words"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">createArrayType</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">wordDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">NGram</span> <span class="n">ngramTransformer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NGram</span><span class="o">().</span><span class="na">setN</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"words"</span><span class="o">).</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"ngrams"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">ngramDataFrame</span> <span class="o">=</span> <span class="n">ngramTransformer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">wordDataFrame</span><span class="o">);</span>
<span class="n">ngramDataFrame</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"ngrams"</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaNGramExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.NGram.html">NGram Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">NGram</span>

<span class="n">wordDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s">"Hi"</span><span class="p">,</span> <span class="s">"I"</span><span class="p">,</span> <span class="s">"heard"</span><span class="p">,</span> <span class="s">"about"</span><span class="p">,</span> <span class="s">"Spark"</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s">"I"</span><span class="p">,</span> <span class="s">"wish"</span><span class="p">,</span> <span class="s">"Java"</span><span class="p">,</span> <span class="s">"could"</span><span class="p">,</span> <span class="s">"use"</span><span class="p">,</span> <span class="s">"case"</span><span class="p">,</span> <span class="s">"classes"</span><span class="p">]),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="s">"Logistic"</span><span class="p">,</span> <span class="s">"regression"</span><span class="p">,</span> <span class="s">"models"</span><span class="p">,</span> <span class="s">"are"</span><span class="p">,</span> <span class="s">"neat"</span><span class="p">])</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"words"</span><span class="p">])</span>

<span class="n">ngram</span> <span class="o">=</span> <span class="n">NGram</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"words"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"ngrams"</span><span class="p">)</span>

<span class="n">ngramDataFrame</span> <span class="o">=</span> <span class="n">ngram</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">wordDataFrame</span><span class="p">)</span>
<span class="n">ngramDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"ngrams"</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/n_gram_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="binarizer">Binarizer</h2>

<p>Binarization is the process of thresholding numerical features to binary (0/1) features.</p>

<p><code class="language-plaintext highlighter-rouge">Binarizer</code> takes the common parameters <code class="language-plaintext highlighter-rouge">inputCol</code> and <code class="language-plaintext highlighter-rouge">outputCol</code>, as well as the <code class="language-plaintext highlighter-rouge">threshold</code>
for binarization. Feature values greater than the threshold are binarized to 1.0; values equal
to or less than the threshold are binarized to 0.0. Both Vector and Double types are supported
for <code class="language-plaintext highlighter-rouge">inputCol</code>.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Binarizer.html">Binarizer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Binarizer</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">0.8</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"feature"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binarizer</span><span class="k">:</span> <span class="kt">Binarizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Binarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"feature"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"binarized_feature"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setThreshold</span><span class="o">(</span><span class="mf">0.5</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">binarizedDataFrame</span> <span class="k">=</span> <span class="nv">binarizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Binarizer output with Threshold = ${binarizer.getThreshold}"</span><span class="o">)</span>
<span class="nv">binarizedDataFrame</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/BinarizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Binarizer.html">Binarizer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Binarizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">0.8</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"feature"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">continuousDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Binarizer</span> <span class="n">binarizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Binarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"feature"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"binarized_feature"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setThreshold</span><span class="o">(</span><span class="mf">0.5</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">binarizedDataFrame</span> <span class="o">=</span> <span class="n">binarizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">continuousDataFrame</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Binarizer output with Threshold = "</span> <span class="o">+</span> <span class="n">binarizer</span><span class="o">.</span><span class="na">getThreshold</span><span class="o">());</span>
<span class="n">binarizedDataFrame</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaBinarizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Binarizer.html">Binarizer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Binarizer</span>

<span class="n">continuousDataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"feature"</span><span class="p">])</span>

<span class="n">binarizer</span> <span class="o">=</span> <span class="n">Binarizer</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"feature"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"binarized_feature"</span><span class="p">)</span>

<span class="n">binarizedDataFrame</span> <span class="o">=</span> <span class="n">binarizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">continuousDataFrame</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Binarizer output with Threshold = %f"</span> <span class="o">%</span> <span class="n">binarizer</span><span class="p">.</span><span class="n">getThreshold</span><span class="p">())</span>
<span class="n">binarizedDataFrame</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/binarizer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="pca">PCA</h2>

<p><a href="http://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a> is a statistical procedure that uses an orthogonal transformation to convert a set of observations of possibly correlated variables into a set of values of linearly uncorrelated variables called principal components. A <a href="api/scala/org/apache/spark/ml/feature/PCA.html">PCA</a> class trains a model to project vectors to a low-dimensional space using PCA. The example below shows how to project 5-dimensional feature vectors into 3-dimensional principal components.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/PCA.html">PCA Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.PCA</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">))),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">)</span>
<span class="o">)</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">Tuple1</span><span class="o">.</span><span class="py">apply</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">pca</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PCA</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"pcaFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setK</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">pca</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">select</span><span class="o">(</span><span class="s">"pcaFeatures"</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/PCAExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/PCA.html">PCA Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.PCA</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.PCAModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">PCAModel</span> <span class="n">pca</span> <span class="o">=</span> <span class="k">new</span> <span class="no">PCA</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"pcaFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setK</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">select</span><span class="o">(</span><span class="s">"pcaFeatures"</span><span class="o">);</span>
<span class="n">result</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaPCAExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.PCA.html">PCA Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)]),),</span>
        <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),),</span>
        <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]),)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">"features"</span><span class="p">])</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"pcaFeatures"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pca</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">select</span><span class="p">(</span><span class="s">"pcaFeatures"</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/pca_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="polynomialexpansion">PolynomialExpansion</h2>

<p><a href="http://en.wikipedia.org/wiki/Polynomial_expansion">Polynomial expansion</a> is the process of expanding your features into a polynomial space, which is formulated by an n-degree combination of original dimensions. A <a href="api/scala/org/apache/spark/ml/feature/PolynomialExpansion.html">PolynomialExpansion</a> class provides this functionality.  The example below shows how to expand your features into a 3-degree polynomial space.</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/PolynomialExpansion.html">PolynomialExpansion Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.PolynomialExpansion</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)</span>
<span class="o">)</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">Tuple1</span><span class="o">.</span><span class="py">apply</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">polyExpansion</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PolynomialExpansion</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"polyFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setDegree</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">polyDF</span> <span class="k">=</span> <span class="nv">polyExpansion</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">polyDF</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/PolynomialExpansionExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/PolynomialExpansion.html">PolynomialExpansion Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.PolynomialExpansion</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">PolynomialExpansion</span> <span class="n">polyExpansion</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PolynomialExpansion</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"polyFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setDegree</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">polyDF</span> <span class="o">=</span> <span class="n">polyExpansion</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="n">polyDF</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaPolynomialExpansionExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.PolynomialExpansion.html">PolynomialExpansion Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">PolynomialExpansion</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"features"</span><span class="p">])</span>

<span class="n">polyExpansion</span> <span class="o">=</span> <span class="n">PolynomialExpansion</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"polyFeatures"</span><span class="p">)</span>
<span class="n">polyDF</span> <span class="o">=</span> <span class="n">polyExpansion</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">polyDF</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/polynomial_expansion_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="discrete-cosine-transform-dct">Discrete Cosine Transform (DCT)</h2>

<p>The <a href="https://en.wikipedia.org/wiki/Discrete_cosine_transform">Discrete Cosine
Transform</a>
transforms a length $N$ real-valued sequence in the time domain into
another length $N$ real-valued sequence in the frequency domain. A
<a href="api/scala/org/apache/spark/ml/feature/DCT.html">DCT</a> class
provides this functionality, implementing the
<a href="https://en.wikipedia.org/wiki/Discrete_cosine_transform#DCT-II">DCT-II</a>
and scaling the result by $1/\sqrt{2}$ such that the representing matrix
for the transform is unitary. No shift is applied to the transformed
sequence (e.g. the $0$th element of the transformed sequence is the
$0$th DCT coefficient and <em>not</em> the $N/2$th).</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/DCT.html">DCT Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.DCT</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="o">),</span>
  <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">14.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">Tuple1</span><span class="o">.</span><span class="py">apply</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DCT</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"featuresDCT"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInverse</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dctDf</span> <span class="k">=</span> <span class="nv">dct</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">dctDf</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"featuresDCT"</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/DCTExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/DCT.html">DCT Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.DCT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">14.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="no">DCT</span> <span class="n">dct</span> <span class="o">=</span> <span class="k">new</span> <span class="no">DCT</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"featuresDCT"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setInverse</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dctDf</span> <span class="o">=</span> <span class="n">dct</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="n">dctDf</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"featuresDCT"</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaDCTExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.DCT.html">DCT Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">DCT</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">14.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),)],</span> <span class="p">[</span><span class="s">"features"</span><span class="p">])</span>

<span class="n">dct</span> <span class="o">=</span> <span class="n">DCT</span><span class="p">(</span><span class="n">inverse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"featuresDCT"</span><span class="p">)</span>

<span class="n">dctDf</span> <span class="o">=</span> <span class="n">dct</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">dctDf</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"featuresDCT"</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/dct_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="stringindexer">StringIndexer</h2>

<p><code class="language-plaintext highlighter-rouge">StringIndexer</code> encodes a string column of labels to a column of label indices.
<code class="language-plaintext highlighter-rouge">StringIndexer</code> can encode multiple columns. The indices are in <code class="language-plaintext highlighter-rouge">[0, numLabels)</code>, and four ordering options are supported:
&#8220;frequencyDesc&#8221;: descending order by label frequency (most frequent label assigned 0),
&#8220;frequencyAsc&#8221;: ascending order by label frequency (least frequent label assigned 0),
&#8220;alphabetDesc&#8221;: descending alphabetical order, and &#8220;alphabetAsc&#8221;: ascending alphabetical order 
(default = &#8220;frequencyDesc&#8221;). Note that in case of equal frequency when under
&#8220;frequencyDesc&#8221;/&#8221;frequencyAsc&#8221;, the strings are further sorted by alphabet.</p>

<p>The unseen labels will be put at index numLabels if user chooses to keep them.
If the input column is numeric, we cast it to string and index the string
values. When downstream pipeline components such as <code class="language-plaintext highlighter-rouge">Estimator</code> or
<code class="language-plaintext highlighter-rouge">Transformer</code> make use of this string-indexed label, you must set the input
column of the component to this string-indexed column name. In many cases,
you can set the input column with <code class="language-plaintext highlighter-rouge">setInputCol</code>.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have the following DataFrame with columns <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">category</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | category
----|----------
 0  | a
 1  | b
 2  | c
 3  | a
 4  | a
 5  | c
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">category</code> is a string column with three labels: &#8220;a&#8221;, &#8220;b&#8221;, and &#8220;c&#8221;.
Applying <code class="language-plaintext highlighter-rouge">StringIndexer</code> with <code class="language-plaintext highlighter-rouge">category</code> as the input column and <code class="language-plaintext highlighter-rouge">categoryIndex</code> as the output
column, we should get the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | category | categoryIndex
----|----------|---------------
 0  | a        | 0.0
 1  | b        | 2.0
 2  | c        | 1.0
 3  | a        | 0.0
 4  | a        | 0.0
 5  | c        | 1.0
</code></pre></div></div>

<p>&#8220;a&#8221; gets index <code class="language-plaintext highlighter-rouge">0</code> because it is the most frequent, followed by &#8220;c&#8221; with index <code class="language-plaintext highlighter-rouge">1</code> and &#8220;b&#8221; with
index <code class="language-plaintext highlighter-rouge">2</code>.</p>

<p>Additionally, there are three strategies regarding how <code class="language-plaintext highlighter-rouge">StringIndexer</code> will handle
unseen labels when you have fit a <code class="language-plaintext highlighter-rouge">StringIndexer</code> on one dataset and then use it
to transform another:</p>

<ul>
  <li>throw an exception (which is the default)</li>
  <li>skip the row containing the unseen label entirely</li>
  <li>put unseen labels in a special additional bucket, at index numLabels</li>
</ul>

<p><strong>Examples</strong></p>

<p>Let&#8217;s go back to our previous example but this time reuse our previously defined
<code class="language-plaintext highlighter-rouge">StringIndexer</code> on the following dataset:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | category
----|----------
 0  | a
 1  | b
 2  | c
 3  | d
 4  | e
</code></pre></div></div>

<p>If you&#8217;ve not set how <code class="language-plaintext highlighter-rouge">StringIndexer</code> handles unseen labels or set it to
&#8220;error&#8221;, an exception will be thrown.
However, if you had called <code class="language-plaintext highlighter-rouge">setHandleInvalid("skip")</code>, the following dataset
will be generated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | category | categoryIndex
----|----------|---------------
 0  | a        | 0.0
 1  | b        | 2.0
 2  | c        | 1.0
</code></pre></div></div>

<p>Notice that the rows containing &#8220;d&#8221; or &#8220;e&#8221; do not appear.</p>

<p>If you call <code class="language-plaintext highlighter-rouge">setHandleInvalid("keep")</code>, the following dataset
will be generated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | category | categoryIndex
----|----------|---------------
 0  | a        | 0.0
 1  | b        | 2.0
 2  | c        | 1.0
 3  | d        | 3.0
 4  | e        | 3.0
</code></pre></div></div>

<p>Notice that the rows containing &#8220;d&#8221; or &#8220;e&#8221; are mapped to index &#8220;3.0&#8221;</p>

<div class="codetabs">

<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/StringIndexer.html">StringIndexer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.StringIndexer</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"b"</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"c"</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">"c"</span><span class="o">))</span>
<span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"category"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">indexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"category"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">indexed</span> <span class="k">=</span> <span class="nv">indexer</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">indexed</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/StringIndexerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/StringIndexer.html">StringIndexer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StringIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">types</span><span class="o">.</span><span class="na">DataTypes</span><span class="o">.*;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"b"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"c"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">"c"</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"category"</span><span class="o">,</span> <span class="nc">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">StringIndexer</span> <span class="n">indexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"category"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">indexed</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="n">indexed</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaStringIndexerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.StringIndexer.html">StringIndexer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"c"</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">"c"</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">])</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"category"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"categoryIndex"</span><span class="p">)</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">indexer</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">indexed</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/string_indexer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="indextostring">IndexToString</h2>

<p>Symmetrically to <code class="language-plaintext highlighter-rouge">StringIndexer</code>, <code class="language-plaintext highlighter-rouge">IndexToString</code> maps a column of label indices
back to a column containing the original labels as strings. A common use case
is to produce indices from labels with <code class="language-plaintext highlighter-rouge">StringIndexer</code>, train a model with those
indices and retrieve the original labels from the column of predicted indices
with <code class="language-plaintext highlighter-rouge">IndexToString</code>. However, you are free to supply your own labels.</p>

<p><strong>Examples</strong></p>

<p>Building on the <code class="language-plaintext highlighter-rouge">StringIndexer</code> example, let&#8217;s assume we have the following
DataFrame with columns <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">categoryIndex</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | categoryIndex
----|---------------
 0  | 0.0
 1  | 2.0
 2  | 1.0
 3  | 0.0
 4  | 0.0
 5  | 1.0
</code></pre></div></div>

<p>Applying <code class="language-plaintext highlighter-rouge">IndexToString</code> with <code class="language-plaintext highlighter-rouge">categoryIndex</code> as the input column,
<code class="language-plaintext highlighter-rouge">originalCategory</code> as the output column, we are able to retrieve our original
labels (they will be inferred from the columns&#8217; metadata):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | categoryIndex | originalCategory
----|---------------|-----------------
 0  | 0.0           | a
 1  | 2.0           | b
 2  | 1.0           | c
 3  | 0.0           | a
 4  | 0.0           | a
 5  | 1.0           | c
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/IndexToString.html">IndexToString Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.attribute.Attribute</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">IndexToString</span><span class="o">,</span> <span class="nc">StringIndexer</span><span class="o">}</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"b"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"c"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">"c"</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"category"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">indexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"category"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">indexed</span> <span class="k">=</span> <span class="nv">indexer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Transformed string column '${indexer.getInputCol}' "</span> <span class="o">+</span>
    <span class="n">s</span><span class="s">"to indexed column '${indexer.getOutputCol}'"</span><span class="o">)</span>
<span class="nv">indexed</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>

<span class="k">val</span> <span class="nv">inputColSchema</span> <span class="k">=</span> <span class="nv">indexed</span><span class="o">.</span><span class="py">schema</span><span class="o">(</span><span class="nv">indexer</span><span class="o">.</span><span class="py">getOutputCol</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"StringIndexer will store labels in output column metadata: "</span> <span class="o">+</span>
    <span class="n">s</span><span class="s">"${Attribute.fromStructField(inputColSchema).toString}\n"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">converter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"originalCategory"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">converted</span> <span class="k">=</span> <span class="nv">converter</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">indexed</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Transformed indexed column '${converter.getInputCol}' back to original string "</span> <span class="o">+</span>
    <span class="n">s</span><span class="s">"column '${converter.getOutputCol}' using labels in metadata"</span><span class="o">)</span>
<span class="nv">converted</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"categoryIndex"</span><span class="o">,</span> <span class="s">"originalCategory"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/IndexToStringExample.scala" in the Spark repo.</small></div>

  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/IndexToString.html">IndexToString Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.attribute.Attribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.IndexToString</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StringIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StringIndexerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">"b"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"c"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">"a"</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="s">"c"</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"category"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">StringIndexerModel</span> <span class="n">indexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"category"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">indexed</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Transformed string column '"</span> <span class="o">+</span> <span class="n">indexer</span><span class="o">.</span><span class="na">getInputCol</span><span class="o">()</span> <span class="o">+</span> <span class="s">"' "</span> <span class="o">+</span>
    <span class="s">"to indexed column '"</span> <span class="o">+</span> <span class="n">indexer</span><span class="o">.</span><span class="na">getOutputCol</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span><span class="o">);</span>
<span class="n">indexed</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>

<span class="nc">StructField</span> <span class="n">inputColSchema</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="na">schema</span><span class="o">().</span><span class="na">apply</span><span class="o">(</span><span class="n">indexer</span><span class="o">.</span><span class="na">getOutputCol</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"StringIndexer will store labels in output column metadata: "</span> <span class="o">+</span>
    <span class="nc">Attribute</span><span class="o">.</span><span class="na">fromStructField</span><span class="o">(</span><span class="n">inputColSchema</span><span class="o">).</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>

<span class="nc">IndexToString</span> <span class="n">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IndexToString</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"categoryIndex"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"originalCategory"</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">converted</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">indexed</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Transformed indexed column '"</span> <span class="o">+</span> <span class="n">converter</span><span class="o">.</span><span class="na">getInputCol</span><span class="o">()</span> <span class="o">+</span> <span class="s">"' back to "</span> <span class="o">+</span>
    <span class="s">"original string column '"</span> <span class="o">+</span> <span class="n">converter</span><span class="o">.</span><span class="na">getOutputCol</span><span class="o">()</span> <span class="o">+</span> <span class="s">"' using labels in metadata"</span><span class="o">);</span>
<span class="n">converted</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"categoryIndex"</span><span class="o">,</span> <span class="s">"originalCategory"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaIndexToStringExample.java" in the Spark repo.</small></div>

  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.IndexToString.html">IndexToString Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"b"</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">"c"</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s">"a"</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s">"c"</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"category"</span><span class="p">])</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"category"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"categoryIndex"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">indexer</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Transformed string column '%s' to indexed column '%s'"</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">indexer</span><span class="p">.</span><span class="n">getInputCol</span><span class="p">(),</span> <span class="n">indexer</span><span class="p">.</span><span class="n">getOutputCol</span><span class="p">()))</span>
<span class="n">indexed</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"StringIndexer will store labels in output column metadata</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>

<span class="n">converter</span> <span class="o">=</span> <span class="n">IndexToString</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"categoryIndex"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"originalCategory"</span><span class="p">)</span>
<span class="n">converted</span> <span class="o">=</span> <span class="n">converter</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">indexed</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Transformed indexed column '%s' back to original string column '%s' using "</span>
      <span class="s">"labels in metadata"</span> <span class="o">%</span> <span class="p">(</span><span class="n">converter</span><span class="p">.</span><span class="n">getInputCol</span><span class="p">(),</span> <span class="n">converter</span><span class="p">.</span><span class="n">getOutputCol</span><span class="p">()))</span>
<span class="n">converted</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"categoryIndex"</span><span class="p">,</span> <span class="s">"originalCategory"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/index_to_string_example.py" in the Spark repo.</small></div>

  </div>
</div>

<h2 id="onehotencoder">OneHotEncoder</h2>

<p><a href="http://en.wikipedia.org/wiki/One-hot">One-hot encoding</a> maps a categorical feature, represented as a label index, to a binary vector with at most a single one-value indicating the presence of a specific feature value from among the set of all feature values. This encoding allows algorithms which expect continuous features, such as Logistic Regression, to use categorical features. For string type input data, it is common to encode categorical features using <a href="ml-features.html#stringindexer">StringIndexer</a> first.</p>

<p><code class="language-plaintext highlighter-rouge">OneHotEncoder</code> can transform multiple columns, returning an one-hot-encoded output vector column for each input column. It is common to merge these vectors into a single feature vector using <a href="ml-features.html#vectorassembler">VectorAssembler</a>.</p>

<p><code class="language-plaintext highlighter-rouge">OneHotEncoder</code> supports the <code class="language-plaintext highlighter-rouge">handleInvalid</code> parameter to choose how to handle invalid input during transforming data. Available options include &#8216;keep&#8217; (any invalid inputs are assigned to an extra categorical index) and &#8216;error&#8217; (throw an error).</p>

<p><strong>Examples</strong></p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/OneHotEncoder.html">OneHotEncoder Scala docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.OneHotEncoder</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"categoryIndex1"</span><span class="o">,</span> <span class="s">"categoryIndex2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">encoder</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">OneHotEncoder</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"categoryIndex1"</span><span class="o">,</span> <span class="s">"categoryIndex2"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"categoryVec1"</span><span class="o">,</span> <span class="s">"categoryVec2"</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">encoder</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">encoded</span> <span class="k">=</span> <span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">encoded</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/OneHotEncoderExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/OneHotEncoder.html">OneHotEncoder Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.OneHotEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.OneHotEncoderModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"categoryIndex1"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"categoryIndex2"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">OneHotEncoder</span> <span class="n">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OneHotEncoder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"categoryIndex1"</span><span class="o">,</span> <span class="s">"categoryIndex2"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"categoryVec1"</span><span class="o">,</span> <span class="s">"categoryVec2"</span><span class="o">});</span>

<span class="nc">OneHotEncoderModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">encoded</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="n">encoded</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaOneHotEncoderExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.OneHotEncoder.html">OneHotEncoder Python docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"categoryIndex1"</span><span class="p">,</span> <span class="s">"categoryIndex2"</span><span class="p">])</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"categoryIndex1"</span><span class="p">,</span> <span class="s">"categoryIndex2"</span><span class="p">],</span>
                        <span class="n">outputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"categoryVec1"</span><span class="p">,</span> <span class="s">"categoryVec2"</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">encoded</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/onehot_encoder_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="vectorindexer">VectorIndexer</h2>

<p><code class="language-plaintext highlighter-rouge">VectorIndexer</code> helps index categorical features in datasets of <code class="language-plaintext highlighter-rouge">Vector</code>s.
It can both automatically decide which features are categorical and convert original values to category indices.  Specifically, it does the following:</p>

<ol>
  <li>Take an input column of type <a href="api/scala/org/apache/spark/ml/linalg/Vector.html">Vector</a> and a parameter <code class="language-plaintext highlighter-rouge">maxCategories</code>.</li>
  <li>Decide which features should be categorical based on the number of distinct values, where features with at most <code class="language-plaintext highlighter-rouge">maxCategories</code> are declared categorical.</li>
  <li>Compute 0-based category indices for each categorical feature.</li>
  <li>Index categorical features and transform original feature values to indices.</li>
</ol>

<p>Indexing categorical features allows algorithms such as Decision Trees and Tree Ensembles to treat categorical features appropriately, improving performance.</p>

<p><strong>Examples</strong></p>

<p>In the example below, we read in a dataset of labeled points and then use <code class="language-plaintext highlighter-rouge">VectorIndexer</code> to decide which features should be treated as categorical.  We transform the categorical feature values to their indices.  This transformed data could then be passed to algorithms such as <code class="language-plaintext highlighter-rouge">DecisionTreeRegressor</code> that handle categorical features.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/VectorIndexer.html">VectorIndexer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">indexer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"indexed"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setMaxCategories</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">indexerModel</span> <span class="k">=</span> <span class="nv">indexer</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">categoricalFeatures</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">indexerModel</span><span class="o">.</span><span class="py">categoryMaps</span><span class="o">.</span><span class="py">keys</span><span class="o">.</span><span class="py">toSet</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Chose ${categoricalFeatures.size} "</span> <span class="o">+</span>
  <span class="n">s</span><span class="s">"categorical features: ${categoricalFeatures.mkString("</span><span class="o">,</span> <span class="s">")}"</span><span class="o">)</span>

<span class="c1">// Create new column "indexed" with categorical values transformed to indices</span>
<span class="k">val</span> <span class="nv">indexedData</span> <span class="k">=</span> <span class="nv">indexerModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="nv">indexedData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/VectorIndexerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/VectorIndexer.html">VectorIndexer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorIndexerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">);</span>

<span class="nc">VectorIndexer</span> <span class="n">indexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorIndexer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"indexed"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxCategories</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
<span class="nc">VectorIndexerModel</span> <span class="n">indexerModel</span> <span class="o">=</span> <span class="n">indexer</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>

<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;&gt;</span> <span class="n">categoryMaps</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="na">javaCategoryMaps</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Chose "</span> <span class="o">+</span> <span class="n">categoryMaps</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" categorical features:"</span><span class="o">);</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">Integer</span> <span class="n">feature</span> <span class="o">:</span> <span class="n">categoryMaps</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">" "</span> <span class="o">+</span> <span class="n">feature</span><span class="o">);</span>
<span class="o">}</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>

<span class="c1">// Create new column "indexed" with categorical values transformed to indices</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">indexedData</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
<span class="n">indexedData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaVectorIndexerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.VectorIndexer.html">VectorIndexer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorIndexer</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"libsvm"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="p">)</span>

<span class="n">indexer</span> <span class="o">=</span> <span class="n">VectorIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"indexed"</span><span class="p">,</span> <span class="n">maxCategories</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">indexerModel</span> <span class="o">=</span> <span class="n">indexer</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">categoricalFeatures</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="p">.</span><span class="n">categoryMaps</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Chose %d categorical features: %s"</span> <span class="o">%</span>
      <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">categoricalFeatures</span><span class="p">),</span> <span class="s">", "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">categoricalFeatures</span><span class="p">.</span><span class="n">keys</span><span class="p">())))</span>

<span class="c1"># Create new column "indexed" with categorical values transformed to indices
</span><span class="n">indexedData</span> <span class="o">=</span> <span class="n">indexerModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">indexedData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/vector_indexer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="interaction">Interaction</h2>

<p><code class="language-plaintext highlighter-rouge">Interaction</code> is a <code class="language-plaintext highlighter-rouge">Transformer</code> which takes vector or double-valued columns, and generates a single vector column that contains the product of all combinations of one value from each input column.</p>

<p>For example, if you have 2 vector type columns each of which has 3 dimensions as input columns, then you&#8217;ll get a 9-dimensional vector as the output column.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have the following DataFrame with the columns &#8220;id1&#8221;, &#8220;vec1&#8221;, and &#8220;vec2&#8221;:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id1|vec1          |vec2          
  ---|--------------|--------------
  1  |[1.0,2.0,3.0] |[8.0,4.0,5.0] 
  2  |[4.0,3.0,8.0] |[7.0,9.0,8.0] 
  3  |[6.0,1.0,9.0] |[2.0,3.0,6.0] 
  4  |[10.0,8.0,6.0]|[9.0,4.0,5.0] 
  5  |[9.0,2.0,7.0] |[10.0,7.0,3.0]
  6  |[1.0,1.0,4.0] |[2.0,8.0,4.0]     
</code></pre></div></div>

<p>Applying <code class="language-plaintext highlighter-rouge">Interaction</code> with those input columns,
then <code class="language-plaintext highlighter-rouge">interactedCol</code> as the output column contains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  id1|vec1          |vec2          |interactedCol                                         
  ---|--------------|--------------|------------------------------------------------------
  1  |[1.0,2.0,3.0] |[8.0,4.0,5.0] |[8.0,4.0,5.0,16.0,8.0,10.0,24.0,12.0,15.0]            
  2  |[4.0,3.0,8.0] |[7.0,9.0,8.0] |[56.0,72.0,64.0,42.0,54.0,48.0,112.0,144.0,128.0]     
  3  |[6.0,1.0,9.0] |[2.0,3.0,6.0] |[36.0,54.0,108.0,6.0,9.0,18.0,54.0,81.0,162.0]        
  4  |[10.0,8.0,6.0]|[9.0,4.0,5.0] |[360.0,160.0,200.0,288.0,128.0,160.0,216.0,96.0,120.0]
  5  |[9.0,2.0,7.0] |[10.0,7.0,3.0]|[450.0,315.0,135.0,100.0,70.0,30.0,350.0,245.0,105.0] 
  6  |[1.0,1.0,4.0] |[2.0,8.0,4.0] |[12.0,48.0,24.0,12.0,48.0,24.0,48.0,192.0,96.0]       
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Interaction.html">Interaction Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Interaction</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorAssembler</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">8</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id1"</span><span class="o">,</span> <span class="s">"id2"</span><span class="o">,</span> <span class="s">"id3"</span><span class="o">,</span> <span class="s">"id4"</span><span class="o">,</span> <span class="s">"id5"</span><span class="o">,</span> <span class="s">"id6"</span><span class="o">,</span> <span class="s">"id7"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembler1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">().</span>
  <span class="nf">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"id2"</span><span class="o">,</span> <span class="s">"id3"</span><span class="o">,</span> <span class="s">"id4"</span><span class="o">)).</span>
  <span class="nf">setOutputCol</span><span class="o">(</span><span class="s">"vec1"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembled1</span> <span class="k">=</span> <span class="nv">assembler1</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembler2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">().</span>
  <span class="nf">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"id5"</span><span class="o">,</span> <span class="s">"id6"</span><span class="o">,</span> <span class="s">"id7"</span><span class="o">)).</span>
  <span class="nf">setOutputCol</span><span class="o">(</span><span class="s">"vec2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembled2</span> <span class="k">=</span> <span class="nv">assembler2</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">assembled1</span><span class="o">).</span><span class="py">select</span><span class="o">(</span><span class="s">"id1"</span><span class="o">,</span> <span class="s">"vec1"</span><span class="o">,</span> <span class="s">"vec2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">interaction</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Interaction</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"id1"</span><span class="o">,</span> <span class="s">"vec1"</span><span class="o">,</span> <span class="s">"vec2"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"interactedCol"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">interacted</span> <span class="k">=</span> <span class="nv">interaction</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">assembled2</span><span class="o">)</span>

<span class="nv">interacted</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="n">truncate</span> <span class="k">=</span> <span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/InteractionExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Interaction.html">Interaction Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">8</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">6</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id1"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id2"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id3"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id4"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id5"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id6"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id7"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">VectorAssembler</span> <span class="n">assembler1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"id2"</span><span class="o">,</span> <span class="s">"id3"</span><span class="o">,</span> <span class="s">"id4"</span><span class="o">})</span>
        <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"vec1"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">assembled1</span> <span class="o">=</span> <span class="n">assembler1</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">VectorAssembler</span> <span class="n">assembler2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"id5"</span><span class="o">,</span> <span class="s">"id6"</span><span class="o">,</span> <span class="s">"id7"</span><span class="o">})</span>
        <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"vec2"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">assembled2</span> <span class="o">=</span> <span class="n">assembler2</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">assembled1</span><span class="o">).</span><span class="na">select</span><span class="o">(</span><span class="s">"id1"</span><span class="o">,</span> <span class="s">"vec1"</span><span class="o">,</span> <span class="s">"vec2"</span><span class="o">);</span>

<span class="nc">Interaction</span> <span class="n">interaction</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Interaction</span><span class="o">()</span>
        <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"id1"</span><span class="o">,</span><span class="s">"vec1"</span><span class="o">,</span><span class="s">"vec2"</span><span class="o">})</span>
        <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"interactedCol"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">interacted</span> <span class="o">=</span> <span class="n">interaction</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">assembled2</span><span class="o">);</span>

<span class="n">interacted</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaInteractionExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Interaction.html">Interaction Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Interaction</span><span class="p">,</span> <span class="n">VectorAssembler</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id1"</span><span class="p">,</span> <span class="s">"id2"</span><span class="p">,</span> <span class="s">"id3"</span><span class="p">,</span> <span class="s">"id4"</span><span class="p">,</span> <span class="s">"id5"</span><span class="p">,</span> <span class="s">"id6"</span><span class="p">,</span> <span class="s">"id7"</span><span class="p">])</span>

<span class="n">assembler1</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"id2"</span><span class="p">,</span> <span class="s">"id3"</span><span class="p">,</span> <span class="s">"id4"</span><span class="p">],</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"vec1"</span><span class="p">)</span>

<span class="n">assembled1</span> <span class="o">=</span> <span class="n">assembler1</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">assembler2</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"id5"</span><span class="p">,</span> <span class="s">"id6"</span><span class="p">,</span> <span class="s">"id7"</span><span class="p">],</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"vec2"</span><span class="p">)</span>

<span class="n">assembled2</span> <span class="o">=</span> <span class="n">assembler2</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled1</span><span class="p">).</span><span class="n">select</span><span class="p">(</span><span class="s">"id1"</span><span class="p">,</span> <span class="s">"vec1"</span><span class="p">,</span> <span class="s">"vec2"</span><span class="p">)</span>

<span class="n">interaction</span> <span class="o">=</span> <span class="n">Interaction</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"id1"</span><span class="p">,</span> <span class="s">"vec1"</span><span class="p">,</span> <span class="s">"vec2"</span><span class="p">],</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"interactedCol"</span><span class="p">)</span>

<span class="n">interacted</span> <span class="o">=</span> <span class="n">interaction</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">assembled2</span><span class="p">)</span>

<span class="n">interacted</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/interaction_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="normalizer">Normalizer</h2>

<p><code class="language-plaintext highlighter-rouge">Normalizer</code> is a <code class="language-plaintext highlighter-rouge">Transformer</code> which transforms a dataset of <code class="language-plaintext highlighter-rouge">Vector</code> rows, normalizing each <code class="language-plaintext highlighter-rouge">Vector</code> to have unit norm.  It takes parameter <code class="language-plaintext highlighter-rouge">p</code>, which specifies the <a href="http://en.wikipedia.org/wiki/Norm_%28mathematics%29#p-norm">p-norm</a> used for normalization.  ($p = 2$ by default.)  This normalization can help standardize your input data and improve the behavior of learning algorithms.</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to load a dataset in libsvm format and then normalize each row to have unit $L^1$ norm and unit $L^\infty$ norm.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Normalizer.html">Normalizer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Normalizer</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="c1">// Normalize each Vector using $L^1$ norm.</span>
<span class="k">val</span> <span class="nv">normalizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Normalizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"normFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setP</span><span class="o">(</span><span class="mf">1.0</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">l1NormData</span> <span class="k">=</span> <span class="nv">normalizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Normalized using L^1 norm"</span><span class="o">)</span>
<span class="nv">l1NormData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Normalize each Vector using $L^\infty$ norm.</span>
<span class="k">val</span> <span class="nv">lInfNormData</span> <span class="k">=</span> <span class="nv">normalizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">,</span> <span class="nv">normalizer</span><span class="o">.</span><span class="py">p</span> <span class="o">-&gt;</span> <span class="nv">Double</span><span class="o">.</span><span class="py">PositiveInfinity</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Normalized using L^inf norm"</span><span class="o">)</span>
<span class="nv">lInfNormData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/NormalizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Normalizer.html">Normalizer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Normalizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="c1">// Normalize each Vector using $L^1$ norm.</span>
<span class="nc">Normalizer</span> <span class="n">normalizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Normalizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"normFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setP</span><span class="o">(</span><span class="mf">1.0</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">l1NormData</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>
<span class="n">l1NormData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Normalize each Vector using $L^\infty$ norm.</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">lInfNormData</span> <span class="o">=</span>
  <span class="n">normalizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">,</span> <span class="n">normalizer</span><span class="o">.</span><span class="na">p</span><span class="o">().</span><span class="na">w</span><span class="o">(</span><span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">));</span>
<span class="n">lInfNormData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaNormalizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Normalizer.html">Normalizer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Normalizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="c1"># Normalize each Vector using $L^1$ norm.
</span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">Normalizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"normFeatures"</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">l1NormData</span> <span class="o">=</span> <span class="n">normalizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Normalized using L^1 norm"</span><span class="p">)</span>
<span class="n">l1NormData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Normalize each Vector using $L^\infty$ norm.
</span><span class="n">lInfNormData</span> <span class="o">=</span> <span class="n">normalizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">,</span> <span class="p">{</span><span class="n">normalizer</span><span class="p">.</span><span class="n">p</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)})</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Normalized using L^inf norm"</span><span class="p">)</span>
<span class="n">lInfNormData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/normalizer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="standardscaler">StandardScaler</h2>

<p><code class="language-plaintext highlighter-rouge">StandardScaler</code> transforms a dataset of <code class="language-plaintext highlighter-rouge">Vector</code> rows, normalizing each feature to have unit standard deviation and/or zero mean.  It takes parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">withStd</code>: True by default. Scales the data to unit standard deviation.</li>
  <li><code class="language-plaintext highlighter-rouge">withMean</code>: False by default. Centers the data with mean before scaling. It will build a dense output, so take care when applying to sparse input.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">StandardScaler</code> is an <code class="language-plaintext highlighter-rouge">Estimator</code> which can be <code class="language-plaintext highlighter-rouge">fit</code> on a dataset to produce a <code class="language-plaintext highlighter-rouge">StandardScalerModel</code>; this amounts to computing summary statistics.  The model can then transform a <code class="language-plaintext highlighter-rouge">Vector</code> column in a dataset to have unit standard deviation and/or zero mean features.</p>

<p>Note that if the standard deviation of a feature is zero, it will return default <code class="language-plaintext highlighter-rouge">0.0</code> value in the <code class="language-plaintext highlighter-rouge">Vector</code> for that feature.</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to load a dataset in libsvm format and then normalize each feature to have unit standard deviation.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/StandardScaler.html">StandardScaler Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.StandardScaler</span>

<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">scaler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StandardScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setWithStd</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setWithMean</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="c1">// Compute summary statistics by fitting the StandardScaler.</span>
<span class="k">val</span> <span class="nv">scalerModel</span> <span class="k">=</span> <span class="nv">scaler</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="c1">// Normalize each feature to have unit standard deviation.</span>
<span class="k">val</span> <span class="nv">scaledData</span> <span class="k">=</span> <span class="nv">scalerModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>
<span class="nv">scaledData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/StandardScalerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/StandardScaler.html">StandardScaler Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StandardScaler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.StandardScalerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span>
  <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">);</span>

<span class="nc">StandardScaler</span> <span class="n">scaler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setWithStd</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setWithMean</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

<span class="c1">// Compute summary statistics by fitting the StandardScaler</span>
<span class="nc">StandardScalerModel</span> <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="c1">// Normalize each feature to have unit standard deviation.</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>
<span class="n">scaledData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaStandardScalerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.StandardScaler.html">StandardScaler Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"libsvm"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="p">)</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"scaledFeatures"</span><span class="p">,</span>
                        <span class="n">withStd</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">withMean</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Compute summary statistics by fitting the StandardScaler
</span><span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="c1"># Normalize each feature to have unit standard deviation.
</span><span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="n">scaledData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/standard_scaler_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="robustscaler">RobustScaler</h2>

<p><code class="language-plaintext highlighter-rouge">RobustScaler</code> transforms a dataset of <code class="language-plaintext highlighter-rouge">Vector</code> rows, removing the median and scaling the data according to a specific quantile range (by default the IQR: Interquartile Range, quantile range between the 1st quartile and the 3rd quartile). Its behavior is quite similar to <code class="language-plaintext highlighter-rouge">StandardScaler</code>, however the median and the quantile range are used instead of mean and standard deviation, which make it robust to outliers. It takes parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">lower</code>: 0.25 by default. Lower quantile to calculate quantile range, shared by all features.</li>
  <li><code class="language-plaintext highlighter-rouge">upper</code>: 0.75 by default. Upper quantile to calculate quantile range, shared by all features.</li>
  <li><code class="language-plaintext highlighter-rouge">withScaling</code>: True by default. Scales the data to quantile range.</li>
  <li><code class="language-plaintext highlighter-rouge">withCentering</code>: False by default. Centers the data with median before scaling. It will build a dense output, so take care when applying to sparse input.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">RobustScaler</code> is an <code class="language-plaintext highlighter-rouge">Estimator</code> which can be <code class="language-plaintext highlighter-rouge">fit</code> on a dataset to produce a <code class="language-plaintext highlighter-rouge">RobustScalerModel</code>; this amounts to computing quantile statistics.  The model can then transform a <code class="language-plaintext highlighter-rouge">Vector</code> column in a dataset to have unit quantile range and/or zero median features.</p>

<p>Note that if the quantile range of a feature is zero, it will return default <code class="language-plaintext highlighter-rouge">0.0</code> value in the <code class="language-plaintext highlighter-rouge">Vector</code> for that feature.</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to load a dataset in libsvm format and then normalize each feature to have unit quantile range.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/RobustScaler.html">RobustScaler Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.RobustScaler</span>

<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span><span class="o">.</span><span class="py">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="py">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">scaler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RobustScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setWithScaling</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setWithCentering</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLower</span><span class="o">(</span><span class="mf">0.25</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setUpper</span><span class="o">(</span><span class="mf">0.75</span><span class="o">)</span>

<span class="c1">// Compute summary statistics by fitting the RobustScaler.</span>
<span class="k">val</span> <span class="nv">scalerModel</span> <span class="k">=</span> <span class="nv">scaler</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="c1">// Transform each feature to have unit quantile range.</span>
<span class="k">val</span> <span class="nv">scaledData</span> <span class="k">=</span> <span class="nv">scalerModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>
<span class="nv">scaledData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/RobustScalerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/RobustScaler.html">RobustScaler Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.RobustScaler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.RobustScalerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span>
  <span class="n">spark</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">format</span><span class="o">(</span><span class="s">"libsvm"</span><span class="o">).</span><span class="na">load</span><span class="o">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="o">);</span>

<span class="nc">RobustScaler</span> <span class="n">scaler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RobustScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setWithScaling</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setWithCentering</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLower</span><span class="o">(</span><span class="mf">0.25</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUpper</span><span class="o">(</span><span class="mf">0.75</span><span class="o">);</span>

<span class="c1">// Compute summary statistics by fitting the RobustScaler</span>
<span class="nc">RobustScalerModel</span> <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="c1">// Transform each feature to have unit quantile range.</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>
<span class="n">scaledData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaRobustScalerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.RobustScaler.html">RobustScaler Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">RobustScaler</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"libsvm"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">"data/mllib/sample_libsvm_data.txt"</span><span class="p">)</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"scaledFeatures"</span><span class="p">,</span>
                      <span class="n">withScaling</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">withCentering</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">lower</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="c1"># Compute summary statistics by fitting the RobustScaler
</span><span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="c1"># Transform each feature to have unit quantile range.
</span><span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="n">scaledData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/robust_scaler_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="minmaxscaler">MinMaxScaler</h2>

<p><code class="language-plaintext highlighter-rouge">MinMaxScaler</code> transforms a dataset of <code class="language-plaintext highlighter-rouge">Vector</code> rows, rescaling each feature to a specific range (often [0, 1]).  It takes parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">min</code>: 0.0 by default. Lower bound after transformation, shared by all features.</li>
  <li><code class="language-plaintext highlighter-rouge">max</code>: 1.0 by default. Upper bound after transformation, shared by all features.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">MinMaxScaler</code> computes summary statistics on a data set and produces a <code class="language-plaintext highlighter-rouge">MinMaxScalerModel</code>. The model can then transform each feature individually such that it is in the given range.</p>

<p>The rescaled value for a feature E is calculated as,
<code class="language-plaintext highlighter-rouge">\begin{equation}
  Rescaled(e_i) = \frac{e_i - E_{min}}{E_{max} - E_{min}} * (max - min) + min
\end{equation}</code>
For the case <code class="language-plaintext highlighter-rouge">$E_{max} == E_{min}$</code>, <code class="language-plaintext highlighter-rouge">$Rescaled(e_i) = 0.5 * (max + min)$</code></p>

<p>Note that since zero values will probably be transformed to non-zero values, output of the transformer will be <code class="language-plaintext highlighter-rouge">DenseVector</code> even for sparse input.</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to load a dataset in libsvm format and then rescale each feature to [0, 1].</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/MinMaxScaler.html">MinMaxScaler Scala docs</a>
and the <a href="api/scala/org/apache/spark/ml/feature/MinMaxScalerModel.html">MinMaxScalerModel Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.MinMaxScaler</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="mf">10.1</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">scaler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MinMaxScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>

<span class="c1">// Compute summary statistics and generate MinMaxScalerModel</span>
<span class="k">val</span> <span class="nv">scalerModel</span> <span class="k">=</span> <span class="nv">scaler</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="c1">// rescale each feature to range [min, max].</span>
<span class="k">val</span> <span class="nv">scaledData</span> <span class="k">=</span> <span class="nv">scalerModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Features scaled to range: [${scaler.getMin}, ${scaler.getMax}]"</span><span class="o">)</span>
<span class="nv">scaledData</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"scaledFeatures"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/MinMaxScalerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/MinMaxScaler.html">MinMaxScaler Java docs</a>
and the <a href="api/java/org/apache/spark/ml/feature/MinMaxScalerModel.html">MinMaxScalerModel Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MinMaxScaler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MinMaxScalerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">3.0</span><span class="o">,</span> <span class="mf">10.1</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">MinMaxScaler</span> <span class="n">scaler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MinMaxScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">);</span>

<span class="c1">// Compute summary statistics and generate MinMaxScalerModel</span>
<span class="nc">MinMaxScalerModel</span> <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="c1">// rescale each feature to range [min, max].</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Features scaled to range: ["</span> <span class="o">+</span> <span class="n">scaler</span><span class="o">.</span><span class="na">getMin</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span>
    <span class="o">+</span> <span class="n">scaler</span><span class="o">.</span><span class="na">getMax</span><span class="o">()</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
<span class="n">scaledData</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"scaledFeatures"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaMinMaxScalerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.MinMaxScaler.html">MinMaxScaler Python docs</a>
and the <a href="api/python/reference/api/pyspark.ml.feature.MinMaxScalerModel.html">MinMaxScalerModel Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"scaledFeatures"</span><span class="p">)</span>

<span class="c1"># Compute summary statistics and generate MinMaxScalerModel
</span><span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="c1"># rescale each feature to range [min, max].
</span><span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Features scaled to range: [%f, %f]"</span> <span class="o">%</span> <span class="p">(</span><span class="n">scaler</span><span class="p">.</span><span class="n">getMin</span><span class="p">(),</span> <span class="n">scaler</span><span class="p">.</span><span class="n">getMax</span><span class="p">()))</span>
<span class="n">scaledData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"features"</span><span class="p">,</span> <span class="s">"scaledFeatures"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/min_max_scaler_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="maxabsscaler">MaxAbsScaler</h2>

<p><code class="language-plaintext highlighter-rouge">MaxAbsScaler</code> transforms a dataset of <code class="language-plaintext highlighter-rouge">Vector</code> rows, rescaling each feature to range [-1, 1] 
by dividing through the maximum absolute value in each feature. It does not shift/center the 
data, and thus does not destroy any sparsity.</p>

<p><code class="language-plaintext highlighter-rouge">MaxAbsScaler</code> computes summary statistics on a data set and produces a <code class="language-plaintext highlighter-rouge">MaxAbsScalerModel</code>. The 
model can then transform each feature individually to range [-1, 1].</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to load a dataset in libsvm format and then rescale each feature to [-1, 1].</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/MaxAbsScaler.html">MaxAbsScaler Scala docs</a>
and the <a href="api/scala/org/apache/spark/ml/feature/MaxAbsScalerModel.html">MaxAbsScalerModel Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.MaxAbsScaler</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">scaler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MaxAbsScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">)</span>

<span class="c1">// Compute summary statistics and generate MaxAbsScalerModel</span>
<span class="k">val</span> <span class="nv">scalerModel</span> <span class="k">=</span> <span class="nv">scaler</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="c1">// rescale each feature to range [-1, 1]</span>
<span class="k">val</span> <span class="nv">scaledData</span> <span class="k">=</span> <span class="nv">scalerModel</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>
<span class="nv">scaledData</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"scaledFeatures"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/MaxAbsScalerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/MaxAbsScaler.html">MaxAbsScaler Java docs</a>
and the <a href="api/java/org/apache/spark/ml/feature/MaxAbsScalerModel.html">MaxAbsScalerModel Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MaxAbsScaler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MaxAbsScalerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
    <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">MaxAbsScaler</span> <span class="n">scaler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MaxAbsScaler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"scaledFeatures"</span><span class="o">);</span>

<span class="c1">// Compute summary statistics and generate MaxAbsScalerModel</span>
<span class="nc">MaxAbsScalerModel</span> <span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="c1">// rescale each feature to range [-1, 1].</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>
<span class="n">scaledData</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"scaledFeatures"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaMaxAbsScalerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.MaxAbsScaler.html">MaxAbsScaler Python docs</a>
and the <a href="api/python/reference/api/pyspark.ml.feature.MaxAbsScalerModel.html">MaxAbsScalerModel Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">MaxAbsScaler</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">]),),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]),)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MaxAbsScaler</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"scaledFeatures"</span><span class="p">)</span>

<span class="c1"># Compute summary statistics and generate MaxAbsScalerModel
</span><span class="n">scalerModel</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="c1"># rescale each feature to range [-1, 1].
</span><span class="n">scaledData</span> <span class="o">=</span> <span class="n">scalerModel</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="n">scaledData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"features"</span><span class="p">,</span> <span class="s">"scaledFeatures"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/max_abs_scaler_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="bucketizer">Bucketizer</h2>

<p><code class="language-plaintext highlighter-rouge">Bucketizer</code> transforms a column of continuous features to a column of feature buckets, where the buckets are specified by users. It takes a parameter:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">splits</code>: Parameter for mapping continuous features into buckets. With n+1 splits, there are n buckets. A bucket defined by splits x,y holds values in the range [x,y) except the last bucket, which also includes y. Splits should be strictly increasing. Values at -inf, inf must be explicitly provided to cover all Double values; Otherwise, values outside the splits specified will be treated as errors. Two examples of <code class="language-plaintext highlighter-rouge">splits</code> are <code class="language-plaintext highlighter-rouge">Array(Double.NegativeInfinity, 0.0, 1.0, Double.PositiveInfinity)</code> and <code class="language-plaintext highlighter-rouge">Array(0.0, 1.0, 2.0)</code>.</li>
</ul>

<p>Note that if you have no idea of the upper and lower bounds of the targeted column, you should add <code class="language-plaintext highlighter-rouge">Double.NegativeInfinity</code> and <code class="language-plaintext highlighter-rouge">Double.PositiveInfinity</code> as the bounds of your splits to prevent a potential out of Bucketizer bounds exception.</p>

<p>Note also that the splits that you provided have to be in strictly increasing order, i.e. <code class="language-plaintext highlighter-rouge">s0 &lt; s1 &lt; s2 &lt; ... &lt; sn</code>.</p>

<p>More details can be found in the API docs for <a href="api/scala/org/apache/spark/ml/feature/Bucketizer.html">Bucketizer</a>.</p>

<p><strong>Examples</strong></p>

<p>The following example demonstrates how to bucketize a column of <code class="language-plaintext highlighter-rouge">Double</code>s into another index-wised column.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Bucketizer.html">Bucketizer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Bucketizer</span>

<span class="k">val</span> <span class="nv">splits</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="nv">Double</span><span class="o">.</span><span class="py">NegativeInfinity</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">,</span> <span class="nv">Double</span><span class="o">.</span><span class="py">PositiveInfinity</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(-</span><span class="mf">999.9</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.2</span><span class="o">,</span> <span class="mf">999.9</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nv">data</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">Tuple1</span><span class="o">.</span><span class="py">apply</span><span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">bucketizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Bucketizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"bucketedFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSplits</span><span class="o">(</span><span class="n">splits</span><span class="o">)</span>

<span class="c1">// Transform original data into its bucket index.</span>
<span class="k">val</span> <span class="nv">bucketedData</span> <span class="k">=</span> <span class="nv">bucketizer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Bucketizer output with ${bucketizer.getSplits.length-1} buckets"</span><span class="o">)</span>
<span class="nv">bucketedData</span><span class="o">.</span><span class="py">show</span><span class="o">()</span>

<span class="k">val</span> <span class="nv">splitsArray</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span>
  <span class="nc">Array</span><span class="o">(</span><span class="nv">Double</span><span class="o">.</span><span class="py">NegativeInfinity</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">,</span> <span class="nv">Double</span><span class="o">.</span><span class="py">PositiveInfinity</span><span class="o">),</span>
  <span class="nc">Array</span><span class="o">(</span><span class="nv">Double</span><span class="o">.</span><span class="py">NegativeInfinity</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">,</span> <span class="nv">Double</span><span class="o">.</span><span class="py">PositiveInfinity</span><span class="o">))</span>

<span class="k">val</span> <span class="nv">data2</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span>
  <span class="o">(-</span><span class="mf">999.9</span><span class="o">,</span> <span class="o">-</span><span class="mf">999.9</span><span class="o">),</span>
  <span class="o">(-</span><span class="mf">0.5</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">),</span>
  <span class="o">(-</span><span class="mf">0.3</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">0.2</span><span class="o">,</span> <span class="mf">0.4</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">999.9</span><span class="o">,</span> <span class="mf">999.9</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">dataFrame2</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="n">data2</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"features1"</span><span class="o">,</span> <span class="s">"features2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">bucketizer2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Bucketizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"features1"</span><span class="o">,</span> <span class="s">"features2"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"bucketedFeatures1"</span><span class="o">,</span> <span class="s">"bucketedFeatures2"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setSplitsArray</span><span class="o">(</span><span class="n">splitsArray</span><span class="o">)</span>

<span class="c1">// Transform original data into its bucket index.</span>
<span class="k">val</span> <span class="nv">bucketedData2</span> <span class="k">=</span> <span class="nv">bucketizer2</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame2</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Bucketizer output with ["</span> <span class="o">+</span>
  <span class="n">s</span><span class="s">"${bucketizer2.getSplitsArray(0).length-1}, "</span> <span class="o">+</span>
  <span class="n">s</span><span class="s">"${bucketizer2.getSplitsArray(1).length-1}] buckets for each input column"</span><span class="o">)</span>
<span class="nv">bucketedData2</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/BucketizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Bucketizer.html">Bucketizer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Bucketizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="kt">double</span><span class="o">[]</span> <span class="n">splits</span> <span class="o">=</span> <span class="o">{</span><span class="nc">Double</span><span class="o">.</span><span class="na">NEGATIVE_INFINITY</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">};</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">999.9</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">0.5</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">0.3</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.2</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">999.9</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Bucketizer</span> <span class="n">bucketizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Bucketizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"bucketedFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setSplits</span><span class="o">(</span><span class="n">splits</span><span class="o">);</span>

<span class="c1">// Transform original data into its bucket index.</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">bucketedData</span> <span class="o">=</span> <span class="n">bucketizer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Bucketizer output with "</span> <span class="o">+</span> <span class="o">(</span><span class="n">bucketizer</span><span class="o">.</span><span class="na">getSplits</span><span class="o">().</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">" buckets"</span><span class="o">);</span>
<span class="n">bucketedData</span><span class="o">.</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Bucketize multiple columns at one pass.</span>
<span class="kt">double</span><span class="o">[][]</span> <span class="n">splitsArray</span> <span class="o">=</span> <span class="o">{</span>
  <span class="o">{</span><span class="nc">Double</span><span class="o">.</span><span class="na">NEGATIVE_INFINITY</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">},</span>
  <span class="o">{</span><span class="nc">Double</span><span class="o">.</span><span class="na">NEGATIVE_INFINITY</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.3</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">}</span>
<span class="o">};</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data2</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">999.9</span><span class="o">,</span> <span class="o">-</span><span class="mf">999.9</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">0.5</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(-</span><span class="mf">0.3</span><span class="o">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">0.2</span><span class="o">,</span> <span class="mf">0.4</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">999.9</span><span class="o">,</span> <span class="mf">999.9</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features1"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features2"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data2</span><span class="o">,</span> <span class="n">schema2</span><span class="o">);</span>

<span class="nc">Bucketizer</span> <span class="n">bucketizer2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Bucketizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"features1"</span><span class="o">,</span> <span class="s">"features2"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"bucketedFeatures1"</span><span class="o">,</span> <span class="s">"bucketedFeatures2"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setSplitsArray</span><span class="o">(</span><span class="n">splitsArray</span><span class="o">);</span>
<span class="c1">// Transform original data into its bucket index.</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">bucketedData2</span> <span class="o">=</span> <span class="n">bucketizer2</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame2</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Bucketizer output with ["</span> <span class="o">+</span>
  <span class="o">(</span><span class="n">bucketizer2</span><span class="o">.</span><span class="na">getSplitsArray</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span>
  <span class="o">(</span><span class="n">bucketizer2</span><span class="o">.</span><span class="na">getSplitsArray</span><span class="o">()[</span><span class="mi">1</span><span class="o">].</span><span class="na">length</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">"] buckets for each input column"</span><span class="o">);</span>
<span class="n">bucketedData2</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaBucketizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Bucketizer.html">Bucketizer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Bucketizer</span>

<span class="n">splits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">),</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">"inf"</span><span class="p">)]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">999.9</span><span class="p">,),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,),</span> <span class="p">(</span><span class="mf">999.9</span><span class="p">,)]</span>
<span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">"features"</span><span class="p">])</span>

<span class="n">bucketizer</span> <span class="o">=</span> <span class="n">Bucketizer</span><span class="p">(</span><span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"bucketedFeatures"</span><span class="p">)</span>

<span class="c1"># Transform original data into its bucket index.
</span><span class="n">bucketedData</span> <span class="o">=</span> <span class="n">bucketizer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Bucketizer output with %d buckets"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bucketizer</span><span class="p">.</span><span class="n">getSplits</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">bucketedData</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/bucketizer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="elementwiseproduct">ElementwiseProduct</h2>

<p>ElementwiseProduct multiplies each input vector by a provided &#8220;weight&#8221; vector, using element-wise multiplication. In other words, it scales each column of the dataset by a scalar multiplier.  This represents the <a href="https://en.wikipedia.org/wiki/Hadamard_product_%28matrices%29">Hadamard product</a> between the input vector, <code class="language-plaintext highlighter-rouge">v</code> and transforming vector, <code class="language-plaintext highlighter-rouge">w</code>, to yield a result vector.</p>

<p><code class="language-plaintext highlighter-rouge">\[ \begin{pmatrix}
v_1 \\
\vdots \\
v_N
\end{pmatrix} \circ \begin{pmatrix}
                    w_1 \\
                    \vdots \\
                    w_N
                    \end{pmatrix}
= \begin{pmatrix}
  v_1 w_1 \\
  \vdots \\
  v_N w_N
  \end{pmatrix}
\]</code></p>

<p><strong>Examples</strong></p>

<p>This example below demonstrates how to transform vectors using a transforming vector value.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/ElementwiseProduct.html">ElementwiseProduct Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.ElementwiseProduct</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="c1">// Create some vector data; also works for sparse vectors</span>
<span class="k">val</span> <span class="nv">dataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">)))).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"vector"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">transformingVector</span> <span class="k">=</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">transformer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ElementwiseProduct</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setScalingVec</span><span class="o">(</span><span class="n">transformingVector</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"vector"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"transformedVector"</span><span class="o">)</span>

<span class="c1">// Batch transform the vectors to create new column:</span>
<span class="nv">transformer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/ElementwiseProductExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/ElementwiseProduct.html">ElementwiseProduct Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.ElementwiseProduct</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="c1">// Create some vector data; also works for sparse vectors</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">StructField</span><span class="o">&gt;</span> <span class="n">fields</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;(</span><span class="mi">2</span><span class="o">);</span>
<span class="n">fields</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">createStructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">));</span>
<span class="n">fields</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">DataTypes</span><span class="o">.</span><span class="na">createStructField</span><span class="o">(</span><span class="s">"vector"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">));</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">createStructType</span><span class="o">(</span><span class="n">fields</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Vector</span> <span class="n">transformingVector</span> <span class="o">=</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">);</span>

<span class="nc">ElementwiseProduct</span> <span class="n">transformer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ElementwiseProduct</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setScalingVec</span><span class="o">(</span><span class="n">transformingVector</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"vector"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"transformedVector"</span><span class="o">);</span>

<span class="c1">// Batch transform the vectors to create new column:</span>
<span class="n">transformer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaElementwiseProductExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.ElementwiseProduct.html">ElementwiseProduct Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">ElementwiseProduct</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="c1"># Create some vector data; also works for sparse vectors
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),),</span> <span class="p">(</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]),)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">"vector"</span><span class="p">])</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">ElementwiseProduct</span><span class="p">(</span><span class="n">scalingVec</span><span class="o">=</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),</span>
                                 <span class="n">inputCol</span><span class="o">=</span><span class="s">"vector"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"transformedVector"</span><span class="p">)</span>
<span class="c1"># Batch transform the vectors to create new column:
</span><span class="n">transformer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/elementwise_product_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="sqltransformer">SQLTransformer</h2>

<p><code class="language-plaintext highlighter-rouge">SQLTransformer</code> implements the transformations which are defined by SQL statement.
Currently, we only support SQL syntax like <code class="language-plaintext highlighter-rouge">"SELECT ... FROM __THIS__ ..."</code>
where <code class="language-plaintext highlighter-rouge">"__THIS__"</code> represents the underlying table of the input dataset.
The select clause specifies the fields, constants, and expressions to display in
the output, and can be any select clause that Spark SQL supports. Users can also
use Spark SQL built-in function and UDFs to operate on these selected columns.
For example, <code class="language-plaintext highlighter-rouge">SQLTransformer</code> supports statements like:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">SELECT a, a + b AS a_b FROM __THIS__</code></li>
  <li><code class="language-plaintext highlighter-rouge">SELECT a, SQRT(b) AS b_sqrt FROM __THIS__ where a &gt; 5</code></li>
  <li><code class="language-plaintext highlighter-rouge">SELECT a, b, SUM(c) AS c_sum FROM __THIS__ GROUP BY a, b</code></li>
</ul>

<p><strong>Examples</strong></p>

<p>Assume that we have the following DataFrame with columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">v1</code> and <code class="language-plaintext highlighter-rouge">v2</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id |  v1 |  v2
----|-----|-----
 0  | 1.0 | 3.0  
 2  | 2.0 | 5.0
</code></pre></div></div>

<p>This is the output of the <code class="language-plaintext highlighter-rouge">SQLTransformer</code> with statement <code class="language-plaintext highlighter-rouge">"SELECT *, (v1 + v2) AS v3, (v1 * v2) AS v4 FROM __THIS__"</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id |  v1 |  v2 |  v3 |  v4
----|-----|-----|-----|-----
 0  | 1.0 | 3.0 | 4.0 | 3.0
 2  | 2.0 | 5.0 | 7.0 |10.0
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/SQLTransformer.html">SQLTransformer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.SQLTransformer</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">))).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"v1"</span><span class="o">,</span> <span class="s">"v2"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">sqlTrans</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SQLTransformer</span><span class="o">().</span><span class="py">setStatement</span><span class="o">(</span>
  <span class="s">"SELECT *, (v1 + v2) AS v3, (v1 * v2) AS v4 FROM __THIS__"</span><span class="o">)</span>

<span class="nv">sqlTrans</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/SQLTransformerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/SQLTransformer.html">SQLTransformer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.SQLTransformer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span> <span class="o">[]</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"v1"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"v2"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">SQLTransformer</span> <span class="n">sqlTrans</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SQLTransformer</span><span class="o">().</span><span class="na">setStatement</span><span class="o">(</span>
  <span class="s">"SELECT *, (v1 + v2) AS v3, (v1 * v2) AS v4 FROM __THIS__"</span><span class="o">);</span>

<span class="n">sqlTrans</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaSQLTransformerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.SQLTransformer.html">SQLTransformer Python docs</a> for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">SQLTransformer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"v1"</span><span class="p">,</span> <span class="s">"v2"</span><span class="p">])</span>
<span class="n">sqlTrans</span> <span class="o">=</span> <span class="n">SQLTransformer</span><span class="p">(</span>
    <span class="n">statement</span><span class="o">=</span><span class="s">"SELECT *, (v1 + v2) AS v3, (v1 * v2) AS v4 FROM __THIS__"</span><span class="p">)</span>
<span class="n">sqlTrans</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/sql_transformer.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="vectorassembler">VectorAssembler</h2>

<p><code class="language-plaintext highlighter-rouge">VectorAssembler</code> is a transformer that combines a given list of columns into a single vector
column.
It is useful for combining raw features and features generated by different feature transformers
into a single feature vector, in order to train ML models like logistic regression and decision
trees.
<code class="language-plaintext highlighter-rouge">VectorAssembler</code> accepts the following input column types: all numeric types, boolean type,
and vector type.
In each row, the values of the input columns will be concatenated into a vector in the specified
order.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">hour</code>, <code class="language-plaintext highlighter-rouge">mobile</code>, <code class="language-plaintext highlighter-rouge">userFeatures</code>,
and <code class="language-plaintext highlighter-rouge">clicked</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | hour | mobile | userFeatures     | clicked
----|------|--------|------------------|---------
 0  | 18   | 1.0    | [0.0, 10.0, 0.5] | 1.0
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">userFeatures</code> is a vector column that contains three user features.
We want to combine <code class="language-plaintext highlighter-rouge">hour</code>, <code class="language-plaintext highlighter-rouge">mobile</code>, and <code class="language-plaintext highlighter-rouge">userFeatures</code> into a single feature vector
called <code class="language-plaintext highlighter-rouge">features</code> and use it to predict <code class="language-plaintext highlighter-rouge">clicked</code> or not.
If we set <code class="language-plaintext highlighter-rouge">VectorAssembler</code>&#8217;s input columns to <code class="language-plaintext highlighter-rouge">hour</code>, <code class="language-plaintext highlighter-rouge">mobile</code>, and <code class="language-plaintext highlighter-rouge">userFeatures</code> and
output column to <code class="language-plaintext highlighter-rouge">features</code>, after transformation we should get the following DataFrame:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | hour | mobile | userFeatures     | clicked | features
----|------|--------|------------------|---------|-----------------------------
 0  | 18   | 1.0    | [0.0, 10.0, 0.5] | 1.0     | [18.0, 1.0, 0.0, 10.0, 0.5]
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/VectorAssembler.html">VectorAssembler Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorAssembler</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">))</span>
<span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">output</span> <span class="k">=</span> <span class="nv">assembler</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column 'features'"</span><span class="o">)</span>
<span class="nv">output</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/VectorAssemblerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/VectorAssembler.html">VectorAssembler Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorAssembler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">types</span><span class="o">.</span><span class="na">DataTypes</span><span class="o">.*;</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">createStructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"mobile"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">});</span>
<span class="nc">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">row</span><span class="o">),</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">VectorAssembler</span> <span class="n">assembler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column "</span> <span class="o">+</span>
    <span class="s">"'features'"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaVectorAssemblerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.VectorAssembler.html">VectorAssembler Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorAssembler</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"hour"</span><span class="p">,</span> <span class="s">"mobile"</span><span class="p">,</span> <span class="s">"userFeatures"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">])</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"hour"</span><span class="p">,</span> <span class="s">"mobile"</span><span class="p">,</span> <span class="s">"userFeatures"</span><span class="p">],</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">assembler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column 'features'"</span><span class="p">)</span>
<span class="n">output</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"features"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/vector_assembler_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="vectorsizehint">VectorSizeHint</h2>

<p>It can sometimes be useful to explicitly specify the size of the vectors for a column of
<code class="language-plaintext highlighter-rouge">VectorType</code>. For example, <code class="language-plaintext highlighter-rouge">VectorAssembler</code> uses size information from its input columns to
produce size information and metadata for its output column. While in some cases this information
can be obtained by inspecting the contents of the column, in a streaming dataframe the contents are
not available until the stream is started. <code class="language-plaintext highlighter-rouge">VectorSizeHint</code> allows a user to explicitly specify the
vector size for a column so that <code class="language-plaintext highlighter-rouge">VectorAssembler</code>, or other transformers that might
need to know vector size, can use that column as an input.</p>

<p>To use <code class="language-plaintext highlighter-rouge">VectorSizeHint</code> a user must set the <code class="language-plaintext highlighter-rouge">inputCol</code> and <code class="language-plaintext highlighter-rouge">size</code> parameters. Applying this
transformer to a dataframe produces a new dataframe with updated metadata for <code class="language-plaintext highlighter-rouge">inputCol</code> specifying
the vector size. Downstream operations on the resulting dataframe can get this size using the
metadata.</p>

<p><code class="language-plaintext highlighter-rouge">VectorSizeHint</code> can also take an optional <code class="language-plaintext highlighter-rouge">handleInvalid</code> parameter which controls its
behaviour when the vector column contains nulls or vectors of the wrong size. By default
<code class="language-plaintext highlighter-rouge">handleInvalid</code> is set to &#8220;error&#8221;, indicating an exception should be thrown. This parameter can
also be set to &#8220;skip&#8221;, indicating that rows containing invalid values should be filtered out from
the resulting dataframe, or &#8220;optimistic&#8221;, indicating that the column should not be checked for
invalid values and all rows should be kept. Note that the use of &#8220;optimistic&#8221; can cause the
resulting dataframe to be in an inconsistent state, meaning the metadata for the column
<code class="language-plaintext highlighter-rouge">VectorSizeHint</code> was applied to does not match the contents of that column. Users should take care
to avoid this kind of inconsistent state.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/VectorSizeHint.html">VectorSizeHint Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="o">{</span><span class="nc">VectorAssembler</span><span class="o">,</span> <span class="nc">VectorSizeHint</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">(</span>
    <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">),</span>
    <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">))</span>
<span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">sizeHint</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorSizeHint</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setHandleInvalid</span><span class="o">(</span><span class="s">"skip"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSize</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">datasetWithSize</span> <span class="k">=</span> <span class="nv">sizeHint</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Rows where 'userFeatures' is not the right size are filtered out"</span><span class="o">)</span>
<span class="nv">datasetWithSize</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">assembler</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="c1">// This dataframe can be used by downstream transformers as before</span>
<span class="k">val</span> <span class="nv">output</span> <span class="k">=</span> <span class="nv">assembler</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">datasetWithSize</span><span class="o">)</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column 'features'"</span><span class="o">)</span>
<span class="nv">output</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">).</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/VectorSizeHintExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/VectorSizeHint.html">VectorSizeHint Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorAssembler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorSizeHint</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">types</span><span class="o">.</span><span class="na">DataTypes</span><span class="o">.*;</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">createStructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"mobile"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">});</span>
<span class="nc">Row</span> <span class="n">row0</span> <span class="o">=</span> <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span> <span class="mf">0.5</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">);</span>
<span class="nc">Row</span> <span class="n">row1</span> <span class="o">=</span> <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">row0</span><span class="o">,</span> <span class="n">row1</span><span class="o">),</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">VectorSizeHint</span> <span class="n">sizeHint</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorSizeHint</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setHandleInvalid</span><span class="o">(</span><span class="s">"skip"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setSize</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">datasetWithSize</span> <span class="o">=</span> <span class="n">sizeHint</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Rows where 'userFeatures' is not the right size are filtered out"</span><span class="o">);</span>
<span class="n">datasetWithSize</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

<span class="nc">VectorAssembler</span> <span class="n">assembler</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorAssembler</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"hour"</span><span class="o">,</span> <span class="s">"mobile"</span><span class="o">,</span> <span class="s">"userFeatures"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">);</span>

<span class="c1">// This dataframe can be used by downstream transformers as before</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">datasetWithSize</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column "</span> <span class="o">+</span>
    <span class="s">"'features'"</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">).</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaVectorSizeHintExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.VectorSizeHint.html">VectorSizeHint Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="p">(</span><span class="n">VectorSizeHint</span><span class="p">,</span> <span class="n">VectorAssembler</span><span class="p">)</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"hour"</span><span class="p">,</span> <span class="s">"mobile"</span><span class="p">,</span> <span class="s">"userFeatures"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">])</span>

<span class="n">sizeHint</span> <span class="o">=</span> <span class="n">VectorSizeHint</span><span class="p">(</span>
    <span class="n">inputCol</span><span class="o">=</span><span class="s">"userFeatures"</span><span class="p">,</span>
    <span class="n">handleInvalid</span><span class="o">=</span><span class="s">"skip"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">datasetWithSize</span> <span class="o">=</span> <span class="n">sizeHint</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Rows where 'userFeatures' is not the right size are filtered out"</span><span class="p">)</span>
<span class="n">datasetWithSize</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">assembler</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span>
    <span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"hour"</span><span class="p">,</span> <span class="s">"mobile"</span><span class="p">,</span> <span class="s">"userFeatures"</span><span class="p">],</span>
    <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">)</span>

<span class="c1"># This dataframe can be used by downstream transformers as before
</span><span class="n">output</span> <span class="o">=</span> <span class="n">assembler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">datasetWithSize</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Assembled columns 'hour', 'mobile', 'userFeatures' to vector column 'features'"</span><span class="p">)</span>
<span class="n">output</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"features"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/vector_size_hint_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="quantilediscretizer">QuantileDiscretizer</h2>

<p><code class="language-plaintext highlighter-rouge">QuantileDiscretizer</code> takes a column with continuous features and outputs a column with binned
categorical features. The number of bins is set by the <code class="language-plaintext highlighter-rouge">numBuckets</code> parameter. It is possible
that the number of buckets used will be smaller than this value, for example, if there are too few
distinct values of the input to create enough distinct quantiles.</p>

<p>NaN values:
NaN values will be removed from the column during <code class="language-plaintext highlighter-rouge">QuantileDiscretizer</code> fitting. This will produce
a <code class="language-plaintext highlighter-rouge">Bucketizer</code> model for making predictions. During the transformation, <code class="language-plaintext highlighter-rouge">Bucketizer</code>
will raise an error when it finds NaN values in the dataset, but the user can also choose to either
keep or remove NaN values within the dataset by setting <code class="language-plaintext highlighter-rouge">handleInvalid</code>. If the user chooses to keep
NaN values, they will be handled specially and placed into their own bucket, for example, if 4 buckets
are used, then non-NaN data will be put into buckets[0-3], but NaNs will be counted in a special bucket[4].</p>

<p>Algorithm: The bin ranges are chosen using an approximate algorithm (see the documentation for
<a href="api/scala/org/apache/spark/sql/DataFrameStatFunctions.html">approxQuantile</a> for a
detailed description). The precision of the approximation can be controlled with the
<code class="language-plaintext highlighter-rouge">relativeError</code> parameter. When set to zero, exact quantiles are calculated
(<strong>Note:</strong> Computing exact quantiles is an expensive operation). The lower and upper bin bounds
will be <code class="language-plaintext highlighter-rouge">-Infinity</code> and <code class="language-plaintext highlighter-rouge">+Infinity</code> covering all real values.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">hour</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | hour
----|------
 0  | 18.0
----|------
 1  | 19.0
----|------
 2  | 8.0
----|------
 3  | 5.0
----|------
 4  | 2.2
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">hour</code> is a continuous feature with <code class="language-plaintext highlighter-rouge">Double</code> type. We want to turn the continuous feature into
a categorical one. Given <code class="language-plaintext highlighter-rouge">numBuckets = 3</code>, we should get the following DataFrame:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> id | hour | result
----|------|------
 0  | 18.0 | 2.0
----|------|------
 1  | 19.0 | 2.0
----|------|------
 2  | 8.0  | 1.0
----|------|------
 3  | 5.0  | 1.0
----|------|------
 4  | 2.2  | 0.0
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/QuantileDiscretizer.html">QuantileDiscretizer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.QuantileDiscretizer</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mf">18.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">19.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">2.2</span><span class="o">))</span>
<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"hour"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">discretizer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">QuantileDiscretizer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"hour"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"result"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setNumBuckets</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">discretizer</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/QuantileDiscretizerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/QuantileDiscretizer.html">QuantileDiscretizer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.QuantileDiscretizer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mf">18.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">19.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">2.2</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">QuantileDiscretizer</span> <span class="n">discretizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">QuantileDiscretizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"hour"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"result"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setNumBuckets</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">discretizer</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="n">result</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaQuantileDiscretizerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.QuantileDiscretizer.html">QuantileDiscretizer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">QuantileDiscretizer</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"hour"</span><span class="p">])</span>

<span class="n">discretizer</span> <span class="o">=</span> <span class="n">QuantileDiscretizer</span><span class="p">(</span><span class="n">numBuckets</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s">"hour"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"result"</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">discretizer</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/quantile_discretizer_example.py" in the Spark repo.</small></div>
  </div>

</div>

<h2 id="imputer">Imputer</h2>

<p>The <code class="language-plaintext highlighter-rouge">Imputer</code> estimator completes missing values in a dataset, using the mean, median or mode
of the columns in which the missing values are located. The input columns should be of
numeric type. Currently <code class="language-plaintext highlighter-rouge">Imputer</code> does not support categorical features and possibly
creates incorrect values for columns containing categorical features. Imputer can impute custom values 
other than &#8216;NaN&#8217; by <code class="language-plaintext highlighter-rouge">.setMissingValue(custom_value)</code>. For example, <code class="language-plaintext highlighter-rouge">.setMissingValue(0)</code> will impute 
all occurrences of (0).</p>

<p><strong>Note</strong> all <code class="language-plaintext highlighter-rouge">null</code> values in the input columns are treated as missing, and so are also imputed.</p>

<p><strong>Examples</strong></p>

<p>Suppose that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      a     |      b      
------------|-----------
     1.0    | Double.NaN
     2.0    | Double.NaN
 Double.NaN |     3.0   
     4.0    |     4.0   
     5.0    |     5.0   
</code></pre></div></div>

<p>In this example, Imputer will replace all occurrences of <code class="language-plaintext highlighter-rouge">Double.NaN</code> (the default for the missing value)
with the mean (the default imputation strategy) computed from the other values in the corresponding columns.
In this example, the surrogate values for columns <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are 3.0 and 4.0 respectively. After
transformation, the missing values in the output columns will be replaced by the surrogate value for
the relevant column.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      a     |      b     | out_a | out_b   
------------|------------|-------|-------
     1.0    | Double.NaN |  1.0  |  4.0 
     2.0    | Double.NaN |  2.0  |  4.0 
 Double.NaN |     3.0    |  3.0  |  3.0 
     4.0    |     4.0    |  4.0  |  4.0
     5.0    |     5.0    |  5.0  |  5.0 
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/Imputer.html">Imputer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.Imputer</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="nv">Double</span><span class="o">.</span><span class="py">NaN</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="nv">Double</span><span class="o">.</span><span class="py">NaN</span><span class="o">),</span>
  <span class="o">(</span><span class="nv">Double</span><span class="o">.</span><span class="py">NaN</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mf">5.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">imputer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Imputer</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setInputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">setOutputCols</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"out_a"</span><span class="o">,</span> <span class="s">"out_b"</span><span class="o">))</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">imputer</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/ImputerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/Imputer.html">Imputer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.Imputer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.ImputerModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">NaN</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="nc">Double</span><span class="o">.</span><span class="na">NaN</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Double</span><span class="o">.</span><span class="na">NaN</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mf">5.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"a"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"b"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Imputer</span> <span class="n">imputer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Imputer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">})</span>
  <span class="o">.</span><span class="na">setOutputCols</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"out_a"</span><span class="o">,</span> <span class="s">"out_b"</span><span class="o">});</span>

<span class="nc">ImputerModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaImputerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.Imputer.html">Imputer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">Imputer</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">"nan"</span><span class="p">)),</span>
    <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">"nan"</span><span class="p">)),</span>
    <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s">"nan"</span><span class="p">),</span> <span class="mf">3.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">])</span>

<span class="n">imputer</span> <span class="o">=</span> <span class="n">Imputer</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">],</span> <span class="n">outputCols</span><span class="o">=</span><span class="p">[</span><span class="s">"out_a"</span><span class="p">,</span> <span class="s">"out_b"</span><span class="p">])</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">imputer</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/imputer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h1 id="feature-selectors">Feature Selectors</h1>

<h2 id="vectorslicer">VectorSlicer</h2>

<p><code class="language-plaintext highlighter-rouge">VectorSlicer</code> is a transformer that takes a feature vector and outputs a new feature vector with a
sub-array of the original features. It is useful for extracting features from a vector column.</p>

<p><code class="language-plaintext highlighter-rouge">VectorSlicer</code> accepts a vector column with specified indices, then outputs a new vector column
whose values are selected via those indices. There are two types of indices,</p>

<ol>
  <li>
    <p>Integer indices that represent the indices into the vector, <code class="language-plaintext highlighter-rouge">setIndices()</code>.</p>
  </li>
  <li>
    <p>String indices that represent the names of features into the vector, <code class="language-plaintext highlighter-rouge">setNames()</code>.
 <em>This requires the vector column to have an <code class="language-plaintext highlighter-rouge">AttributeGroup</code> since the implementation matches on
 the name field of an <code class="language-plaintext highlighter-rouge">Attribute</code>.</em></p>
  </li>
</ol>

<p>Specification by integer and string are both acceptable. Moreover, you can use integer index and
string name simultaneously. At least one feature must be selected. Duplicate features are not
allowed, so there can be no overlap between selected indices and names. Note that if names of
features are selected, an exception will be thrown if empty input attributes are encountered.</p>

<p>The output vector will order features with the selected indices first (in the order given),
followed by the selected names (in the order given).</p>

<p><strong>Examples</strong></p>

<p>Suppose that we have a DataFrame with the column <code class="language-plaintext highlighter-rouge">userFeatures</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> userFeatures
------------------
 [0.0, 10.0, 0.5]
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">userFeatures</code> is a vector column that contains three user features. Assume that the first column
of <code class="language-plaintext highlighter-rouge">userFeatures</code> are all zeros, so we want to remove it and select only the last two columns.
The <code class="language-plaintext highlighter-rouge">VectorSlicer</code> selects the last two elements with <code class="language-plaintext highlighter-rouge">setIndices(1, 2)</code> then produces a new vector
column named <code class="language-plaintext highlighter-rouge">features</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> userFeatures     | features
------------------|-----------------------------
 [0.0, 10.0, 0.5] | [10.0, 0.5]
</code></pre></div></div>

<p>Suppose also that we have potential input attributes for the <code class="language-plaintext highlighter-rouge">userFeatures</code>, i.e.
<code class="language-plaintext highlighter-rouge">["f1", "f2", "f3"]</code>, then we can use <code class="language-plaintext highlighter-rouge">setNames("f2", "f3")</code> to select them.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> userFeatures     | features
------------------|-----------------------------
 [0.0, 10.0, 0.5] | [10.0, 0.5]
 ["f1", "f2", "f3"] | ["f2", "f3"]
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/VectorSlicer.html">VectorSlicer Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">java.util.Arrays</span>

<span class="k">import</span> <span class="nn">org.apache.spark.ml.attribute.</span><span class="o">{</span><span class="nc">Attribute</span><span class="o">,</span> <span class="nc">AttributeGroup</span><span class="o">,</span> <span class="nc">NumericAttribute</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VectorSlicer</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.</span><span class="o">{</span><span class="nc">Row</span><span class="o">,</span> <span class="nc">SparkSession</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">Arrays</span><span class="o">.</span><span class="py">asList</span><span class="o">(</span>
  <span class="nc">Row</span><span class="o">(</span><span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">)))),</span>
  <span class="nc">Row</span><span class="o">(</span><span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(-</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">))</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">defaultAttr</span> <span class="k">=</span> <span class="nv">NumericAttribute</span><span class="o">.</span><span class="py">defaultAttr</span>
<span class="k">val</span> <span class="nv">attrs</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">"f1"</span><span class="o">,</span> <span class="s">"f2"</span><span class="o">,</span> <span class="s">"f3"</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="nv">defaultAttr</span><span class="o">.</span><span class="py">withName</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">attrGroup</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">AttributeGroup</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">,</span> <span class="nv">attrs</span><span class="o">.</span><span class="py">asInstanceOf</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Attribute</span><span class="o">]])</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="nc">StructType</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="nv">attrGroup</span><span class="o">.</span><span class="py">toStructField</span><span class="o">())))</span>

<span class="k">val</span> <span class="nv">slicer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VectorSlicer</span><span class="o">().</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">).</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>

<span class="nv">slicer</span><span class="o">.</span><span class="py">setIndices</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="py">setNames</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"f3"</span><span class="o">))</span>
<span class="c1">// or slicer.setIndices(Array(1, 2)), or slicer.setNames(Array("f2", "f3"))</span>

<span class="k">val</span> <span class="nv">output</span> <span class="k">=</span> <span class="nv">slicer</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
<span class="nv">output</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/VectorSlicerExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/VectorSlicer.html">VectorSlicer Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.attribute.Attribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.attribute.AttributeGroup</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.attribute.NumericAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VectorSlicer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">Attribute</span><span class="o">[]</span> <span class="n">attrs</span> <span class="o">=</span> <span class="o">{</span>
  <span class="nc">NumericAttribute</span><span class="o">.</span><span class="na">defaultAttr</span><span class="o">().</span><span class="na">withName</span><span class="o">(</span><span class="s">"f1"</span><span class="o">),</span>
  <span class="nc">NumericAttribute</span><span class="o">.</span><span class="na">defaultAttr</span><span class="o">().</span><span class="na">withName</span><span class="o">(</span><span class="s">"f2"</span><span class="o">),</span>
  <span class="nc">NumericAttribute</span><span class="o">.</span><span class="na">defaultAttr</span><span class="o">().</span><span class="na">withName</span><span class="o">(</span><span class="s">"f3"</span><span class="o">)</span>
<span class="o">};</span>
<span class="nc">AttributeGroup</span> <span class="n">group</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AttributeGroup</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{-</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(-</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span>
  <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="o">(</span><span class="k">new</span> <span class="nc">StructType</span><span class="o">()).</span><span class="na">add</span><span class="o">(</span><span class="n">group</span><span class="o">.</span><span class="na">toStructField</span><span class="o">()));</span>

<span class="nc">VectorSlicer</span> <span class="n">vectorSlicer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VectorSlicer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"userFeatures"</span><span class="o">).</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">);</span>

<span class="n">vectorSlicer</span><span class="o">.</span><span class="na">setIndices</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">}).</span><span class="na">setNames</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"f3"</span><span class="o">});</span>
<span class="c1">// or slicer.setIndices(new int[]{1, 2}), or slicer.setNames(new String[]{"f2", "f3"})</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">vectorSlicer</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaVectorSlicerExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.VectorSlicer.html">VectorSlicer Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VectorSlicer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">Row</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="n">Row</span><span class="p">(</span><span class="n">userFeatures</span><span class="o">=</span><span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">2.3</span><span class="p">})),</span>
    <span class="n">Row</span><span class="p">(</span><span class="n">userFeatures</span><span class="o">=</span><span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))])</span>

<span class="n">slicer</span> <span class="o">=</span> <span class="n">VectorSlicer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"userFeatures"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">slicer</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">output</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"userFeatures"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/vector_slicer_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="rformula">RFormula</h2>

<p><code class="language-plaintext highlighter-rouge">RFormula</code> selects columns specified by an <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/formula.html">R model formula</a>. 
Currently we support a limited subset of the R operators, including &#8216;~&#8217;, &#8216;.&#8217;, &#8216;:&#8217;, &#8216;+&#8217;, and &#8216;-&#8216;.
The basic operators are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">~</code> separate target and terms</li>
  <li><code class="language-plaintext highlighter-rouge">+</code> concat terms, &#8220;+ 0&#8221; means removing intercept</li>
  <li><code class="language-plaintext highlighter-rouge">-</code> remove a term, &#8220;- 1&#8221; means removing intercept</li>
  <li><code class="language-plaintext highlighter-rouge">:</code> interaction (multiplication for numeric values, or binarized categorical values)</li>
  <li><code class="language-plaintext highlighter-rouge">.</code> all columns except target</li>
</ul>

<p>Suppose <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> are double columns, we use the following simple examples to illustrate the effect of <code class="language-plaintext highlighter-rouge">RFormula</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">y ~ a + b</code> means model <code class="language-plaintext highlighter-rouge">y ~ w0 + w1 * a + w2 * b</code> where <code class="language-plaintext highlighter-rouge">w0</code> is the intercept and <code class="language-plaintext highlighter-rouge">w1, w2</code> are coefficients.</li>
  <li><code class="language-plaintext highlighter-rouge">y ~ a + b + a:b - 1</code> means model <code class="language-plaintext highlighter-rouge">y ~ w1 * a + w2 * b + w3 * a * b</code> where <code class="language-plaintext highlighter-rouge">w1, w2, w3</code> are coefficients.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">RFormula</code> produces a vector column of features and a double or string column of label. 
Like when formulas are used in R for linear regression, numeric columns will be cast to doubles.
As to string input columns, they will first be transformed with <a href="ml-features.html#stringindexer">StringIndexer</a> using ordering determined by <code class="language-plaintext highlighter-rouge">stringOrderType</code>,
and the last category after ordering is dropped, then the doubles will be one-hot encoded.</p>

<p>Suppose a string feature column containing values <code class="language-plaintext highlighter-rouge">{'b', 'a', 'b', 'a', 'c', 'b'}</code>, we set <code class="language-plaintext highlighter-rouge">stringOrderType</code> to control the encoding:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>stringOrderType | Category mapped to 0 by StringIndexer |  Category dropped by RFormula
----------------|---------------------------------------|---------------------------------
'frequencyDesc' | most frequent category ('b')          | least frequent category ('c')
'frequencyAsc'  | least frequent category ('c')         | most frequent category ('b')
'alphabetDesc'  | last alphabetical category ('c')      | first alphabetical category ('a')
'alphabetAsc'   | first alphabetical category ('a')     | last alphabetical category ('c')
</code></pre></div></div>

<p>If the label column is of type string, it will be first transformed to double with <a href="ml-features.html#stringindexer">StringIndexer</a> using <code class="language-plaintext highlighter-rouge">frequencyDesc</code> ordering.
If the label column does not exist in the DataFrame, the output label column will be created from the specified response variable in the formula.</p>

<p><strong>Note:</strong> The ordering option <code class="language-plaintext highlighter-rouge">stringOrderType</code> is NOT used for the label column. When the label column is indexed, it uses the default descending frequency ordering in <code class="language-plaintext highlighter-rouge">StringIndexer</code>.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">country</code>, <code class="language-plaintext highlighter-rouge">hour</code>, and <code class="language-plaintext highlighter-rouge">clicked</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | country | hour | clicked
---|---------|------|---------
 7 | "US"    | 18   | 1.0
 8 | "CA"    | 12   | 0.0
 9 | "NZ"    | 15   | 0.0
</code></pre></div></div>

<p>If we use <code class="language-plaintext highlighter-rouge">RFormula</code> with a formula string of <code class="language-plaintext highlighter-rouge">clicked ~ country + hour</code>, which indicates that we want to
predict <code class="language-plaintext highlighter-rouge">clicked</code> based on <code class="language-plaintext highlighter-rouge">country</code> and <code class="language-plaintext highlighter-rouge">hour</code>, after transformation we should get the following DataFrame:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | country | hour | clicked | features         | label
---|---------|------|---------|------------------|-------
 7 | "US"    | 18   | 1.0     | [0.0, 0.0, 18.0] | 1.0
 8 | "CA"    | 12   | 0.0     | [0.0, 1.0, 12.0] | 0.0
 9 | "NZ"    | 15   | 0.0     | [1.0, 0.0, 15.0] | 0.0
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/RFormula.html">RFormula Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.RFormula</span>

<span class="k">val</span> <span class="nv">dataset</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s">"US"</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="s">"CA"</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="s">"NZ"</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"country"</span><span class="o">,</span> <span class="s">"hour"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">formula</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RFormula</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setFormula</span><span class="o">(</span><span class="s">"clicked ~ country + hour"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"label"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">output</span> <span class="k">=</span> <span class="nv">formula</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">)</span>
<span class="nv">output</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"label"</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/RFormulaExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/RFormula.html">RFormula Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.RFormula</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">types</span><span class="o">.</span><span class="na">DataTypes</span><span class="o">.*;</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">createStructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"country"</span><span class="o">,</span> <span class="nc">StringType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"hour"</span><span class="o">,</span> <span class="nc">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="n">createStructField</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">});</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="s">"US"</span><span class="o">,</span> <span class="mi">18</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="s">"CA"</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="s">"NZ"</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>
<span class="nc">RFormula</span> <span class="n">formula</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RFormula</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setFormula</span><span class="o">(</span><span class="s">"clicked ~ country + hour"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">"label"</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">formula</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataset</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">dataset</span><span class="o">);</span>
<span class="n">output</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="s">"label"</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaRFormulaExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.RFormula.html">RFormula Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">RFormula</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[(</span><span class="mi">7</span><span class="p">,</span> <span class="s">"US"</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">"CA"</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
     <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s">"NZ"</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)],</span>
    <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"country"</span><span class="p">,</span> <span class="s">"hour"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">])</span>

<span class="n">formula</span> <span class="o">=</span> <span class="n">RFormula</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="s">"clicked ~ country + hour"</span><span class="p">,</span>
    <span class="n">featuresCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span>
    <span class="n">labelCol</span><span class="o">=</span><span class="s">"label"</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">formula</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">output</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"features"</span><span class="p">,</span> <span class="s">"label"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/rformula_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="chisqselector">ChiSqSelector</h2>

<p><code class="language-plaintext highlighter-rouge">ChiSqSelector</code> stands for Chi-Squared feature selection. It operates on labeled data with
categorical features. ChiSqSelector uses the
<a href="https://en.wikipedia.org/wiki/Chi-squared_test">Chi-Squared test of independence</a> to decide which
features to choose. It supports five selection methods: <code class="language-plaintext highlighter-rouge">numTopFeatures</code>, <code class="language-plaintext highlighter-rouge">percentile</code>, <code class="language-plaintext highlighter-rouge">fpr</code>, <code class="language-plaintext highlighter-rouge">fdr</code>, <code class="language-plaintext highlighter-rouge">fwe</code>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">numTopFeatures</code> chooses a fixed number of top features according to a chi-squared test. This is akin to yielding the features with the most predictive power.</li>
  <li><code class="language-plaintext highlighter-rouge">percentile</code> is similar to <code class="language-plaintext highlighter-rouge">numTopFeatures</code> but chooses a fraction of all features instead of a fixed number.</li>
  <li><code class="language-plaintext highlighter-rouge">fpr</code> chooses all features whose p-values are below a threshold, thus controlling the false positive rate of selection.</li>
  <li><code class="language-plaintext highlighter-rouge">fdr</code> uses the <a href="https://en.wikipedia.org/wiki/False_discovery_rate#Benjamini.E2.80.93Hochberg_procedure">Benjamini-Hochberg procedure</a> to choose all features whose false discovery rate is below a threshold.</li>
  <li><code class="language-plaintext highlighter-rouge">fwe</code> chooses all features whose p-values are below a threshold. The threshold is scaled by 1/numFeatures, thus controlling the family-wise error rate of selection.
By default, the selection method is <code class="language-plaintext highlighter-rouge">numTopFeatures</code>, with the default number of top features set to 50.
The user can choose a selection method using <code class="language-plaintext highlighter-rouge">setSelectorType</code>.</li>
</ul>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">features</code>, and <code class="language-plaintext highlighter-rouge">clicked</code>, which is used as
our target to be predicted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features              | clicked
---|-----------------------|---------
 7 | [0.0, 0.0, 18.0, 1.0] | 1.0
 8 | [0.0, 1.0, 12.0, 0.0] | 0.0
 9 | [1.0, 0.0, 15.0, 0.1] | 0.0
</code></pre></div></div>

<p>If we use <code class="language-plaintext highlighter-rouge">ChiSqSelector</code> with <code class="language-plaintext highlighter-rouge">numTopFeatures = 1</code>, then according to our label <code class="language-plaintext highlighter-rouge">clicked</code> the
last column in our <code class="language-plaintext highlighter-rouge">features</code> is chosen as the most useful feature:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features              | clicked | selectedFeatures
---|-----------------------|---------|------------------
 7 | [0.0, 0.0, 18.0, 1.0] | 1.0     | [1.0]
 8 | [0.0, 1.0, 12.0, 0.0] | 0.0     | [0.0]
 9 | [1.0, 0.0, 15.0, 0.1] | 0.0     | [0.1]
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/ChiSqSelector.html">ChiSqSelector Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.ChiSqSelector</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">18.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">12.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataset</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">,</span> <span class="s">"clicked"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">selector</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ChiSqSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setNumTopFeatures</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">selector</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"ChiSqSelector output with top ${selector.getNumTopFeatures} features selected"</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/ChiSqSelectorExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/ChiSqSelector.html">ChiSqSelector Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.ChiSqSelector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">18.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="mf">1.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">12.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">,</span> <span class="mf">0.1</span><span class="o">),</span> <span class="mf">0.0</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">ChiSqSelector</span> <span class="n">selector</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChiSqSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setNumTopFeatures</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">"clicked"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ChiSqSelector output with top "</span> <span class="o">+</span> <span class="n">selector</span><span class="o">.</span><span class="na">getNumTopFeatures</span><span class="o">()</span>
    <span class="o">+</span> <span class="s">" features selected"</span><span class="o">);</span>
<span class="n">result</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaChiSqSelectorExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.ChiSqSelector.html">ChiSqSelector Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">ChiSqSelector</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">,)],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">,</span> <span class="s">"clicked"</span><span class="p">])</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">ChiSqSelector</span><span class="p">(</span><span class="n">numTopFeatures</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">featuresCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span>
                         <span class="n">outputCol</span><span class="o">=</span><span class="s">"selectedFeatures"</span><span class="p">,</span> <span class="n">labelCol</span><span class="o">=</span><span class="s">"clicked"</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"ChiSqSelector output with top %d features selected"</span> <span class="o">%</span> <span class="n">selector</span><span class="p">.</span><span class="n">getNumTopFeatures</span><span class="p">())</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/chisq_selector_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="univariatefeatureselector">UnivariateFeatureSelector</h2>

<p><code class="language-plaintext highlighter-rouge">UnivariateFeatureSelector</code> operates on categorical/continuous labels with categorical/continuous features. 
User can set <code class="language-plaintext highlighter-rouge">featureType</code> and <code class="language-plaintext highlighter-rouge">labelType</code>, and Spark will pick the score function to use based on the specified 
<code class="language-plaintext highlighter-rouge">featureType</code> and <code class="language-plaintext highlighter-rouge">labelType</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>featureType |  labelType |score function
------------|------------|--------------
categorical |categorical | chi-squared (chi2)
continuous  |categorical | ANOVATest (f_classif)
continuous  |continuous  | F-value (f_regression)
</code></pre></div></div>

<p>It supports five selection modes: <code class="language-plaintext highlighter-rouge">numTopFeatures</code>, <code class="language-plaintext highlighter-rouge">percentile</code>, <code class="language-plaintext highlighter-rouge">fpr</code>, <code class="language-plaintext highlighter-rouge">fdr</code>, <code class="language-plaintext highlighter-rouge">fwe</code>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">numTopFeatures</code> chooses a fixed number of top features.</li>
  <li><code class="language-plaintext highlighter-rouge">percentile</code> is similar to <code class="language-plaintext highlighter-rouge">numTopFeatures</code> but chooses a fraction of all features instead of a fixed number.</li>
  <li><code class="language-plaintext highlighter-rouge">fpr</code> chooses all features whose p-values are below a threshold, thus controlling the false positive rate of selection.</li>
  <li><code class="language-plaintext highlighter-rouge">fdr</code> uses the <a href="https://en.wikipedia.org/wiki/False_discovery_rate#Benjamini.E2.80.93Hochberg_procedure">Benjamini-Hochberg procedure</a> to choose all features whose false discovery rate is below a threshold.</li>
  <li><code class="language-plaintext highlighter-rouge">fwe</code> chooses all features whose p-values are below a threshold. The threshold is scaled by 1/numFeatures, thus controlling the family-wise error rate of selection.</li>
</ul>

<p>By default, the selection mode is <code class="language-plaintext highlighter-rouge">numTopFeatures</code>, with the default selectionThreshold sets to 50.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">features</code>, and <code class="language-plaintext highlighter-rouge">label</code>, which is used as
our target to be predicted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features                       | label
---|--------------------------------|---------
 1 | [1.7, 4.4, 7.6, 5.8, 9.6, 2.3] | 3.0
 2 | [8.8, 7.3, 5.7, 7.3, 2.2, 4.1] | 2.0
 3 | [1.2, 9.5, 2.5, 3.1, 8.7, 2.5] | 3.0
 4 | [3.7, 9.2, 6.1, 4.1, 7.5, 3.8] | 2.0
 5 | [8.9, 5.2, 7.8, 8.3, 5.2, 3.0] | 4.0
 6 | [7.9, 8.5, 9.2, 4.0, 9.4, 2.1] | 4.0
</code></pre></div></div>

<p>If we set <code class="language-plaintext highlighter-rouge">featureType</code> to <code class="language-plaintext highlighter-rouge">continuous</code> and <code class="language-plaintext highlighter-rouge">labelType</code> to <code class="language-plaintext highlighter-rouge">categorical</code> with <code class="language-plaintext highlighter-rouge">numTopFeatures = 1</code>, the
last column in our <code class="language-plaintext highlighter-rouge">features</code> is chosen as the most useful feature:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features                       | label   | selectedFeatures
---|--------------------------------|---------|------------------
 1 | [1.7, 4.4, 7.6, 5.8, 9.6, 2.3] | 3.0     | [2.3]
 2 | [8.8, 7.3, 5.7, 7.3, 2.2, 4.1] | 2.0     | [4.1]
 3 | [1.2, 9.5, 2.5, 3.1, 8.7, 2.5] | 3.0     | [2.5]
 4 | [3.7, 9.2, 6.1, 4.1, 7.5, 3.8] | 2.0     | [3.8]
 5 | [8.9, 5.2, 7.8, 8.3, 5.2, 3.0] | 4.0     | [3.0]
 6 | [7.9, 8.5, 9.2, 4.0, 9.4, 2.1] | 4.0     | [2.1]
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/UnivariateFeatureSelector.html">UnivariateFeatureSelector Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.UnivariateFeatureSelector</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.7</span><span class="o">,</span> <span class="mf">4.4</span><span class="o">,</span> <span class="mf">7.6</span><span class="o">,</span> <span class="mf">5.8</span><span class="o">,</span> <span class="mf">9.6</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">),</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">8.8</span><span class="o">,</span> <span class="mf">7.3</span><span class="o">,</span> <span class="mf">5.7</span><span class="o">,</span> <span class="mf">7.3</span><span class="o">,</span> <span class="mf">2.2</span><span class="o">,</span> <span class="mf">4.1</span><span class="o">),</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.2</span><span class="o">,</span> <span class="mf">9.5</span><span class="o">,</span> <span class="mf">2.5</span><span class="o">,</span> <span class="mf">3.1</span><span class="o">,</span> <span class="mf">8.7</span><span class="o">,</span> <span class="mf">2.5</span><span class="o">),</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">3.7</span><span class="o">,</span> <span class="mf">9.2</span><span class="o">,</span> <span class="mf">6.1</span><span class="o">,</span> <span class="mf">4.1</span><span class="o">,</span> <span class="mf">7.5</span><span class="o">,</span> <span class="mf">3.8</span><span class="o">),</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">8.9</span><span class="o">,</span> <span class="mf">5.2</span><span class="o">,</span> <span class="mf">7.8</span><span class="o">,</span> <span class="mf">8.3</span><span class="o">,</span> <span class="mf">5.2</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span> <span class="mf">4.0</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">7.9</span><span class="o">,</span> <span class="mf">8.5</span><span class="o">,</span> <span class="mf">9.2</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">9.4</span><span class="o">,</span> <span class="mf">2.1</span><span class="o">),</span> <span class="mf">4.0</span><span class="o">)</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataset</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">,</span> <span class="s">"label"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">selector</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">UnivariateFeatureSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setFeatureType</span><span class="o">(</span><span class="s">"continuous"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLabelType</span><span class="o">(</span><span class="s">"categorical"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSelectionMode</span><span class="o">(</span><span class="s">"numTopFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setSelectionThreshold</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setLabelCol</span><span class="o">(</span><span class="s">"label"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">selector</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"UnivariateFeatureSelector output with top ${selector.getSelectionThreshold}"</span> <span class="o">+</span>
  <span class="n">s</span><span class="s">" features selected using f_classif"</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/UnivariateFeatureSelectorExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/UnivariateFeatureSelector.html">UnivariateFeatureSelector Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.UnivariateFeatureSelector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.7</span><span class="o">,</span> <span class="mf">4.4</span><span class="o">,</span> <span class="mf">7.6</span><span class="o">,</span> <span class="mf">5.8</span><span class="o">,</span> <span class="mf">9.6</span><span class="o">,</span> <span class="mf">2.3</span><span class="o">),</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">8.8</span><span class="o">,</span> <span class="mf">7.3</span><span class="o">,</span> <span class="mf">5.7</span><span class="o">,</span> <span class="mf">7.3</span><span class="o">,</span> <span class="mf">2.2</span><span class="o">,</span> <span class="mf">4.1</span><span class="o">),</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.2</span><span class="o">,</span> <span class="mf">9.5</span><span class="o">,</span> <span class="mf">2.5</span><span class="o">,</span> <span class="mf">3.1</span><span class="o">,</span> <span class="mf">8.7</span><span class="o">,</span> <span class="mf">2.5</span><span class="o">),</span> <span class="mf">3.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">3.7</span><span class="o">,</span> <span class="mf">9.2</span><span class="o">,</span> <span class="mf">6.1</span><span class="o">,</span> <span class="mf">4.1</span><span class="o">,</span> <span class="mf">7.5</span><span class="o">,</span> <span class="mf">3.8</span><span class="o">),</span> <span class="mf">2.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">8.9</span><span class="o">,</span> <span class="mf">5.2</span><span class="o">,</span> <span class="mf">7.8</span><span class="o">,</span> <span class="mf">8.3</span><span class="o">,</span> <span class="mf">5.2</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">),</span> <span class="mf">4.0</span><span class="o">),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">7.9</span><span class="o">,</span> <span class="mf">8.5</span><span class="o">,</span> <span class="mf">9.2</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">9.4</span><span class="o">,</span> <span class="mf">2.1</span><span class="o">),</span> <span class="mf">4.0</span><span class="o">)</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"label"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">DoubleType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">UnivariateFeatureSelector</span> <span class="n">selector</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UnivariateFeatureSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setFeatureType</span><span class="o">(</span><span class="s">"continuous"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabelType</span><span class="o">(</span><span class="s">"categorical"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setSelectionMode</span><span class="o">(</span><span class="s">"numTopFeatures"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setSelectionThreshold</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setLabelCol</span><span class="o">(</span><span class="s">"label"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"UnivariateFeatureSelector output with top "</span>
    <span class="o">+</span> <span class="n">selector</span><span class="o">.</span><span class="na">getSelectionThreshold</span><span class="o">()</span> <span class="o">+</span> <span class="s">" features selected using f_classif"</span><span class="o">);</span>
<span class="n">result</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaUnivariateFeatureSelectorExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.UnivariateFeatureSelector.html">UnivariateFeatureSelector Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">UnivariateFeatureSelector</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">,</span> <span class="mf">7.6</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">9.6</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">]),</span> <span class="mf">3.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">8.8</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">]),</span> <span class="mf">2.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]),</span> <span class="mf">3.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">3.7</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">]),</span> <span class="mf">2.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">8.9</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]),</span> <span class="mf">4.0</span><span class="p">,),</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">7.9</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">9.4</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">]),</span> <span class="mf">4.0</span><span class="p">,)],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">,</span> <span class="s">"label"</span><span class="p">])</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">UnivariateFeatureSelector</span><span class="p">(</span><span class="n">featuresCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"selectedFeatures"</span><span class="p">,</span>
                                     <span class="n">labelCol</span><span class="o">=</span><span class="s">"label"</span><span class="p">,</span> <span class="n">selectionMode</span><span class="o">=</span><span class="s">"numTopFeatures"</span><span class="p">)</span>
<span class="n">selector</span><span class="p">.</span><span class="n">setFeatureType</span><span class="p">(</span><span class="s">"continuous"</span><span class="p">).</span><span class="n">setLabelType</span><span class="p">(</span><span class="s">"categorical"</span><span class="p">).</span><span class="n">setSelectionThreshold</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"UnivariateFeatureSelector output with top %d features selected using f_classif"</span>
      <span class="o">%</span> <span class="n">selector</span><span class="p">.</span><span class="n">getSelectionThreshold</span><span class="p">())</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/univariate_feature_selector_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h2 id="variancethresholdselector">VarianceThresholdSelector</h2>

<p><code class="language-plaintext highlighter-rouge">VarianceThresholdSelector</code> is a selector that removes low-variance features. Features with a
 variance not greater than the <code class="language-plaintext highlighter-rouge">varianceThreshold</code> will be removed. If not set, <code class="language-plaintext highlighter-rouge">varianceThreshold</code>
 defaults to 0, which means only features with variance 0 (i.e. features that have the same value in all samples)
 will be removed.</p>

<p><strong>Examples</strong></p>

<p>Assume that we have a DataFrame with the columns <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">features</code>, which is used as
our target to be predicted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features
---|--------------------------------
 1 | [6.0, 7.0, 0.0, 7.0, 6.0, 0.0]
 2 | [0.0, 9.0, 6.0, 0.0, 5.0, 9.0]
 3 | [0.0, 9.0, 3.0, 0.0, 5.0, 5.0]
 4 | [0.0, 9.0, 8.0, 5.0, 6.0, 4.0]
 5 | [8.0, 9.0, 6.0, 5.0, 4.0, 4.0]
 6 | [8.0, 9.0, 6.0, 0.0, 0.0, 0.0]
</code></pre></div></div>

<p>The variance for the 6 features are 16.67, 0.67, 8.17, 10.17,
5.07, and 11.47 respectively. If we use <code class="language-plaintext highlighter-rouge">VarianceThresholdSelector</code> with
<code class="language-plaintext highlighter-rouge">varianceThreshold = 8.0</code>, then the features with variance &lt;= 8.0 are removed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>id | features                       | selectedFeatures
---|--------------------------------|-------------------
 1 | [6.0, 7.0, 0.0, 7.0, 6.0, 0.0] | [6.0,0.0,7.0,0.0]
 2 | [0.0, 9.0, 6.0, 0.0, 5.0, 9.0] | [0.0,6.0,0.0,9.0]
 3 | [0.0, 9.0, 3.0, 0.0, 5.0, 5.0] | [0.0,3.0,0.0,5.0]
 4 | [0.0, 9.0, 8.0, 5.0, 6.0, 4.0] | [0.0,8.0,5.0,4.0]
 5 | [8.0, 9.0, 6.0, 5.0, 4.0, 4.0] | [8.0,6.0,5.0,4.0]
 6 | [8.0, 9.0, 6.0, 0.0, 0.0, 0.0] | [8.0,6.0,0.0,0.0]
</code></pre></div></div>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/VarianceThresholdSelector.html">VarianceThresholdSelector Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.VarianceThresholdSelector</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>

<span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">6.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">8.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">8.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">))</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">df</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataset</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">selector</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">VarianceThresholdSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setVarianceThreshold</span><span class="o">(</span><span class="mf">8.0</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">result</span> <span class="k">=</span> <span class="nv">selector</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="py">transform</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>

<span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Output: Features with variance lower than"</span> <span class="o">+</span>
  <span class="n">s</span><span class="s">" ${selector.getVarianceThreshold} are removed."</span><span class="o">)</span>
<span class="nv">result</span><span class="o">.</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/VarianceThresholdSelectorExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/VarianceThresholdSelector.html">VarianceThresholdSelector Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.VarianceThresholdSelector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.*</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">6.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">7.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">3.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">8.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">8.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">5.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">8.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">6.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">))</span>
<span class="o">);</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">VarianceThresholdSelector</span> <span class="n">selector</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">VarianceThresholdSelector</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setVarianceThreshold</span><span class="o">(</span><span class="mf">8.0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setFeaturesCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"selectedFeatures"</span><span class="o">);</span>

<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">df</span><span class="o">).</span><span class="na">transform</span><span class="o">(</span><span class="n">df</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Output: Features with variance lower than "</span>
    <span class="o">+</span> <span class="n">selector</span><span class="o">.</span><span class="na">getVarianceThreshold</span><span class="o">()</span> <span class="o">+</span> <span class="s">" are removed."</span><span class="o">);</span>
<span class="n">result</span><span class="o">.</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaVarianceThresholdSelectorExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.VarianceThresholdSelector.html">VarianceThresholdSelector Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">VarianceThresholdSelector</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])),</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))],</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThresholdSelector</span><span class="p">(</span><span class="n">varianceThreshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"selectedFeatures"</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">selector</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">).</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Output: Features with variance lower than %f are removed."</span> <span class="o">%</span>
      <span class="n">selector</span><span class="p">.</span><span class="n">getVarianceThreshold</span><span class="p">())</span>
<span class="n">result</span><span class="p">.</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/variance_threshold_selector_example.py" in the Spark repo.</small></div>
  </div>
</div>

<h1 id="locality-sensitive-hashing">Locality Sensitive Hashing</h1>
<p><a href="https://en.wikipedia.org/wiki/Locality-sensitive_hashing">Locality Sensitive Hashing (LSH)</a> is an important class of hashing techniques, which is commonly used in clustering, approximate nearest neighbor search and outlier detection with large datasets.</p>

<p>The general idea of LSH is to use a family of functions (&#8220;LSH families&#8221;) to hash data points into buckets, so that the data points which are close to each other are in the same buckets with high probability, while data points that are far away from each other are very likely in different buckets. An LSH family is formally defined as follows.</p>

<p>In a metric space <code class="language-plaintext highlighter-rouge">(M, d)</code>, where <code class="language-plaintext highlighter-rouge">M</code> is a set and <code class="language-plaintext highlighter-rouge">d</code> is a distance function on <code class="language-plaintext highlighter-rouge">M</code>, an LSH family is a family of functions <code class="language-plaintext highlighter-rouge">h</code> that satisfy the following properties:
<code class="language-plaintext highlighter-rouge">\[
\forall p, q \in M,\\
d(p,q) \leq r1 \Rightarrow Pr(h(p)=h(q)) \geq p1\\
d(p,q) \geq r2 \Rightarrow Pr(h(p)=h(q)) \leq p2
\]</code>
This LSH family is called <code class="language-plaintext highlighter-rouge">(r1, r2, p1, p2)</code>-sensitive.</p>

<p>In Spark, different LSH families are implemented in separate classes (e.g., <code class="language-plaintext highlighter-rouge">MinHash</code>), and APIs for feature transformation, approximate similarity join and approximate nearest neighbor are provided in each class.</p>

<p>In LSH, we define a false positive as a pair of distant input features (with <code class="language-plaintext highlighter-rouge">$d(p,q) \geq r2$</code>) which are hashed into the same bucket, and we define a false negative as a pair of nearby features (with <code class="language-plaintext highlighter-rouge">$d(p,q) \leq r1$</code>) which are hashed into different buckets.</p>

<h2 id="lsh-operations">LSH Operations</h2>

<p>We describe the major types of operations which LSH can be used for.  A fitted LSH model has methods for each of these operations.</p>

<h3 id="feature-transformation">Feature Transformation</h3>
<p>Feature transformation is the basic functionality to add hashed values as a new column. This can be useful for dimensionality reduction. Users can specify input and output column names by setting <code class="language-plaintext highlighter-rouge">inputCol</code> and <code class="language-plaintext highlighter-rouge">outputCol</code>.</p>

<p>LSH also supports multiple LSH hash tables. Users can specify the number of hash tables by setting <code class="language-plaintext highlighter-rouge">numHashTables</code>. This is also used for <a href="https://en.wikipedia.org/wiki/Locality-sensitive_hashing#Amplification">OR-amplification</a> in approximate similarity join and approximate nearest neighbor. Increasing the number of hash tables will increase the accuracy but will also increase communication cost and running time.</p>

<p>The type of <code class="language-plaintext highlighter-rouge">outputCol</code> is <code class="language-plaintext highlighter-rouge">Seq[Vector]</code> where the dimension of the array equals <code class="language-plaintext highlighter-rouge">numHashTables</code>, and the dimensions of the vectors are currently set to 1. In future releases, we will implement AND-amplification so that users can specify the dimensions of these vectors.</p>

<h3 id="approximate-similarity-join">Approximate Similarity Join</h3>
<p>Approximate similarity join takes two datasets and approximately returns pairs of rows in the datasets whose distance is smaller than a user-defined threshold. Approximate similarity join supports both joining two different datasets and self-joining. Self-joining will produce some duplicate pairs.</p>

<p>Approximate similarity join accepts both transformed and untransformed datasets as input. If an untransformed dataset is used, it will be transformed automatically. In this case, the hash signature will be created as <code class="language-plaintext highlighter-rouge">outputCol</code>.</p>

<p>In the joined dataset, the origin datasets can be queried in <code class="language-plaintext highlighter-rouge">datasetA</code> and <code class="language-plaintext highlighter-rouge">datasetB</code>. A distance column will be added to the output dataset to show the true distance between each pair of rows returned.</p>

<h3 id="approximate-nearest-neighbor-search">Approximate Nearest Neighbor Search</h3>
<p>Approximate nearest neighbor search takes a dataset (of feature vectors) and a key (a single feature vector), and it approximately returns a specified number of rows in the dataset that are closest to the vector.</p>

<p>Approximate nearest neighbor search accepts both transformed and untransformed datasets as input. If an untransformed dataset is used, it will be transformed automatically. In this case, the hash signature will be created as <code class="language-plaintext highlighter-rouge">outputCol</code>.</p>

<p>A distance column will be added to the output dataset to show the true distance between each output row and the searched key.</p>

<p><strong>Note:</strong> Approximate nearest neighbor search will return fewer than <code class="language-plaintext highlighter-rouge">k</code> rows when there are not enough candidates in the hash bucket.</p>

<h2 id="lsh-algorithms">LSH Algorithms</h2>

<h3 id="bucketed-random-projection-for-euclidean-distance">Bucketed Random Projection for Euclidean Distance</h3>

<p><a href="https://en.wikipedia.org/wiki/Locality-sensitive_hashing#Stable_distributions">Bucketed Random Projection</a> is an LSH family for Euclidean distance. The Euclidean distance is defined as follows:
<code class="language-plaintext highlighter-rouge">\[
d(\mathbf{x}, \mathbf{y}) = \sqrt{\sum_i (x_i - y_i)^2}
\]</code>
Its LSH family projects feature vectors <code class="language-plaintext highlighter-rouge">$\mathbf{x}$</code> onto a random unit vector <code class="language-plaintext highlighter-rouge">$\mathbf{v}$</code> and portions the projected results into hash buckets:
<code class="language-plaintext highlighter-rouge">\[
h(\mathbf{x}) = \Big\lfloor \frac{\mathbf{x} \cdot \mathbf{v}}{r} \Big\rfloor
\]</code>
where <code class="language-plaintext highlighter-rouge">r</code> is a user-defined bucket length. The bucket length can be used to control the average size of hash buckets (and thus the number of buckets). A larger bucket length (i.e., fewer buckets) increases the probability of features being hashed to the same bucket (increasing the numbers of true and false positives).</p>

<p>Bucketed Random Projection accepts arbitrary vectors as input features, and supports both sparse and dense vectors.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/BucketedRandomProjectionLSH.html">BucketedRandomProjectionLSH Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.BucketedRandomProjectionLSH</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions.col</span>

<span class="k">val</span> <span class="nv">dfA</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dfB</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">key</span> <span class="k">=</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">brp</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BucketedRandomProjectionLSH</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setBucketLength</span><span class="o">(</span><span class="mf">2.0</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setNumHashTables</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hashes"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">brp</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dfA</span><span class="o">)</span>

<span class="c1">// Feature Transformation</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dfA</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate</span>
<span class="c1">// similarity join.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxSimilarityJoin(transformedA, transformedB, 1.5)`</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Approximately joining dfA and dfB on Euclidean distance smaller than 1.5:"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">approxSimilarityJoin</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">dfB</span><span class="o">,</span> <span class="mf">1.5</span><span class="o">,</span> <span class="s">"EuclideanDistance"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"datasetA.id"</span><span class="o">).</span><span class="py">alias</span><span class="o">(</span><span class="s">"idA"</span><span class="o">),</span>
    <span class="nf">col</span><span class="o">(</span><span class="s">"datasetB.id"</span><span class="o">).</span><span class="py">alias</span><span class="o">(</span><span class="s">"idB"</span><span class="o">),</span>
    <span class="nf">col</span><span class="o">(</span><span class="s">"EuclideanDistance"</span><span class="o">)).</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate nearest</span>
<span class="c1">// neighbor search.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxNearestNeighbors(transformedA, key, 2)`</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">approxNearestNeighbors</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/BucketedRandomProjectionLSHExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/BucketedRandomProjectionLSH.html">BucketedRandomProjectionLSH Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.BucketedRandomProjectionLSH</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.BucketedRandomProjectionLSHModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">functions</span><span class="o">.</span><span class="na">col</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataA</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">)),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataB</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(-</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)),</span>
    <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">))</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dfA</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">dataA</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dfB</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">dataB</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="nc">Vector</span> <span class="n">key</span> <span class="o">=</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">dense</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">0.0</span><span class="o">);</span>

<span class="nc">BucketedRandomProjectionLSH</span> <span class="n">mh</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BucketedRandomProjectionLSH</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setBucketLength</span><span class="o">(</span><span class="mf">2.0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setNumHashTables</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"hashes"</span><span class="o">);</span>

<span class="nc">BucketedRandomProjectionLSHModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dfA</span><span class="o">);</span>

<span class="c1">// Feature Transformation</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dfA</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate</span>
<span class="c1">// similarity join.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxSimilarityJoin(transformedA, transformedB, 1.5)`</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Approximately joining dfA and dfB on distance smaller than 1.5:"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">approxSimilarityJoin</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">dfB</span><span class="o">,</span> <span class="mf">1.5</span><span class="o">,</span> <span class="s">"EuclideanDistance"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"datasetA.id"</span><span class="o">).</span><span class="na">alias</span><span class="o">(</span><span class="s">"idA"</span><span class="o">),</span>
    <span class="n">col</span><span class="o">(</span><span class="s">"datasetB.id"</span><span class="o">).</span><span class="na">alias</span><span class="o">(</span><span class="s">"idB"</span><span class="o">),</span>
    <span class="n">col</span><span class="o">(</span><span class="s">"EuclideanDistance"</span><span class="o">)).</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate nearest</span>
<span class="c1">// neighbor search.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxNearestNeighbors(transformedA, key, 2)`</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">approxNearestNeighbors</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaBucketedRandomProjectionLSHExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.BucketedRandomProjectionLSH.html">BucketedRandomProjectionLSH Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">BucketedRandomProjectionLSH</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

<span class="n">dataA</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),)]</span>
<span class="n">dfA</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dataA</span><span class="p">,</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">dataB</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]),)]</span>
<span class="n">dfB</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dataB</span><span class="p">,</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">brp</span> <span class="o">=</span> <span class="n">BucketedRandomProjectionLSH</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"hashes"</span><span class="p">,</span> <span class="n">bucketLength</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                                  <span class="n">numHashTables</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">brp</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dfA</span><span class="p">)</span>

<span class="c1"># Feature Transformation
</span><span class="k">print</span><span class="p">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dfA</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Compute the locality sensitive hashes for the input rows, then perform approximate
# similarity join.
# We could avoid computing hashes by passing in the already-transformed dataset, e.g.
# `model.approxSimilarityJoin(transformedA, transformedB, 1.5)`
</span><span class="k">print</span><span class="p">(</span><span class="s">"Approximately joining dfA and dfB on Euclidean distance smaller than 1.5:"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">approxSimilarityJoin</span><span class="p">(</span><span class="n">dfA</span><span class="p">,</span> <span class="n">dfB</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">distCol</span><span class="o">=</span><span class="s">"EuclideanDistance"</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"datasetA.id"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"idA"</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s">"datasetB.id"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"idB"</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s">"EuclideanDistance"</span><span class="p">)).</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Compute the locality sensitive hashes for the input rows, then perform approximate nearest
# neighbor search.
# We could avoid computing hashes by passing in the already-transformed dataset, e.g.
# `model.approxNearestNeighbors(transformedA, key, 2)`
</span><span class="k">print</span><span class="p">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">approxNearestNeighbors</span><span class="p">(</span><span class="n">dfA</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/bucketed_random_projection_lsh_example.py" in the Spark repo.</small></div>
  </div>

</div>

<h3 id="minhash-for-jaccard-distance">MinHash for Jaccard Distance</h3>
<p><a href="https://en.wikipedia.org/wiki/MinHash">MinHash</a> is an LSH family for Jaccard distance where input features are sets of natural numbers. Jaccard distance of two sets is defined by the cardinality of their intersection and union:
<code class="language-plaintext highlighter-rouge">\[
d(\mathbf{A}, \mathbf{B}) = 1 - \frac{|\mathbf{A} \cap \mathbf{B}|}{|\mathbf{A} \cup \mathbf{B}|}
\]</code>
MinHash applies a random hash function <code class="language-plaintext highlighter-rouge">g</code> to each element in the set and take the minimum of all hashed values:
<code class="language-plaintext highlighter-rouge">\[
h(\mathbf{A}) = \min_{a \in \mathbf{A}}(g(a))
\]</code></p>

<p>The input sets for MinHash are represented as binary vectors, where the vector indices represent the elements themselves and the non-zero values in the vector represent the presence of that element in the set. While both dense and sparse vectors are supported, typically sparse vectors are recommended for efficiency. For example, <code class="language-plaintext highlighter-rouge">Vectors.sparse(10, Array[(2, 1.0), (3, 1.0), (5, 1.0)])</code> means there are 10 elements in the space. This set contains elem 2, elem 3 and elem 5. All non-zero values are treated as binary &#8220;1&#8221; values.</p>

<p><strong>Note:</strong> Empty sets cannot be transformed by MinHash, which means any input vector must have at least 1 non-zero entry.</p>

<div class="codetabs">
<div data-lang="scala">

    <p>Refer to the <a href="api/scala/org/apache/spark/ml/feature/MinHashLSH.html">MinHashLSH Scala docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="k">import</span> <span class="nn">org.apache.spark.ml.feature.MinHashLSH</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions.col</span>

<span class="k">val</span> <span class="nv">dfA</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)))),</span>
  <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)))),</span>
  <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">dfB</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">createDataFrame</span><span class="o">(</span><span class="nc">Seq</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)))),</span>
  <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)))),</span>
  <span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">))))</span>
<span class="o">)).</span><span class="py">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">key</span> <span class="k">=</span> <span class="nv">Vectors</span><span class="o">.</span><span class="py">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">((</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">),</span> <span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">)))</span>

<span class="k">val</span> <span class="nv">mh</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MinHashLSH</span><span class="o">()</span>
  <span class="o">.</span><span class="py">setNumHashTables</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">setOutputCol</span><span class="o">(</span><span class="s">"hashes"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">model</span> <span class="k">=</span> <span class="nv">mh</span><span class="o">.</span><span class="py">fit</span><span class="o">(</span><span class="n">dfA</span><span class="o">)</span>

<span class="c1">// Feature Transformation</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">transform</span><span class="o">(</span><span class="n">dfA</span><span class="o">).</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate</span>
<span class="c1">// similarity join.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxSimilarityJoin(transformedA, transformedB, 0.6)`</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Approximately joining dfA and dfB on Jaccard distance smaller than 0.6:"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">approxSimilarityJoin</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">dfB</span><span class="o">,</span> <span class="mf">0.6</span><span class="o">,</span> <span class="s">"JaccardDistance"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"datasetA.id"</span><span class="o">).</span><span class="py">alias</span><span class="o">(</span><span class="s">"idA"</span><span class="o">),</span>
    <span class="nf">col</span><span class="o">(</span><span class="s">"datasetB.id"</span><span class="o">).</span><span class="py">alias</span><span class="o">(</span><span class="s">"idB"</span><span class="o">),</span>
    <span class="nf">col</span><span class="o">(</span><span class="s">"JaccardDistance"</span><span class="o">)).</span><span class="py">show</span><span class="o">()</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate nearest</span>
<span class="c1">// neighbor search.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxNearestNeighbors(transformedA, key, 2)`</span>
<span class="c1">// It may return less than 2 rows when not enough approximate near-neighbor candidates are</span>
<span class="c1">// found.</span>
<span class="nf">println</span><span class="o">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="o">)</span>
<span class="nv">model</span><span class="o">.</span><span class="py">approxNearestNeighbors</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="py">show</span><span class="o">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/scala/org/apache/spark/examples/ml/MinHashLSHExample.scala" in the Spark repo.</small></div>
  </div>

<div data-lang="java">

    <p>Refer to the <a href="api/java/org/apache/spark/ml/feature/MinHashLSH.html">MinHashLSH Java docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MinHashLSH</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.MinHashLSHModel</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.VectorUDT</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vectors</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Dataset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.RowFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.DataTypes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.StructType</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">functions</span><span class="o">.</span><span class="na">col</span><span class="o">;</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataA</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">}))</span>
<span class="o">);</span>

<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dataB</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">})),</span>
  <span class="nc">RowFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[]{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">}))</span>
<span class="o">);</span>

<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StructType</span><span class="o">(</span><span class="k">new</span> <span class="nc">StructField</span><span class="o">[]{</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="nc">DataTypes</span><span class="o">.</span><span class="na">IntegerType</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">()),</span>
  <span class="k">new</span> <span class="nf">StructField</span><span class="o">(</span><span class="s">"features"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">VectorUDT</span><span class="o">(),</span> <span class="kc">false</span><span class="o">,</span> <span class="nc">Metadata</span><span class="o">.</span><span class="na">empty</span><span class="o">())</span>
<span class="o">});</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dfA</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">dataA</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>
<span class="nc">Dataset</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">&gt;</span> <span class="n">dfB</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="na">createDataFrame</span><span class="o">(</span><span class="n">dataB</span><span class="o">,</span> <span class="n">schema</span><span class="o">);</span>

<span class="kt">int</span><span class="o">[]</span> <span class="n">indices</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="o">{</span><span class="mf">1.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">};</span>
<span class="nc">Vector</span> <span class="n">key</span> <span class="o">=</span> <span class="nc">Vectors</span><span class="o">.</span><span class="na">sparse</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="n">indices</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span>

<span class="nc">MinHashLSH</span> <span class="n">mh</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MinHashLSH</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setNumHashTables</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"features"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputCol</span><span class="o">(</span><span class="s">"hashes"</span><span class="o">);</span>

<span class="nc">MinHashLSHModel</span> <span class="n">model</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dfA</span><span class="o">);</span>

<span class="c1">// Feature Transformation</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="n">dfA</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate</span>
<span class="c1">// similarity join.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxSimilarityJoin(transformedA, transformedB, 0.6)`</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Approximately joining dfA and dfB on Jaccard distance smaller than 0.6:"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">approxSimilarityJoin</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">dfB</span><span class="o">,</span> <span class="mf">0.6</span><span class="o">,</span> <span class="s">"JaccardDistance"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"datasetA.id"</span><span class="o">).</span><span class="na">alias</span><span class="o">(</span><span class="s">"idA"</span><span class="o">),</span>
    <span class="n">col</span><span class="o">(</span><span class="s">"datasetB.id"</span><span class="o">).</span><span class="na">alias</span><span class="o">(</span><span class="s">"idB"</span><span class="o">),</span>
    <span class="n">col</span><span class="o">(</span><span class="s">"JaccardDistance"</span><span class="o">)).</span><span class="na">show</span><span class="o">();</span>

<span class="c1">// Compute the locality sensitive hashes for the input rows, then perform approximate nearest</span>
<span class="c1">// neighbor search.</span>
<span class="c1">// We could avoid computing hashes by passing in the already-transformed dataset, e.g.</span>
<span class="c1">// `model.approxNearestNeighbors(transformedA, key, 2)`</span>
<span class="c1">// It may return less than 2 rows when not enough approximate near-neighbor candidates are</span>
<span class="c1">// found.</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="o">);</span>
<span class="n">model</span><span class="o">.</span><span class="na">approxNearestNeighbors</span><span class="o">(</span><span class="n">dfA</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="na">show</span><span class="o">();</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/java/org/apache/spark/examples/ml/JavaMinHashLSHExample.java" in the Spark repo.</small></div>
  </div>

<div data-lang="python">

    <p>Refer to the <a href="api/python/reference/api/pyspark.ml.feature.MinHashLSH.html">MinHashLSH Python docs</a>
for more details on the API.</p>

    <div class="highlight"><pre class="codehilite"><code><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">MinHashLSH</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

<span class="n">dataA</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),)]</span>
<span class="n">dfA</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dataA</span><span class="p">,</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">dataB</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),),</span>
         <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),)]</span>
<span class="n">dfB</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dataB</span><span class="p">,</span> <span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">])</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">Vectors</span><span class="p">.</span><span class="n">sparse</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">mh</span> <span class="o">=</span> <span class="n">MinHashLSH</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s">"features"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s">"hashes"</span><span class="p">,</span> <span class="n">numHashTables</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mh</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dfA</span><span class="p">)</span>

<span class="c1"># Feature Transformation
</span><span class="k">print</span><span class="p">(</span><span class="s">"The hashed dataset where hashed values are stored in the column 'hashes':"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">dfA</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Compute the locality sensitive hashes for the input rows, then perform approximate
# similarity join.
# We could avoid computing hashes by passing in the already-transformed dataset, e.g.
# `model.approxSimilarityJoin(transformedA, transformedB, 0.6)`
</span><span class="k">print</span><span class="p">(</span><span class="s">"Approximately joining dfA and dfB on distance smaller than 0.6:"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">approxSimilarityJoin</span><span class="p">(</span><span class="n">dfA</span><span class="p">,</span> <span class="n">dfB</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">distCol</span><span class="o">=</span><span class="s">"JaccardDistance"</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"datasetA.id"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"idA"</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s">"datasetB.id"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"idB"</span><span class="p">),</span>
            <span class="n">col</span><span class="p">(</span><span class="s">"JaccardDistance"</span><span class="p">)).</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Compute the locality sensitive hashes for the input rows, then perform approximate nearest
# neighbor search.
# We could avoid computing hashes by passing in the already-transformed dataset, e.g.
# `model.approxNearestNeighbors(transformedA, key, 2)`
# It may return less than 2 rows when not enough approximate near-neighbor candidates are
# found.
</span><span class="k">print</span><span class="p">(</span><span class="s">"Approximately searching dfA for 2 nearest neighbors of the key:"</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">approxNearestNeighbors</span><span class="p">(</span><span class="n">dfA</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">show</span><span class="p">()</span></code></pre></div>
    <div><small>Find full example code at "examples/src/main/python/ml/min_hash_lsh_example.py" in the Spark repo.</small></div>
  </div>
</div>


                </div>
            
             <!-- /container -->
        </div>

        <script src="js/vendor/jquery-3.5.1.min.js"></script>
        <script src="js/vendor/bootstrap.bundle.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
        <script type="text/javascript">
            // DocSearch is entirely free and automated. DocSearch is built in two parts:
            // 1. a crawler which we run on our own infrastructure every 24 hours. It follows every link
            //    in your website and extract content from every page it traverses. It then pushes this
            //    content to an Algolia index.
            // 2. a JavaScript snippet to be inserted in your website that will bind this Algolia index
            //    to your search input and display its results in a dropdown UI. If you want to find more
            //    details on how works DocSearch, check the docs of DocSearch.
            docsearch({
    apiKey: 'b18ca3732c502995563043aa17bc6ecb',
    indexName: 'apache_spark',
    inputSelector: '#docsearch-input',
    enhancedSearchInput: true,
    algoliaOptions: {
      'facetFilters': ["version:3.1.2"]
    },
    debug: false // Set debug to true if you want to inspect the dropdown
});

        </script>

        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js' +
                    '?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    </body>
</html>
