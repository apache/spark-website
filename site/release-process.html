<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
     Release Process | Apache Spark
    
  </title>

  

  

  <!-- Bootstrap core CSS -->
  <link href="/css/cerulean.min.css" rel="stylesheet">
  <link href="/css/custom.css" rel="stylesheet">

  <!-- Code highlighter CSS -->
  <link href="/css/pygments-default.css" rel="stylesheet">

  <script type="text/javascript">
  <!-- Google Analytics initialization -->
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32518208-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  <!-- Adds slight delay to links to allow async reporting -->
  function trackOutboundLink(link, category, action) {
    try {
      _gaq.push(['_trackEvent', category , action]);
    } catch(err){}

    setTimeout(function() {
      document.location.href = link.href;
    }, 100);
  }
  </script>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->
</head>

<body>

<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script src="/js/lang-tabs.js"></script>
<script src="/js/downloads.js"></script>

<div class="container" style="max-width: 1200px;">

<div class="masthead">
  
    <p class="lead">
      <a href="/">
      <img src="/images/spark-logo-trademark.png"
        style="height:100px; width:auto; vertical-align: bottom; margin-top: 20px;"></a><span class="tagline">
          Lightning-fast cluster computing
      </span>
    </p>
  
</div>

<nav class="navbar navbar-default" role="navigation">
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target="#navbar-collapse-1">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class="collapse navbar-collapse" id="navbar-collapse-1">
    <ul class="nav navbar-nav">
      <li><a href="/downloads.html">Download</a></li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          Libraries <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/sql/">SQL and DataFrames</a></li>
          <li><a href="/streaming/">Spark Streaming</a></li>
          <li><a href="/mllib/">MLlib (machine learning)</a></li>
          <li><a href="/graphx/">GraphX (graph)</a></li>
          <li class="divider"></li>
          <li><a href="/third-party-projects.html">Third-Party Projects</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          Documentation <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/docs/latest/">Latest Release (Spark 2.2.0)</a></li>
          <li><a href="/documentation.html">Older Versions and Other Resources</a></li>
          <li><a href="/faq.html">Frequently Asked Questions</a></li>
        </ul>
      </li>
      <li><a href="/examples.html">Examples</a></li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
          Community <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/community.html">Mailing Lists &amp; Resources</a></li>
          <li><a href="/contributing.html">Contributing to Spark</a></li>
          <li><a href="/improvement-proposals.html">Improvement Proposals (SPIP)</a></li>
          <li><a href="https://issues.apache.org/jira/browse/SPARK">Issue Tracker</a></li>
          <li><a href="/powered-by.html">Powered By</a></li>
          <li><a href="/committers.html">Project Committers</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
           Developers <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
          <li><a href="/developer-tools.html">Useful Developer Tools</a></li>
          <li><a href="/versioning-policy.html">Versioning Policy</a></li>
          <li><a href="/release-process.html">Release Process</a></li>
          <li><a href="/security.html">Security</a></li>
        </ul>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="https://www.apache.org/" class="dropdown-toggle" data-toggle="dropdown">
          Apache Software Foundation <b class="caret"></b></a>
        <ul class="dropdown-menu">
          <li><a href="https://www.apache.org/">Apache Homepage</a></li>
          <li><a href="https://www.apache.org/licenses/">License</a></li>
          <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
          <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
          <li><a href="https://www.apache.org/security/">Security</a></li>
        </ul>
      </li>
    </ul>
  </div>
  <!-- /.navbar-collapse -->
</nav>


<div class="row">
  <div class="col-md-3 col-md-push-9">
    <div class="news" style="margin-bottom: 20px;">
      <h5>Latest News</h5>
      <ul class="list-unstyled">
        
          <li><a href="/news/spark-summit-eu-2017-agenda-posted.html">Spark Summit Europe (October 24-26th, 2017, Dublin, Ireland) agenda posted</a>
          <span class="small">(Aug 28, 2017)</span></li>
        
          <li><a href="/news/spark-2-2-0-released.html">Spark 2.2.0 released</a>
          <span class="small">(Jul 11, 2017)</span></li>
        
          <li><a href="/news/spark-2-1-1-released.html">Spark 2.1.1 released</a>
          <span class="small">(May 02, 2017)</span></li>
        
          <li><a href="/news/spark-summit-june-2017-agenda-posted.html">Spark Summit (June 5-7th, 2017, San Francisco) agenda posted</a>
          <span class="small">(Mar 31, 2017)</span></li>
        
      </ul>
      <p class="small" style="text-align: right;"><a href="/news/index.html">Archive</a></p>
    </div>
    <div class="hidden-xs hidden-sm">
      <a href="/downloads.html" class="btn btn-success btn-lg btn-block" style="margin-bottom: 30px;">
        Download Spark
      </a>
      <p style="font-size: 16px; font-weight: 500; color: #555;">
        Built-in Libraries:
      </p>
      <ul class="list-none">
        <li><a href="/sql/">SQL and DataFrames</a></li>
        <li><a href="/streaming/">Spark Streaming</a></li>
        <li><a href="/mllib/">MLlib (machine learning)</a></li>
        <li><a href="/graphx/">GraphX (graph)</a></li>
      </ul>
      <a href="/third-party-projects.html">Third-Party Projects</a>
    </div>
  </div>

  <div class="col-md-9 col-md-pull-3">
    <h2>Preparing Spark Releases</h2>

<h3>Background</h3>

<p>The release manager role in Spark means you are responsible for a few different things:</p>

<ol>
  <li>Preparing for release candidates:
    <ol>
      <li>cutting a release branch</li>
      <li>informing the community of timing</li>
      <li>working with component leads to clean up JIRA</li>
      <li>making code changes in that branch with necessary version updates</li>
    </ol>
  </li>
  <li>Running the voting process for a release:
    <ol>
      <li>creating release candidates using automated tooling</li>
      <li>calling votes and triaging issues</li>
    </ol>
  </li>
  <li>Finalizing and posting a release:
    <ol>
      <li>updating the Spark website</li>
      <li>writing release notes</li>
      <li>announcing the release</li>
    </ol>
  </li>
</ol>

<h2>Preparing Spark for Release</h2>

<p>The main step towards preparing a release is to create a release branch. This is done via 
standard Git branching mechanism and should be announced to the community once the branch is 
created. It is also good to set up Jenkins jobs for the release branch once it is cut to 
ensure tests are passing (consult Josh Rosen and Shane Knapp for help with this).</p>

<h3>Cutting a Release Candidate</h3>

<p>If this is not the first RC, then make sure that the JIRA issues that have been solved since the 
last RC are marked as <code>FIXED</code> in this release version.</p>

<ul>
  <li>A possible protocol for this is to mark such issues as <code>FIXED</code> in next maintenance release. 
For example if you are cutting RC for 1.0.2, mark such issues as <code>FIXED</code> in 1.0.3.</li>
  <li>When cutting new RC, find all the issues that are marked as <code>FIXED</code> for next maintenance 
release, and change them to the current release.</li>
  <li>Verify from <code>git log</code> whether they are actually making it in the new RC or not.</li>
</ul>

<p>The process of cutting a release candidate has been partially automated via the AMPLab Jenkins. There are
Jenkins jobs that can tag a release candidate and create various packages based on that candidate.</p>

<p>At present the Jenkins jobs <em>SHOULD NOT BE USED</em> as they use a legacy shared key for signing.
Instead much of the same release logic can be accessed in <code>dev/create-release/release-tag.sh</code> and <code>dev/create-release/release-build.sh</code>. The general order of creating a release using the scripts is:</p>

<ul>
  <li>Verify Jenkins test pass on your desired commit</li>
  <li>Set the shell enviroment variables used by the scripts (run with &#8220;help&#8221; for details)</li>
  <li>Verify your JAVA_HOME is set to the correct Java version (2.2+ Java 8, pre-2.2 Java 7)</li>
  <li>You may find Felix&#8217;s docker env useful - https://github.com/felixcheung/spark-build/blob/master/Dockerfile .</li>
  <li>Ensure you have the required dependencies to build the docs <code>docs/README.md</code></li>
  <li>R, for CRAN packaging tests, requires e1071 to be installed as part of the packaging tests.</li>
  <li>In addition R uses LaTeX for some things, and requires some additional fonts. On Debian based systems you may wish to install <code>texlive-fonts-recommended</code> and <code>texlive-fonts-extra</code>.</li>
  <li>Make sure you required Python packages for packaging (see <code>dev/requirements.txt</code>)</li>
  <li>Tag the release candidate with <code>dev/create-release/release-tag.sh</code> (e.g. for creating 2.1.2 RC2 we did <code>ASF_USERNAME=holden ASF_PASSWORD=yoursecretgoeshere GIT_NAME="Holden Karau" GIT_BRANCH=branch-2.1 GIT_EMAIL="holden@us.ibm.com" RELEASE_VERSION=2.1.2 RELEASE_TAG=v2.1.2-rc2 NEXT_VERSION=2.1.3-SNAPSHOT ./dev/create-release/release-tag.sh</code>)</li>
  <li>Package the release binaries &amp; sources with <code>dev/create-release/release-build.sh package</code></li>
  <li>Create the release docs with <code>dev/create-release/release-build.sh docs</code></li>
  <li>For Spark versions prior to 2.1.2, change the SPARK_VERSION from X.Y.Z to X.Y.Z-rcA then run <code>dev/create-release/release-build.sh publish-release</code>.</li>
  <li>Publish a snapshot to the Apache release repo <code>dev/create-release/release-build.sh publish-release</code></li>
</ul>

<p>If the Jenkins jobs have been updated to support signing with your key you can look at the job required for a release are located in the <a href="https://amplab.cs.berkeley.edu/jenkins/view/Spark%20Release/">Spark Release Jobs</a> collection.
If you don&#8217;t have access, talk to a previous release manager for guidance and to get access.
The jobs can be launched with &#8220;Build with Parameters&#8221; and the general order is:</p>

<ul>
  <li>Create a tag for the current RC with <a href="https://amplab.cs.berkeley.edu/jenkins/view/Spark%20Release/job/spark-release-tag/">spark-release-tag</a> job.</li>
  <li>Kick off the rest of the jobs except spark-release-publish after the current RC has been configured.</li>
  <li>Once the packaging and doc jobs have finished kick off the <a href="https://amplab.cs.berkeley.edu/jenkins/view/Spark%20Release/job/spark-release-publish">spark-release-publish</a> job.</li>
</ul>

<p>The jobs are configured through build parameters. If the build parameters are unclear you can look at previous releases or if available, the recommended process is to ask the previous release manager to walk you through the Jenkins jobs as this document may not be 100% up to date.</p>

<h3>Call a Vote on the Release Candidate</h3>

<p>The release voting takes place on the Apache Spark developers list (the PMC is voting). 
Look at past voting threads to see how this proceeds. The email should follow 
<a href="https://mail-archives.apache.org/mod_mbox/spark-dev/201407.mbox/%3cCABPQxss7Cf+YaUuxCk0jnusH4207hCP4dkWn3BWFSvdnD86HHQ@mail.gmail.com%3e">this format</a>.</p>

<ul>
  <li>Make a shortened link to the full list of JIRAs using <a href="https://s.apache.org/">https://s.apache.org/</a></li>
  <li>If possible, attach a draft of the release notes with the email</li>
  <li>Make sure the voting closing time is in UTC format. Use this script to generate it</li>
  <li>Make sure the email is in text format and the links are correct</li>
</ul>

<p>Once the vote is done, you should also send out a summary email with the totals, with a subject 
that looks something like <code>[RESULT] [VOTE]...</code>.</p>

<h3>Finalize the Release</h3>

<p><strong>Be Careful!</strong></p>

<p><strong>THIS STEP IS IRREVERSIBLE so make sure you selected the correct staging repository. Once you 
move the artifacts into the release folder, they cannot be removed.</strong></p>

<p>After the vote passes, find the staging repository and click Release and confirm. To upload the 
binaries, you have to first upload them to the dev directory in the Apache Distribution repo, 
and then move the binaries from dev directory to release directory. This &#8220;moving&#8221; is the only
 way you can add stuff to the actual release directory.</p>

<pre><code># Checkout the Spark directory in Apache distribution SVN "dev" repo
$ svn co https://dist.apache.org/repos/dist/dev/spark/
  
# Make directory for this RC in the above directory
mkdir spark-1.1.1-rc2
 
# Download the voted binaries and add them to the directory
$ sftp -r andrewor14@people.apache.org:~/public_html/spark-1.1.1-rc2/* spark-1.1.1-rc2
 
# NOTE: Remove any binaries you don’t want to publish
# E.g. never push MapR and *without-hive artifacts to apache
$ rm spark-1.1.1-rc2/*mapr*
$ rm spark-1.1.1-rc2/*without-hive*
$ svn add spark-1.1.1-rc2
$ svn commit -m "Add spark-1.1.1-rc2" --username "andrewor14"
  
# Move the sub-directory in "dev" to the
# corresponding directory in "release"
$ export SVN_EDITOR=vim
$ svn mv https://dist.apache.org/repos/dist/dev/spark/spark-1.1.1-rc2 https://dist.apache.org/repos/dist/release/spark/spark-1.1.1
</code></pre>

<p>Verify that the resources are present in <a href="https://www.apache.org/dist/spark/">https://www.apache.org/dist/spark/</a>.
It may take a while for them to be visible. This will be mirrored throughout the Apache network. 
There are a few remaining steps.</p>

<h4>Remove Old Releases from Mirror Network</h4>

<p>Spark always keeps two releases in the mirror network: the most recent release on the current and 
previous branches. To delete older versions simply use svn rm. The <code>downloads.js</code> file in the 
website <code>js/</code> directory must also be updated to reflect the changes. For instance, the two 
releases should be 1.1.1 and 1.0.2, but not 1.1.1 and 1.1.0.</p>

<pre><code>$ svn rm https://dist.apache.org/repos/dist/release/spark/spark-1.1.0
</code></pre>

<h4>Update the Spark Apache Repository</h4>

<p>Check out the tagged commit for the release candidate that passed and apply the correct version tag.</p>

<pre><code>$ git checkout v1.1.1-rc2 # the RC that passed
$ git tag v1.1.1
$ git push apache v1.1.1
 
# Verify that the tag has been applied correctly
# If so, remove the old tag
$ git push apache :v1.1.1-rc2
$ git tag -d v1.1.1-rc2
</code></pre>

<p>Next, update remaining version numbers in the release branch. If you are doing a patch release, 
see the similar commit made after the previous release in that branch. For example, for branch 1.0, 
see <a href="https://github.com/apache/spark/commit/2a5514f7dcb9765b60cb772b97038cbbd1b58983">this example commit</a>.</p>

<p>In general, the rules are as follows:</p>

<ul>
  <li><code>grep</code> through the repository to find such occurrences</li>
  <li>References to the version just released. Upgrade them to next release version. If it is not a 
documentation related version (e.g. inside <code>spark/docs/</code> or inside <code>spark/python/epydoc.conf</code>), 
add <code>-SNAPSHOT</code> to the end.</li>
  <li>References to the next version. Ensure these already have <code>-SNAPSHOT</code>.</li>
</ul>

<!--
<h4>Update the EC2 Scripts</h4>

Upload the binary packages to the S3 bucket s3n://spark-related-packages (ask pwendell to do this). Then, change the init scripts in mesos/spark-ec2 repository to pull new binaries (see this example commit).
For Spark 1.1+, update branch v4+
For Spark 1.1, update branch v3+
For Spark 1.0, update branch v3+
For Spark 0.9, update branch v2+
You can audit the ec2 set-up by launching a cluster and running this audit script. Make sure you create cluster with default instance type (m1.xlarge).
-->

<h4>Update the Spark Website</h4>

<p>The website repository is located at 
<a href="https://github.com/apache/spark-website">https://github.com/apache/spark-website</a>. 
Ensure the docs were generated with the PRODUCTION=1 environment variable.</p>

<pre><code># Build the latest docs
$ git checkout v1.1.1
$ cd docs
$ PRODUCTION=1 jekyll build
 
# Copy the new documentation to apache
$ git clone https://github.com/apache/spark-website
...
$ cp -R _site spark-website/site/docs/1.1.1

# Update the "latest" link
$ cd spark/site/docs
$ rm latest
$ ln -s 1.1.1 latest
</code></pre>

<p>Next, update the rest of the Spark website. See how the previous releases are documented. 
In particular, have a look at the changes to the <code>*.md</code> files in this commit (all the HTML 
file changes are generated by <code>jekyll</code>).</p>

<pre><code>$ git add 1.1.1
$ git commit -m "Add docs for Spark 1.1.1" 
</code></pre>

<p>Then, create the release notes. The contributors list can be automatically generated through 
<a href="https://github.com/apache/spark/blob/branch-1.1/dev/create-release/generate-contributors.py">this script</a>.
It accepts the tag that corresponds to the current release and another tag that 
corresponds to the previous (not including maintenance release). For instance, if you are 
releasing Spark 1.2.0, set the current tag to v1.2.0-rc2 and the previous tag to v1.1.0.
Once you have generated the initial contributors list, it is highly likely that there will be 
warnings about author names not being properly translated. To fix this, run 
<a href="https://github.com/apache/spark/blob/branch-1.1/dev/create-release/translate-contributors.py">this other script</a>,
which fetches potential replacements from Github and JIRA. For instance:</p>

<pre><code>$ cd release-spark/dev/create-release
# Set RELEASE_TAG and PREVIOUS_RELEASE_TAG
$ vim generate-contributors.py
# Generate initial contributors list, likely with warnings
$ ./generate-contributors.py
# Set JIRA_USERNAME, JIRA_PASSWORD, and GITHUB_API_TOKEN
$ vim release-spark/dev/translate-contributors.py
# Translate names generated in the previous step, reading from known_translations if necessary
$ ./translate-contributors.py
</code></pre>

<p>Additionally, if you wish to give more specific credit for developers of larger patches, you may 
use the the following commands to identify large patches. Extra care must be taken to make sure 
commits from previous releases are not counted since git cannot easily associate commits that 
were back ported into different branches.</p>

<pre><code># Determine PR numbers closed only in the new release
$ git log v1.1.1 | grep "Closes #" | cut -d " " -f 5,6 | grep Closes | sort &gt; closed_1.1.1
$ git log v1.1.0 | grep "Closes #" | cut -d " " -f 5,6 | grep Closes | sort &gt; closed_1.1.0
$ diff --new-line-format="" --unchanged-line-format="" closed_1.1.1 closed_1.1.0 &gt; diff.txt
 
# Grep expression with all new patches
$ EXPR=$(cat diff.txt | awk '{ print "\\("$1" "$2" \\)"; }' | tr "\n" "|" | sed -e "s/|/\\\|/g" | sed "s/\\\|$//")
 
# Contributor list
$ git shortlog v1.1.1 --grep "$EXPR" &gt; contrib.txt
 
# Large patch list (300+ lines)
$ git log v1.1.1 --grep "$expr" --shortstat --oneline | grep -B 1 -e "[3-9][0-9][0-9] insert" -e "[1-9][1-9][1-9][1-9] insert" | grep SPARK &gt; large-patches.txt
</code></pre>

<p>Then, update the downloads page, and then the main page with a news item.</p>

<h4>Create an Announcement</h4>

<p>Once everything is working (website docs, website changes) create an announcement on the website 
and then send an e-mail to the mailing list. Enjoy an adult beverage of your choice, and 
congratulations on making a Spark release.</p>

  </div>
</div>



<footer class="small">
  <hr>
  Apache Spark, Spark, Apache, and the Spark logo are <a href="/trademarks.html">trademarks</a> of
  <a href="https://www.apache.org">The Apache Software Foundation</a>.
</footer>

</div>

</body>
</html>
